(this["webpackJsonpzesp-ui-app"]=this["webpackJsonpzesp-ui-app"]||[]).push([[0],{117:function(e,t,n){},124:function(e){e.exports=JSON.parse('{"save_button":"Save changes","saving_success":"Saving successful","saving_error":"Oops... we cannot complete it )=","saving_progress":"Saving in progress..."}')},125:function(e){e.exports=JSON.parse('{"home":"Home","devices":"Devices","setup":"Settings"}')},126:function(e){e.exports=JSON.parse('{"groups":{"hub":"Hub devices","sensors":"Sensors or monitoring systems","switches":"Switches","lights":"Lights and bulbs","other":"Other or unknown devices","all":"All registered devices"}}')},127:function(e){e.exports=JSON.parse('{"topic":{"label":"Topic name","placeholder":"Enter MQTT topic name (e.g. zesp32)"},"server":{"label":"Server address","placeholder":"Enter MQTT server address (e.g. 192.168.1.1)"},"port":{"label":"Server port","placeholder":"Enter MQTT server port (e.g. 1883)"},"login":{"label":"MQTT Login","placeholder":"Enter MQTT user login (e.g. mqtt)"},"password":{"label":"MQTT Password","placeholder":"Enter MQTT user password (e.g. pa$vv0rd)"},"is_enabled":{"label":"Client is enabled"},"is_ha_enabled":{"label":"Home Assistant"}}')},128:function(e){e.exports=JSON.parse('{"ssid":{"label":"WIFI SSID","placeholder":"Enter SSID of your wifi AP (e.g. MySecretWifi)"},"pass":{"label":"WIFI Password","placeholder":"Enter your connection password (e.g. super-duper-password)"},"ip":{"label":"Local address","placeholder":"Enter static IP address and port of device with ZESP (e.g. 192.168.1.2:8082)"},"mask":{"label":"Local mask address","placeholder":"Enter device network mask (e.g. 255.255.255.0)"},"gw":{"label":"Gateway address","placeholder":"Enter gateway address (e.g. 192.168.1.1)"}}')},129:function(e){e.exports=JSON.parse('{"list":{"title":"Welcome here, stranger!","add_button":"Add a new server","add_message":"There is no servers added. Please, click this big blue button bellow to add your awesome server."},"edit":{"title":"Connection settings","delete_button":"Delete","delete_title":"Delete confirmation","delete_message":"Are you <strong>sure</strong> you want to delete it?<br/>Just asking, no pressure... if you want to continue, smash <span class=\'badge bg-danger\'>Delete</span> button bellow one more time.","save_button":"Save changes","add_button":"Add server","name_input_placeholder":"Enter display name (e.g. My hub4fun)","address_input_placeholder":"Your server address (e.g. 192.168.1.1)"}}')},156:function(e){e.exports=JSON.parse('[{"id":"on_off_root","arguments":{"commandOn":"01 0000 01  0100","commandOff":"01 0000 01  0000"},"reportKey":{"endpoint":"01","clusterId":"0006","attributeId":"0000"}},{"id":"level_root","arguments":{"command":"MoveToLevel|0000|1|1|1|{value}|0009","min":0,"max":255},"reportKey":{"endpoint":"FF","clusterId":"BBBB","attributeId":"0001"}},{"id":"rgb_root","arguments":{"command":"MoveToColor|0000|1|1|{x}|{y}|0001"},"reportKey":{"endpoint":"FF","clusterId":"BBBB","attributeId":"0002"}},{"id":"illuminance_sensor","reportKey":{"endpoint":"01","clusterId":"0106","attributeId":"0000"}},{"id":"level_control","group":"Playback","label":"Volume","arguments":{"command":"setVolume|{value:dec}","min":0,"max":32768},"reportKey":{"endpoint":"FF","clusterId":"BBBB","attributeId":"0003"}},{"id":"player_src_root","group":"Playback","reportKey":{"endpoint":"FF","clusterId":"BBBB","attributeId":"0004"}},{"id":"player_control_root","group":"Playback","arguments":{"commandOn":"playSound|{value}","commandOff":"killSound|0"},"reportKey":{"endpoint":"FF","clusterId":"BBBB","attributeId":"0005"}}]')},171:function(e){e.exports=JSON.parse('[{"modelIds":["ZESP_Root"],"image":"zesp.jpg","controls":"root.json"},{"modelIds":["lumi.sensor_switch"],"image":"default-sensor-switch.jpg"},{"modelIds":["lumi.sensor_motion"],"image":"default-sensor-motion.jpg"},{"modelIds":["lumi.sensor_magnet"],"image":"default-sensor-magnet.jpg"}]')},179:function(e,t,n){},180:function(e,t,n){window.$=window.jQuery=n(36),console.debug=function(){console.log("Debug logs are disabled")}},202:function(e,t,n){var c={"./config":98,"./config.js":98,"./locales/en/common":124,"./locales/en/common.json":124,"./locales/en/nav":125,"./locales/en/nav.json":125,"./locales/en/pages/devices":126,"./locales/en/pages/devices.json":126,"./locales/en/pages/setup-mqtt":127,"./locales/en/pages/setup-mqtt.json":127,"./locales/en/pages/setup-wifi":128,"./locales/en/pages/setup-wifi.json":128,"./locales/en/pages/welcome":129,"./locales/en/pages/welcome.json":129};function o(e){var t=r(e);return n(t)}function r(e){if(!n.o(c,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return c[e]}o.keys=function(){return Object.keys(c)},o.resolve=r,e.exports=o,o.id=202},203:function(e,t,n){},204:function(e,t,n){},205:function(e,t,n){},219:function(e,t,n){},221:function(e,t,n){},222:function(e,t,n){},233:function(e,t,n){},234:function(e,t,n){},235:function(e){e.exports=JSON.parse('{"default":{"titles":{"onTrue":"True","onFalse":"False"},"icons":{"onTrue":"bi-check-circle","onFalse":"bi-slash-circle"},"styles":{"onTrue":"status-primary","onFalse":"status-secondary"}},"door":{"titles":{"onTrue":"Opened","onFalse":"Closed"},"icons":{"onTrue":"bi-door-open","onFalse":"bi-door-closed"}},"motion":{"titles":{"onTrue":"Detected","onFalse":"No motion"},"icons":{"onTrue":"bi-soundwave","onFalse":"bi-fullscreen"}}}')},342:function(e,t,n){var c={"./root":156,"./root.json":156};function o(e){var t=r(e);return n(t)}function r(e){if(!n.o(c,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return c[e]}o.keys=function(){return Object.keys(c)},o.resolve=r,e.exports=o,o.id=342},343:function(e,t,n){"use strict";n.r(t);var c,o,r,a=n(0),s=n.n(a),i=n(21),l=n.n(i),d=(n(179),n(180),n(181),n(98),n(6)),u=n(17),b=n(15),j=(n(203),n(204),n(359)),f=(n(205),n(1)),p=function(){var e=Object(j.a)("nav").t;return Object(f.jsxs)("nav",{className:"nav nav-masthead justify-content-center",children:[Object(f.jsx)(u.b,{className:"nav-link",to:"/devices",children:e("devices")}),!1,Object(f.jsx)(u.b,{className:"nav-link",to:"/setup",children:e("setup")})]})},m=(n(219),n(349)),v=n(13),h=n(32),O=Object(h.b)({name:"spinner",initialState:{spinnerShow:!1},reducers:{setSpinnerShow:function(e,t){e.spinnerShow=t.payload}}}),g=function(e){return e.spinner.spinnerShow},x=O.actions.setSpinnerShow,y=O.reducer,N=function(){var e=Object(v.c)(g);return Object(f.jsx)("div",{className:"loading-overlay ".concat(e?"show":"hidden"),children:Object(f.jsx)(m.a,{animation:"border",variant:"light"})})},S=n(24),w=(n(221),function(e){var t=Object(a.useState)("show-transition hidden"),n=Object(d.a)(t,2),c=n[0],o=n[1];return setTimeout((function(){return o("show-transition")}),0),Object(f.jsx)("div",{className:c,children:e.children})}),I=n(23),_=(n(222),n(358)),k=function(e){var t=Object(a.useState)(e.device.image),n=Object(d.a)(t,2),c=n[0],o=n[1];return Object(a.useEffect)((function(){var e=new Image;e.onerror=function(){o("/device-images/default.png")},e.src=c}),[]),Object(f.jsx)("div",{className:"item-image",style:{backgroundImage:"url(".concat(c,")")}})},C=function(e){var t=e.device,n="/devices/".concat(t.ieee);return Object(f.jsx)(u.b,{className:"item p-3 border rounded",to:n,children:Object(f.jsxs)("div",{className:"d-flex",children:[Object(f.jsx)("div",{children:Object(f.jsx)(k,{device:e.device})}),Object(f.jsxs)("div",{className:"ps-2",children:[Object(f.jsx)("div",{className:"title",children:t.title}),Object(f.jsx)("div",{className:"ieee text-muted small",children:t.ieee}),t.tags.length>0&&Object(f.jsx)("div",{className:"badges small",children:t.tags.map((function(e,t){return Object(f.jsx)("span",{className:"badge bg-secondary",children:e},t)}))})]})]})})},E=n(82),T=n(2),z=function(e){return(e.customLayout&&e.customLayout.length>0?e.customLayout:R(e)).reduce((function(e,t){var n=t.group||"main",c=e.find((function(e){return e.name===n}));return c||(c={name:n},e.push(c)),c.settings=[].concat(Object(I.a)(c.settings||[]),[t]),e}),[])},F=function(e,t){return t&&"ZED"!==t&&"ZR"!==t?"BED"===t?(null===e||void 0===e?void 0:e.length)<1?void console.warn("Unknown format of BLE report key: '".concat(e,"'")):{endpoint:"",clusterId:e,attributeId:""}:void console.warn("Unknown device type '".concat(t,"'")):10!==(null===e||void 0===e?void 0:e.length)?void console.warn("Unknown format of Zigbee report key: '".concat(e,"'")):{endpoint:e.substr(0,2),clusterId:e.substr(2,4),attributeId:e.substr(6)}},R=function(e){return Object.keys(e.zespInfo.Report).map((function(t){return function(t){var n,c=F(t,e.zespInfo.DevType);if(c){var o=E.find((function(e){return e.clusterId==c.clusterId})),r={id:c.clusterId,reportKey:c};if(!o)return console.debug("Report key '".concat(t,"' with unregistered cluster '").concat(c.clusterId,"' received")),r;var a=null===(n=e.zespInfo.Report[t].role)||void 0===n?void 0:n.split("&");return a&&a.length>0?Object(T.a)(Object(T.a)({},r),P(a,o,t,e.zespInfo.DevType)):o.attributes&&o.attributes[c.attributeId]||r}console.warn("Cannot get report key details for '".concat(e.zespInfo.IEEE,"' device"))}(t)})).filter((function(e){return void 0!==e}))},P=function(e,t,n,c){var o=F(n,c);if(o){var r=e[0],a=e.length>1?e[1]:null,s=t.attributes&&(t.attributes["".concat(o.attributeId,":").concat(r)]||t.attributes[r])||{id:r};return a&&(s.zespRoleSettings=JSON.parse(a)),s}},L=n(163),B={ConnectionStartTimeout:100,VerifyConnectionTimeout:5e3,DefaultRequestTimeoutSeconds:5},M=n(38),A=n(51),Z=n(55),D=n(174),V="zesp-data-received",J=function(e){Object(A.a)(n,e);var t=Object(Z.a)(n);function n(e,c,o){var r;return Object(M.a)(this,n),(r=t.call(this,V)).dataType=void 0,r.response=void 0,r.dataParts=void 0,r.dataType=e,r.dataParts=c,r.response=o,r}return n}(Object(D.a)(Event));!function(e){e[e.Restart=1012]="Restart"}(c||(c={}));var q,K,U,W=new EventTarget,H={connectAsync:function(e,t){return new Promise((function(n,c){r?console.warn("ZespConnector already initialized"):(r=e,setTimeout((function(){return H.reconnectAsync(!0,t).then((function(){n(K.ZespConnector)})).catch((function(e){t(!1),c(e)}))}),B.ConnectionStartTimeout),q=setInterval((function(){return H.reconnectAsync(!1,t).catch((function(e){console.warn("Reconnection is failed: ".concat(e)),t(!1)}))}),B.VerifyConnectionTimeout))}))},disconnect:function(){q&&(clearInterval(q),q=null),r=null;try{var e,t,n,c,a,s,i;if(3===(null===(e=o)||void 0===e||null===(t=e.underlyingWebsocket)||void 0===t?void 0:t.readyState)||null==(null===(n=o)||void 0===n||null===(c=n.underlyingWebsocket)||void 0===c?void 0:c.readyState))return void console.debug("zesp connection already closed");if(1===(null===(a=o)||void 0===a||null===(s=a.underlyingWebsocket)||void 0===s?void 0:s.readyState))return console.debug("zesp connection closing..."),void o.close(1e3);null===(i=o)||void 0===i||i.close(1e3)}catch(l){}},reconnectAsync:function(e,t){return new Promise((function(n,a){var s,i,l,d;if(r||a("Server configuration missed"),0!==(null===(s=o)||void 0===s||null===(i=s.underlyingWebsocket)||void 0===i?void 0:i.readyState))if(1!==(null===(l=o)||void 0===l||null===(d=l.underlyingWebsocket)||void 0===d?void 0:d.readyState)||e){console.debug("Start ws connection...");try{o.close(c.Restart)}catch(b){}t&&t(!1);var u="https:"===document.location.protocol?"wss":"ws";o=new L.WebsocketBuilder("".concat(u,"://").concat(r.address,":81")).onOpen((function(){t&&(console.debug("ZESP connected"),t(!0)),n()})).onClose((function(){console.debug("ZESP connection closed"),t&&t(!1)})).onError((function(){G(),a("ZESP connection error")})).onMessage(Q).build()}else n();else a("Already connecting")}))},send:function(e){if(o){var t=!0===e.isBinary?Y(e.data):e.data;o.send(t)}else console.error("ZespConnector.send: WebSocket client is not initialized yet")},requestAsync:function(e){return new Promise((function(t,n){(!e.timeoutSeconds||e.timeoutSeconds<=0)&&(e.timeoutSeconds=B.DefaultRequestTimeoutSeconds),!0!==e.isBinary&&(e.isBinary=!1);var c=!1,o=e.responseValidator,r=function e(n){var r=n;o.isValid(r)&&(c=!0,W.removeEventListener(V,e),t(r))};try{W.addEventListener(V,r),H.send({data:e.data,isBinary:e.isBinary}),setTimeout((function(){c||(W.removeEventListener(V,r),console.warn("zesp response did not received (timeout: ".concat(e.timeoutSeconds," seconds)")),n("timeout"))}),1e3*e.timeoutSeconds)}catch(a){n("exception: ".concat(a))}}))},request:function(e){return new Promise((function(t,n){H.requestAsync(e).then((function(n){e.onSuccess?e.onSuccess(n):console.debug("zesp request completed (".concat(e.responseValidator.name,")")),t(K.ZespConnector)})).catch((function(t){var c="".concat(t," (").concat(e.responseValidator.name,"; ").concat(e.data,")");e.onError?e.onError(c):console.warn("zesp request failed: ".concat(c)),n(c)}))}))},subscribe:function(e,t){var n=function(n){var c=n;e.isValid(c)&&t(c)};return W.addEventListener(V,n),n},unsubscribe:function(e){return W.removeEventListener(V,e)},getServerAddress:function(){var e;return null===(e=r)||void 0===e?void 0:e.address}},G=function(){console.debug("Zesp connection error happened )=")},Q=function(e,t){var n=t.data.replace(/\|(?=([^"]*"[^"]*")*[^"]*$)/gi,"\0").split("\0");if(0!=n.length){var c=n.shift();/\/(.+)\.json/gi.exec(c)&&(n.unshift(c),c="json");var o=new J(c,n,t.data);W.dispatchEvent(o)}else console.warn("Received empty message from zesp")},Y=function(e){var t,n=null===(t=e.replaceAll(" ","").match(/[\da-f]{2}/gi))||void 0===t?void 0:t.map((function(e){return parseInt(e,16)}));return new Uint8Array(n)},$=H;(U=K||(K={})).ZespConnector=$,U.ZespConnectorPromise=new Promise((function(e){return e(K.ZespConnector)}));var X=Object(h.b)({name:"devices",initialState:{devices:[]},reducers:{setDevices:function(e,t){e.devices=t.payload},updateReport:function(e,t){var n=e.devices.find((function(e){return e.zespInfo.IEEE===t.payload.ieee}));n?(n.zespInfo.Report[t.payload.reportKey]=Object(T.a)(Object(T.a)({},n.zespInfo.Report[t.payload.reportKey]),t.payload.update),console.debug("Device '".concat(t.payload.ieee,"' with report '").concat(t.payload.reportKey,"' has been updated"))):console.warn("Device '".concat(t.payload.ieee,"' not found to update"))},updateRootReports:function(e,t){var n=e.devices.find((function(e){return"ZESP_Root"===e.zespInfo.ModelId}));n?n.zespInfo.Report=Object(T.a)(Object(T.a)({},n.zespInfo.Report),t.payload):console.warn("Root device not found to update")}}}),ee=function(e,t){return e.devices.devices.find((function(e){return e.zespInfo.IEEE===t}))},te=function(e){return e.devices.devices||[]},ne=X.actions,ce=ne.setDevices,oe=ne.updateReport,re=ne.updateRootReports,ae=X.reducer,se=function(e){var t=Object(j.a)("pages.devices").t,n=e.devices;return Object(f.jsxs)("div",{className:"group border-top pt-4",children:[Object(f.jsxs)("div",{className:"title h5 pb-3",children:[Object(f.jsx)("span",{children:t("groups.all")}),n.length>1&&Object(f.jsx)("span",{className:"badge bg-secondary ms-2",children:n.length})]}),Object(f.jsx)("div",{className:"items d-flex flex-wrap",children:n.map((function(e,t){return Object(f.jsx)(C,{device:e},t)}))})]})},ie=function(e,t){return"ZESP_Root"===e.zespInfo.ModelId?-1:"ZESP_Root"===t.zespInfo.ModelId?1:e.zespInfo.ModelId<t.zespInfo.ModelId?-1:e.zespInfo.ModelId>t.zespInfo.ModelId?1:0},le=function(e){var t=e.zespInfo.Name&&e.zespInfo.Name.length>0?e.zespInfo.Name:e.zespInfo.ModelId,n=de(e),c=ue(e.zespInfo.Report,e.zespInfo.DevType);return{title:t,ieee:e.zespInfo.IEEE,image:n,tags:c}},de=function(e){var t;if(null===(t=e.settings)||void 0===t?void 0:t.image)return"".concat(".","/device-images/").concat(e.settings.image);var n=K.ZespConnector.getServerAddress();if(e.zespInfo.Img)return"http://".concat(n,":8081/").concat(e.zespInfo.Img);var c=e.zespInfo.ModelId;return"http://".concat(n,":8081/img/").concat(c,".jpg")},ue=function(e,t){for(var n=[],c=function(){var e=r[o],c=F(e,t);if(!c)return console.warn("Cannot read report '".concat(e,"' details for '").concat(t,"' device type")),"continue";var a=E.find((function(e){return e.clusterId===c.clusterId}));n.push((null===a||void 0===a?void 0:a.name)||c.clusterId)},o=0,r=Object.keys(e);o<r.length;o++)c();return n.filter((function(e,t){return n.indexOf(e)==t})).sort((function(e,t){return e>t?1:-1}))},be=function(){var e=Object(v.c)(te,(function(e,t){return e.length===t.length}));if(0==e.length)return Object(f.jsx)("div",{children:"No devices found..."});console.debug("Building list of devices to show...");var t=Object(I.a)(e).sort(ie).map(le);return console.debug("devices page updated..."),Object(f.jsx)(w,{children:Object(f.jsx)("div",{className:"devices",children:Object(f.jsx)(_.a,{children:Object(f.jsx)(_.a.Body,{children:Object(f.jsx)(se,{devices:t})})})})})},je=n(350),fe=n(356),pe=n(172),me={zespSettings:void 0},ve=Object(h.b)({name:"settings",initialState:me,reducers:{setSettings:function(e,t){e.zespSettings=t.payload}}}),he=function(e){return e.settings.zespSettings},Oe=ve.actions.setSettings,ge=ve.reducer,xe=function e(t){return{name:e.name,isValid:function(e){return e.dataType===t}}},ye={name:"AllZespResponseValidator",isValid:function(e){return!0}},Ne=function(){return new Promise((function(e,t){K.ZespConnector.requestAsync({data:"loadConfig",responseValidator:xe("jsconfig")}).then((function(e){return function(e){var t=JSON.parse(e),n={};return Object.assign(n,t),n}(e.dataParts[0])})).then((function(t){return e(t)})).catch((function(e){return t(e)}))}))},Se=function(e){var t=["SaveJson","/jsconfig.txt",JSON.stringify(e)].join("|");return new Promise((function(e,n){K.ZespConnector.requestAsync({data:t,responseValidator:xe("ZD_RSP")}).then((function(t){"ok"===t.dataParts[1].toLocaleLowerCase()?e():n("Settings was not saved: ".concat(t.response))})).catch((function(e){return n(e)}))}))};var we=function(e,t,n){return new Promise((function(c,o){t||o("Settings not loaded"),n(x(!0));var r=Object(T.a)(Object(T.a)({},t),e);Se(r).then((function(){n(Oe(r)),c(),S.b.success("Settings updated")})).catch((function(e){S.b.error("Cannot save: ".concat(e)),o(e)})).finally((function(){return n(x(!1))}))}))},Ie=function(){var e=Object(v.b)(),t=Object(v.c)(he);return Object(a.useEffect)((function(){e(x(!0)),Ne().then((function(t){e(Oe(t))})).catch((function(e){alert(e)})).finally((function(){return e(x(!1))}))}),[]),t?Object(f.jsxs)(w,{children:[Object(f.jsx)("div",{className:"aaa",children:"..."}),Object(f.jsx)(je.a,{className:"p-0",children:Object(f.jsxs)(fe.a,{variant:"pills",children:[Object(f.jsx)(fe.a.Item,{children:Object(f.jsx)(u.b,{className:"nav-link",to:"/setup",exact:!0,children:"Wifi client"})}),Object(f.jsx)(fe.a.Item,{children:Object(f.jsx)(u.b,{className:"nav-link",to:"/setup/zigbee",children:"Zigbee"})}),Object(f.jsx)(fe.a.Item,{children:Object(f.jsx)(u.b,{className:"nav-link",to:"/setup/mqtt",children:"MQTT client"})}),Object(f.jsx)(fe.a.Item,{children:Object(f.jsx)(u.b,{className:"nav-link",to:"/setup/telegram",children:"Telegram bot"})}),Object(f.jsx)(fe.a.Item,{children:Object(f.jsx)(u.b,{className:"nav-link",to:"/setup/z2m",children:"Z2M client"})}),Object(f.jsx)(fe.a.Item,{className:"ms-auto",children:Object(f.jsxs)(u.b,{className:"nav-link",to:"/setup/zesp-ui",children:[Object(f.jsx)(pe.a,{style:{marginTop:"-3px"}})," ZESP:UI"]})})]})})]}):Object(f.jsx)(a.Fragment,{})},_e=(n(233),n(355)),ke=function(e){var t=e.device.zespInfo.Name||e.device.zespInfo.ModelId,n=e.groups.length>1?"with-tabs":"",c=e.groups.length>1?Object(f.jsx)("ul",{className:"nav nav-tabs",children:e.groups.map((function(n,c){return Object(f.jsx)("li",{className:"nav-item",children:Object(f.jsx)("button",{type:"button",className:"btn btn-light nav-link ".concat(e.activeGroupName===n.name?"active":""),onClick:function(){return e.setActiveGroupName(n.name)},children:"main"===n.name?t:n.name})},c)}))}):Object(f.jsx)("div",{children:t});return Object(f.jsxs)(_e.a.Header,{className:n,children:[Object(f.jsx)("div",{children:c}),Object(f.jsxs)("div",{className:"text-end modal-right-buttons",children:[e.onDetailsClicked&&Object(f.jsx)("button",{type:"button",className:"btn",onClick:e.onDetailsClicked,children:Object(f.jsx)("i",{className:"bi bi-three-dots-vertical"})}),Object(f.jsx)("span",{className:"border-end ms-2 me-3"}),Object(f.jsx)("button",{type:"button",className:"btn-close me-1","aria-label":"Close",onClick:e.onCloseClicked})]})]})},Ce=n(34),Ee=(n(234),["0100060000","0104060000"]),Te=["010000FF02"],ze=n(235),Fe=[2.7,3.1],Re=function(e){var t=Le(Ee,e);if(!t)return{iconClassName:ze.default.icons.onFalse,valueClassName:"status-unknown",valueTitle:"Unknown"};var n=t.parsed||t.val,c=t.role&&t.role.split("&"),o=c&&c.length>1?JSON.parse(c[1]):void 0,r=o&&o.payload_on?n===o.payload_on:"1"===n||"01"===n,a=o&&o.device_class||"default",s=Object(T.a)(Object(T.a)({},ze.default),ze[a]);return{iconClassName:r?"".concat(s.icons.onTrue," ").concat(s.styles.onTrue):"".concat(s.icons.onFalse," ").concat(s.styles.onFalse),valueClassName:"status ".concat(r?s.styles.onTrue:s.styles.onFalse),valueTitle:r?s.titles.onTrue:s.titles.onFalse}},Pe=function(e){var t,n=Le(Te,e);if(!n)return{stateClassName:"??",valueTitle:"-",valuePercents:0};var c=null===(t=n.role)||void 0===t?void 0:t.split("&"),o=c&&c.length>1?JSON.parse(c[1]):void 0,r=o&&o.unit_of_measurement||"",a=Number(n.parsed||n.val)||void 0,s=void 0;if(a)if("%"===r)s=Number(a);else{var i=Number(a)||void 0;i&&(i=Math.min(Fe[1],Math.max(Fe[0],i)),s=Math.round(100*(1-(Fe[1]-i)/(Fe[1]-Fe[0]))))}else s=void 0;var l=o&&o.device_class||"default",d=Object(T.a)(Object(T.a)({},ze.default),ze[l]),u="".concat(a||"??"," ").concat(r);return{stateClassName:s?s<=50?d.styles.onFalse:d.styles.onTrue:"status-unknown",valuePercents:s||0,valueTitle:u}},Le=function(e,t){var n,c=Object(Ce.a)(e);try{for(c.s();!(n=c.n()).done;){var o=n.value,r=t.device.zespInfo.Report[o];if(r)return r}}catch(a){c.e(a)}finally{c.f()}},Be=n(351),Me=n(352),Ae=n(353),Ze=function(e){if(!e.config.reportKey)return console.debug("No report key in config found for ".concat(e.deviceInfo.zespInfo.IEEE," device and ").concat(e.config.id," control")),null;var t=e.config.reportKey.endpoint+e.config.reportKey.clusterId+e.config.reportKey.attributeId;return e.deviceInfo.zespInfo.Report[t]},De=function(e,t){var n,c=null===(n=e.deviceInfo.customLayout)||void 0===n?void 0:n.find((function(e){return e.id===t}));return[c,c&&c.reportKey?e.deviceInfo.zespInfo.Report[c.reportKey.endpoint+c.reportKey.clusterId+c.reportKey.attributeId]:void 0]},Ve=function(e){var t=Ze(e);return Object(f.jsxs)(Be.a,{children:[Object(f.jsx)(st,{children:"Light power:"}),Object(f.jsx)(it,{children:Object(f.jsxs)(Me.a,{children:[Object(f.jsx)(Ae.a,{variant:"1"===(null===t||void 0===t?void 0:t.val.toString())?"primary":"secondary",onClick:function(){K.ZespConnector.send({data:e.config.arguments.commandOn,isBinary:!0})},children:"ON"}),Object(f.jsx)(Ae.a,{variant:"1"===(null===t||void 0===t?void 0:t.val.toString())?"secondary":"primary",onClick:function(){K.ZespConnector.send({data:e.config.arguments.commandOff,isBinary:!0})},children:"OFF"})]})})]})},Je=n(165),qe=n(54),Ke=function(e){var t=Ze(e),n=(null===t||void 0===t?void 0:t.val)?Number(t.val):(e.config.arguments.max-e.config.arguments.min)/2+e.config.arguments.min,c=Object(a.useState)(n),o=Object(d.a)(c,2),r=o[0],s=o[1],i={min:e.config.arguments.min,max:e.config.arguments.max},l=function(t){return Math.max(Math.min(e.config.arguments.max,t),e.config.arguments.min)};return Object(f.jsxs)(Be.a,{children:[Object(f.jsx)(st,{children:"Level:"}),Object(f.jsxs)(it,{children:[Object(f.jsx)(Je.a,Object(T.a)({style:{width:"80px"},className:"me-2",type:"number",value:r,onChange:function(t){return function(t){var n=l(t);s(n);var c=e.config.arguments.command.replace("{value}",n.toString(16));K.ZespConnector.send({data:c})}(Number(t.target.value))}},i)),Object(f.jsx)(qe.a,Object(T.a)({value:r,onChange:function(e){return s(Number(e.target.value))},onMouseUp:function(){var t=l(r),n=e.config.arguments.command.replace("{value}",t.toString(16));K.ZespConnector.send({data:n})}},i))]})]})},Ue=n(93);function We(e,t){var n=function(){if("undefined"===typeof window)return t;try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(c){return console.warn("Error reading localStorage key \u201c".concat(e,"\u201d:"),c),t}},c=Object(a.useState)(n),o=Object(d.a)(c,2),r=o[0],s=o[1];return Object(a.useEffect)((function(){s(n())}),[]),Object(a.useEffect)((function(){var e=function(){s(n())};return window.addEventListener("storage",e),window.addEventListener("local-storage",e),function(){window.removeEventListener("storage",e),window.removeEventListener("local-storage",e)}}),[]),[r,function(t){"undefined"==typeof window&&console.warn("Tried setting localStorage key \u201c".concat(e,"\u201d even though environment is not a client"));try{var n=t instanceof Function?t(r):t;window.localStorage.setItem(e,JSON.stringify(n)),s(n),window.dispatchEvent(new Event("local-storage"))}catch(c){console.warn("Error setting localStorage key \u201c".concat(e,"\u201d:"),c)}}]}var He=function(e){var t=Ze(e),n=(null===t||void 0===t?void 0:t.val)?null===t||void 0===t?void 0:t.val.split(":").map((function(e){return Number(e)})):[255,255,255];3!==n.length&&(console.warn("Incorrect RGB value stored to reportd: ".concat(null===t||void 0===t?void 0:t.val)),n=[255,255,255]);var c=Object(a.useState)({r:n[0],g:n[1],b:n[2]}),o=Object(d.a)(c,2),r=o[0],s=o[1],i=We("colorPicker",1),l=Object(d.a)(i,2),u=l[0],b=l[1],j=function(t){s(t);var n=Ge(t),c=Object(d.a)(n,2),o=c[0],r=c[1],a=e.config.arguments.command.replace("{x}",o.toString(16));a=a.replace("{y}",r.toString(16)),K.ZespConnector.send({data:a})},p=function(e){return Object(f.jsx)("button",{className:"btn btn-outline-secondary me-1 btn-xs ".concat(u==e?"active":""),type:"button",onClick:function(){return b(e)},children:e})};return Object(f.jsxs)(Be.a,{children:[Object(f.jsx)(st,{className:"user-select-none",children:Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{children:"Light color:"}),Object(f.jsxs)("div",{children:[p(1),p(2),p(3)]})]})}),Object(f.jsx)(it,{children:Object(f.jsxs)("div",{className:"flex-grow-1",children:[1===u&&Object(f.jsx)(Ue.c,{color:r,onChange:function(e){return s(e.rgb)},onChangeComplete:function(){var t=Ge(r),n=Object(d.a)(t,2),c=n[0],o=n[1],a=e.config.arguments.command.replace("{x}",c.toString(16));a=a.replace("{y}",o.toString(16)),K.ZespConnector.send({data:a})},width:"270px"}),2===u&&Object(f.jsx)(Ue.b,{color:r,onChange:function(e){return j(e.rgb)},triangle:"hide",width:"214px"}),3===u&&Object(f.jsx)(Ue.a,{color:r,onChange:function(e){return j(e.rgb)}})]})})]})},Ge=function(e){var t=e.b>.04045?Math.pow((e.b+.055)/1.055,2.4):e.b/12.92,n=e.g>.04045?Math.pow((e.g+.055)/1.055,2.4):e.g/12.92,c=e.r>.04045?Math.pow((e.r+.055)/1.055,2.4):e.r/12.92,o=.664511*t+.154324*n+.162028*c,r=.283881*t+.668433*n+.047685*c,a=88e-6*t+.07231*n+.986039*c,s=o/(o+r+a),i=r/(o+r+a);return isNaN(s)&&(s=0),isNaN(i)&&(i=0),[Number((65279*s).toFixed(0)),Number((65279*i).toFixed(0))]},Qe=function(e){var t,n=Object(a.useState)(),c=Object(d.a)(n,2),o=c[0],r=c[1];return!0===e.onRefresh&&Object(a.useEffect)((function(){return r(e.classNameFrom)}),[null===(t=e.children)||void 0===t?void 0:t.toString()]),!1===e.onLoad&&Object(a.useEffect)((function(){return r(e.classNameTo)}),[]),setTimeout((function(){return r(e.classNameTo)}),e.timeOutMs||100),Object(f.jsx)("span",{className:o,children:e.children})},Ye=function(e){return Object(f.jsx)(Qe,{classNameFrom:"highlight-value just-added",classNameTo:"highlight-value",onRefresh:!0,onLoad:!1,children:e.children})},$e=function(e){var t,n=Object(a.useState)(!1),c=Object(d.a)(n,2),o=c[0],r=c[1],s=JSON.stringify(e.config),i=JSON.stringify(Ze(e)),l=Ze(e);if(!l)return Object(f.jsx)(Xe,{id:e.config.id,reportData:i,configData:s});var u=l.label||e.config.label||e.config.id||"Unknown data",b=l.parsed&&l.parsed.toString().trim()===l.val.toString().trim()&&l.parsed||l.parsed&&l.val&&"".concat(l.parsed," (").concat(l.val,")")||l.val||"No data",j=null===(t=l.role)||void 0===t?void 0:t.split("&"),p=j&&j.length>1&&JSON.parse(j[1]),m=p&&p.unit_of_measurement||"";return Object(f.jsxs)(Be.a,{children:[Object(f.jsxs)(st,{children:[u,":"]}),Object(f.jsxs)(it,{children:[Object(f.jsxs)(Ye,{children:[b," ",m]}),Object(f.jsx)("a",{onClick:function(e){e.preventDefault(),r(!o)},href:"#",className:"value-info",title:"Unrecognized data, click to show details",children:Object(f.jsx)("i",{className:"bi bi-info-circle-fill ms-2 text-secondary"})})]}),Object(f.jsxs)("div",{className:"alert alert-info flex-column col-12 ".concat(o?"":"d-none"),children:[Object(f.jsx)("div",{children:s}),i&&Object(f.jsx)("div",{className:"mt-2",children:i})]})]})},Xe=function(e){return Object(f.jsxs)(Be.a,{children:[Object(f.jsx)(st,{children:e.id}),Object(f.jsx)(it,{children:Object(f.jsxs)("div",{className:"alert alert-info",children:[Object(f.jsx)("div",{children:e.configData}),e.reportData&&Object(f.jsx)("div",{className:"mt-2",children:e.reportData})]})})]})},et=function(e){var t=Ze(e),n=(null===t||void 0===t?void 0:t.val)?parseInt(t.val,16).toString():null;return Object(f.jsxs)(Be.a,{children:[Object(f.jsx)(st,{children:"Illuminance:"}),Object(f.jsxs)(it,{children:[n&&Object(f.jsx)(Ye,{children:n}),!n&&Object(f.jsx)("span",{className:"alert alert-warning small py-2 m-0",children:"No data"})]})]})},tt=function(e){var t={min:e.config.arguments.min,max:e.config.arguments.max},n=Ze(e),c=(null===n||void 0===n?void 0:n.val)?Number(n.val):(t.max-t.min)/2+t.min,o=Object(a.useState)(c),r=Object(d.a)(o,2),s=r[0],i=r[1],l=function(t){return Math.max(Math.min(e.config.arguments.max,t),e.config.arguments.min)};return Object(f.jsxs)(Be.a,{children:[Object(f.jsxs)(st,{children:[e.config.label||"Level",":"]}),Object(f.jsxs)(it,{children:[Object(f.jsx)(Je.a,Object(T.a)({style:{width:"100px"},className:"me-2 text-center",type:"number",value:s,onChange:function(t){return function(t){var n=l(t);i(n);var c=nt(e.config.arguments.command,n);K.ZespConnector.send({data:c})}(Number(t.target.value))}},t)),Object(f.jsx)(qe.a,Object(T.a)({value:s,onChange:function(e){return i(Number(e.target.value))},onMouseUp:function(){var t=l(s),n=nt(e.config.arguments.command,t);K.ZespConnector.send({data:n})}},t))]})]})},nt=function(e,t){return e.replace("{value}",t.toString(16)).replace("{value:dec}",t.toString())},ct=function(e){var t=Ze(e),n=De(e,"player_control_root"),c=Object(d.a)(n,2),o=c[0],r=c[1];if(!t)return Object(a.useEffect)((function(){S.b.error("'".concat(e.config.id,"' layout settings not found"))}),[]),Object(f.jsx)(f.Fragment,{});if(!r)return Object(a.useEffect)((function(){S.b.error("'player_control_root' layout settings not found")}),[]),Object(f.jsx)(f.Fragment,{});var s=Object(a.useState)(t.val||""),i=Object(d.a)(s,2),l=i[0],u=i[1],b=Object(a.useState)(r.val||"OFF"),j=Object(d.a)(b,2),p=j[0],m=j[1];return Object(f.jsxs)(Be.a,{children:[Object(f.jsx)(st,{children:"Radio stream:"}),Object(f.jsx)(it,{children:Object(f.jsxs)("div",{className:"input-group",children:[Object(f.jsx)("input",{className:"form-control",list:"datalistOptions",placeholder:"Click to see dropdown suggestions",value:l,onChange:function(e){var t=e.target.value;u(t)}}),Object(f.jsx)("button",{className:"btn btn-outline-secondary ".concat("ON"!==p?"active":""),type:"button",onClick:function(){m("OFF"),u(""),o?K.ZespConnector.send({data:o.arguments.commandOff}):console.warn("No configured OFF command for 'player_control_root' operation found in layout")},children:Object(f.jsx)("i",{className:"bi-stop"})}),Object(f.jsx)("button",{className:"btn btn-outline-secondary rounded-end ".concat("ON"===p?"active":""),type:"button",onClick:function(){l&&0!==l.length?(m("ON"),o?K.ZespConnector.send({data:o.arguments.commandOn.replace("{value}",l)}):console.warn("No configured ON command for 'player_control_root' operation found in layout")):S.b.error("Please select source first",{icon:"\ud83c\udfb5"})},children:Object(f.jsx)("i",{className:"bi-play"})}),Object(f.jsx)("datalist",{id:"datalistOptions",children:["http://chanson.hostingradio.ru:8041/chanson128.mp3","http://dorognoe.hostingradio.ru:8000/radio?type=.mp3","http://stream3.radiostyle.ru:8001/biker-fm","http://air.radiorecord.ru:8102/sd90_320","http://stream.hitroe.com/stream","http://air.radiorecord.ru:8102/tm_320","http://eu.radioboss.fm:8024/stream","http://listen.181fm.com/181-thebox_128k.mp3?","http://stream.live.vc.bbcmedia.co.uk/bbc_radio_one"].map((function(e,t){return Object(f.jsx)("option",{value:e},t)}))})]})})]})},ot=function(e){var t,n,c,o=Ze(e);if(!o)return Object(f.jsx)("div",{className:"alert alert-warning",children:"Report missed"});var r=Number((null===(t=e.config.zespRoleSettings.payload_on)||void 0===t?void 0:t.toString())||"0"),a=Number((null===(n=o.parsed)||void 0===n?void 0:n.toString())||(null===(c=o.val)||void 0===c?void 0:c.toString())||"1")===r;return Object(f.jsxs)(Be.a,{children:[Object(f.jsxs)(st,{children:[o.label||"State",":"]}),Object(f.jsx)(it,{children:Object(f.jsx)(Ye,{children:a?"ON":"OFF"})})]})},rt=function(e){var t=Ze(e);if(!t)return Object(f.jsx)("div",{className:"alert alert-warning",children:"Report missed"});var n=t.parsed||t.val,c=e.config.zespRoleSettings.unit_of_measurement||"";return Object(f.jsxs)(Be.a,{children:[Object(f.jsxs)(st,{children:[t.label||"Value",":"]}),Object(f.jsx)(it,{children:Object(f.jsx)(Ye,{children:n?"".concat(n," ").concat(c):"No data"})})]})},at=n(170),st=function(e){return Object(f.jsx)(at.a,{md:"4",children:e.children})},it=function(e){return Object(f.jsx)(at.a,{children:e.children})},lt=function(e){return Object(f.jsx)(f.Fragment,{children:e.settings.map((function(t,n){var c=function(e,t){var n={config:e,deviceInfo:t};switch(e.id){case"on_off_root":return Object(f.jsx)(Ve,Object(T.a)(Object(T.a)({},n),{},{config:n.config}));case"level_root":return Object(f.jsx)(Ke,Object(T.a)(Object(T.a)({},n),{},{config:n.config}));case"rgb_root":return Object(f.jsx)(He,Object(T.a)(Object(T.a)({},n),{},{config:n.config}));case"player_src_root":return Object(f.jsx)(ct,Object(T.a)(Object(T.a)({},n),{},{config:n.config}));case"player_control_root":return;case"level_control":return Object(f.jsx)(tt,Object(T.a)(Object(T.a)({},n),{},{config:n.config}));case"illuminance_sensor":return Object(f.jsx)(et,Object(T.a)(Object(T.a)({},n),{},{config:n.config}));case"binary_sensor":return Object(f.jsx)(ot,Object(T.a)(Object(T.a)({},n),{},{config:n.config}));case"sensor":return Object(f.jsx)(rt,Object(T.a)(Object(T.a)({},n),{},{config:n.config}));default:return Object(f.jsx)($e,Object(T.a)({},n))}}(t,e.device);return c&&Object(f.jsx)("div",{className:"device-control-group",children:c},n)}))})},dt=function(e){var t,n=e.groups.find((function(t){return t.name===e.activeGroupName}));if(!n)return Object(f.jsxs)("div",{children:["Group '",e.activeGroupName,"' not found."]});var c={device:e.device,settings:n.settings},o=(null===(t=e.device.settings)||void 0===t?void 0:t.layout)||"default",r=ut[o]||lt;return Object(f.jsx)(_e.a.Body,{className:"text-start device-dialog p-4",children:Object(f.jsx)(r,Object(T.a)({},c))})},ut={default:lt,binarySensorLayout:function(e){var t=Re(e),n=Pe(e);return Object(f.jsxs)("div",{className:"row custom-binary-layout",children:[Object(f.jsx)("div",{className:"col col-5 left",children:Object(f.jsx)("i",{className:"bi ".concat(t.iconClassName)})}),Object(f.jsxs)("div",{className:"col right flex-column justify-content-center",children:[Object(f.jsxs)("div",{className:"text-center",children:[Object(f.jsx)("div",{children:"Current status:"}),Object(f.jsx)("div",{className:t.valueClassName,children:t.valueTitle})]}),Object(f.jsxs)("div",{className:"text-center mt-3 w-100",children:[Object(f.jsxs)("div",{children:["Battery Level: ",Object(f.jsx)("span",{className:"status ".concat(n.stateClassName),children:n.valueTitle})]}),Object(f.jsx)("div",{className:"progress mt-3",children:Object(f.jsx)("div",{className:"progress-bar ".concat(n.stateClassName),role:"progressbar",style:{width:"".concat(n.valuePercents,"%")}})}),Object(f.jsx)("div",{className:"battery-icon",children:Object(f.jsx)("i",{className:"bi bi-battery-half ".concat(n.stateClassName)})})]})]})]})}},bt=function(){var e=Object(b.g)();return Object(a.useEffect)((function(){e.push("/devices"),S.b.error("Device information not found")}),[]),Object(f.jsx)(f.Fragment,{})},jt=function(){var e=Object(b.h)().ieee,t=Object(a.useState)(!0),n=Object(d.a)(t,2),c=n[0],o=n[1],r=Object(b.g)(),s=Object(v.c)((function(t){return ee(t,e)}),(function(e,t){if(!e||!t)return!1;var n=Object.keys(e.zespInfo.Report),c=Object.keys(t.zespInfo.Report);if(n.length!=c.length)return!1;for(var o=0,r=n;o<r.length;o++){var a=r[o];if(e.zespInfo.Report[a]!==t.zespInfo.Report[a])return!1}return!0}));if(!s)return Object(f.jsx)(bt,{});var i=z(s);if(!i||0===i.length)return console.warn("No controls found for '".concat(s.zespInfo.IEEE,"' device")),Object(f.jsx)(bt,{});var l=Object(a.useState)(i[0].name),u=Object(d.a)(l,2),j=u[0],p=u[1],m=function(){return o(!1)};return Object(f.jsxs)(_e.a,{show:c,onHide:m,onExited:function(){return setTimeout((function(){return r.push("/devices")}),100)},children:[Object(f.jsx)(ke,{groups:i,device:s,activeGroupName:j,setActiveGroupName:p,onCloseClicked:m,onDetailsClicked:function(){console.log(s),S.b.success("Check console for logs",{icon:"\ud83d\udc7d"})}}),Object(f.jsx)(dt,{groups:i,device:s,activeGroupName:j})]})},ft=n(5),pt=n(357),mt=n(36),vt=n.n(mt),ht={handleSubmit:function(e,t){e.preventDefault();var n,c={},o=Object(Ce.a)(vt()(e.target).find("input"));try{for(o.s();!(n=o.n()).done;){var r=n.value,a=vt()(r).prop("id");if(null==a)return;"checkbox"===vt()(r).prop("type")?!0===vt()(r).prop("checked")?c[a]=vt()(r).attr("checked_value")||"true":c[a]=vt()(r).attr("unchecked_value")||"false":c[a]=vt()(r).val()}}catch(s){o.e(s)}finally{o.f()}t(c)}},Ot=["onSubmit"],gt=function(e){var t=e.onSubmit,n=Object(ft.a)(e,Ot);return Object(f.jsx)(pt.a,Object(T.a)(Object(T.a)({onSubmit:function(e){return ht.handleSubmit(e,t)}},n),{},{children:e.children}))},xt=["getDeviceList","get_Mi_lamp","LoadJson|/location.json","LoadJson|/groups.json","LoadJson|/zesp_ui.json"],yt=["01 0000 01 0100","01 0000 01 0000"],Nt=function(){var e=Object(a.useState)([]),t=Object(d.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(""),r=Object(d.a)(o,2),s=r[0],i=r[1],l=Object(a.useState)(!1),u=Object(d.a)(l,2),b=u[0],j=u[1],p=Object(a.useRef)(n),m=Object(a.useRef)(b),v=function(e){if(!m.current){var t=[e.substr(0,250)].concat(Object(I.a)(p.current)),n=t.length-15;n>0&&t.splice(t.length-n,n),p.current=t,c(t)}},h=function(e){var t=e.target.innerText;i(t)},O=function(e){var t=e||s;K.ZespConnector.send({data:t,isBinary:!0})};return Object(a.useEffect)((function(){var e=K.ZespConnector.subscribe(ye,(function(e){var t=e.response;v(t)}));return function(){return K.ZespConnector.unsubscribe(e)}}),[]),Object(f.jsxs)(w,{children:[Object(f.jsx)(gt,{onSubmit:function(e){e.messageToSend&&(v(">".concat(e.messageToSend)),K.ZespConnector.send({data:e.messageToSend}))},children:Object(f.jsxs)(_.a,{children:[Object(f.jsx)(_.a.Header,{children:"WebSocket tester (FOR DEVELOPMENT ONLY)"}),Object(f.jsxs)(_.a.Body,{children:[Object(f.jsxs)("div",{className:"row mb-2",children:[Object(f.jsx)("label",{className:"col-md-3 col-lg-2",children:"Message to send"}),Object(f.jsx)("div",{className:"col",children:Object(f.jsx)("input",{type:"text",className:"form-control",id:"messageToSend",value:s,onChange:function(e){return i(e.target.value)}})})]}),Object(f.jsxs)("div",{className:"row",children:[Object(f.jsx)("div",{className:"col-md-3 col-lg-2"}),Object(f.jsxs)("div",{className:"col",children:[Object(f.jsx)("div",{children:xt.map((function(e,t){return Object(f.jsx)("button",{type:"submit",className:"btn btn-sm btn-outline-primary me-1",onClick:h,children:e},t)}))}),Object(f.jsx)("div",{className:"mt-1",children:yt.map((function(e,t){return Object(f.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary me-1",onClick:function(){i(e),O(e)},children:e},t)}))})]})]})]}),Object(f.jsxs)(_.a.Footer,{children:[Object(f.jsx)(Ae.a,{variant:"primary",type:"submit",children:"Send message"}),Object(f.jsx)(Ae.a,{variant:"secondary",type:"button",onClick:function(){return O()},className:"ms-2",children:"Send binary"})]})]})}),Object(f.jsxs)(_.a,{className:"mt-4",children:[Object(f.jsxs)(_.a.Header,{children:[Object(f.jsxs)("span",{children:["Communication log ",Object(f.jsx)("span",{className:"badge bg-secondary small",children:n.length})]}),Object(f.jsx)("button",{className:"btn btn-outline-secondary ms-3 btn-sm",onClick:function(){p.current=[],c([])},children:"Clear log"}),Object(f.jsx)("button",{className:"btn btn-outline-secondary ms-3 btn-sm",onClick:function(){return function(){var e=!m.current;m.current=e,j(e)}()},children:b?"Start logs":"Pause logs"})]}),Object(f.jsx)(_.a.Body,{children:n.map((function(e,t){return e.startsWith(">")?Object(f.jsx)("div",{className:"px-2 mb-3 py-1 m-1 bg-success bg-opacity-25 rounded",children:e.substr(1)},t):Object(f.jsx)("div",{className:"border-start mb-3 border-3 border-warning p-0 d-flex flex-wrap",children:e.split("|").map((function(e,t){return Object(f.jsx)("span",{className:"bg-warning bg-opacity-25 m-1 px-2 rounded",children:e},t)}))},t)}))})]})]})},St=function(e){var t=e.controlId,n=e.label,c=e.placeholder,o=e.defaultValue,r=e.type,a={placeholder:c,type:void 0===r?"text":r};return o&&(a=Object(T.a)(Object(T.a)({},a),{defaultValue:o.toString()})),Object(f.jsxs)(pt.a.Group,{as:Be.a,className:"mb-3",controlId:t,children:[Object(f.jsx)(pt.a.Label,{column:!0,md:"3",lg:"2",children:n}),Object(f.jsx)(at.a,{children:Object(f.jsx)(pt.a.Control,Object(T.a)({},a))})]})},wt=function(e){var t=e.controlId,n=e.label,c=e.defaultChecked,o=e.checkedValue,r=void 0===o?"true":o,a=e.uncheckedValue,s="true"===c||"1"===c||1===c||!0===c||!1,i={checked_value:r,unchecked_value:void 0===a?"false":a};return c&&(i=Object(T.a)(Object(T.a)({},i),{defaultChecked:s})),Object(f.jsx)(pt.a.Group,{controlId:t,className:"d-inline-block",children:Object(f.jsxs)(pt.a.Label,{className:"d-flex",children:[Object(f.jsx)(pt.a.Check,Object(T.a)({className:"pe-2"},i)),Object(f.jsx)("span",{children:n})]})})},It=function(){var e,t=Object(v.b)(),n=Object(v.c)(he),c=Object(j.a)(["pages.setup-mqtt","common"]).t;if(!n)return Object(f.jsx)("div",{children:"No settings found..."});var o=n.MQTT;return Object(f.jsx)(w,{children:Object(f.jsx)(_.a,{children:Object(f.jsxs)(gt,{onSubmit:function(e){return we({MQTT:e},n,t)},children:[Object(f.jsxs)(_.a.Body,{children:[Object(f.jsx)(St,{controlId:"mqttup",defaultValue:o.mqttup,label:c("topic.label"),placeholder:c("topic.placeholder")}),Object(f.jsx)(St,{controlId:"mqtt",defaultValue:o.mqtt,label:c("server.label"),placeholder:c("server.placeholder")}),Object(f.jsx)(St,{controlId:"mqttPort",defaultValue:null===(e=o.mqttPort)||void 0===e?void 0:e.toString(),label:c("port.label"),placeholder:c("port.placeholder")}),Object(f.jsx)(St,{controlId:"mqttLogin",defaultValue:o.mqttLogin,label:c("login.label"),placeholder:c("login.placeholder")}),Object(f.jsx)(St,{type:"password",controlId:"mqttPassw",defaultValue:o.mqttPassw,label:c("password.label"),placeholder:c("password.placeholder")}),Object(f.jsxs)(Be.a,{children:[Object(f.jsx)(at.a,{md:"3",lg:"2"}),Object(f.jsxs)(at.a,{className:"space-between-4",children:[Object(f.jsx)(wt,{controlId:"mqttEnable",defaultChecked:o.mqttEnable,label:c("is_enabled.label"),checkedValue:1,uncheckedValue:0}),Object(f.jsx)(wt,{controlId:"Home_Assistant",defaultChecked:o.Home_Assistant,label:c("is_ha_enabled.label"),checkedValue:1,uncheckedValue:0})]})]})]}),Object(f.jsx)(_.a.Footer,{children:Object(f.jsx)(Ae.a,{variant:"primary",type:"submit",children:c("common:save_button")})})]})})})},_t=function(){return Object(f.jsx)(w,{children:Object(f.jsx)("div",{className:"px-4 py-5 bg-light rounded-3",children:Object(f.jsxs)("div",{className:"container-fluid",children:[Object(f.jsx)("h1",{className:"display-5 fw-bold",children:"Not implemented yet!"}),Object(f.jsxs)("p",{className:"col-md-8 fs-4",children:["Hello, my dear friend! Just imagine how awesome this feature can be and share it with developers ~_~ ",Object(f.jsx)("br",{}),Object(f.jsx)("br",{}),"Or you can even implement it yourself, everything you need is just to jump to source codes, made some magic, test it and that's it!"]}),Object(f.jsx)("hr",{className:"my-4"}),Object(f.jsxs)("p",{children:["This feature is under contruction. You can find latest verion on ",Object(f.jsx)("a",{href:"#",children:"github project page"})," or just click this big blue button bellow."]}),Object(f.jsx)("a",{href:"#",target:"_blank",rel:"noreferrer",className:"btn btn-primary btn-lg",type:"button",children:"Learn more"})]})})})},kt=function(){var e=Object(v.b)(),t=Object(v.c)(he),n=Object(j.a)(["pages.setup-wifi","common"]).t;if(!t)return Object(f.jsx)("div",{children:"No settings found..."});var c=t.Wifi;return Object(f.jsx)(a.Fragment,{children:Object(f.jsx)(w,{children:Object(f.jsx)(gt,{onSubmit:function(n){return we({Wifi:n},t,e)},children:Object(f.jsxs)(_.a,{children:[Object(f.jsxs)(_.a.Body,{children:[Object(f.jsx)(St,{controlId:"ssid",defaultValue:null===c||void 0===c?void 0:c.ssid,label:n("ssid.label"),placeholder:n("ssid.placeholder")}),Object(f.jsx)(St,{type:"password",controlId:"pass",defaultValue:null===c||void 0===c?void 0:c.pass,label:n("pass.label"),placeholder:n("pass.placeholder")}),Object(f.jsx)(St,{controlId:"ip",defaultValue:null===c||void 0===c?void 0:c.ip,label:n("ip.label"),placeholder:n("ip.placeholder")}),Object(f.jsx)(St,{controlId:"mask",defaultValue:null===c||void 0===c?void 0:c.mask,label:n("mask.label"),placeholder:n("mask.placeholder")}),Object(f.jsx)(St,{controlId:"gw",defaultValue:null===c||void 0===c?void 0:c.gw,label:n("gw.label"),placeholder:n("gw.placeholder")})]}),Object(f.jsx)(_.a.Footer,{children:Object(f.jsx)(Ae.a,{variant:"primary",type:"submit",children:n("common:save_button")})})]})})})})},Ct=Object(h.b)({name:"zesp",initialState:{connectionStatus:"disconnected",initialized:!1},reducers:{setConnected:function(e){e.connectionStatus="connected"},setDisconnected:function(e){e.connectionStatus="disconnected"},setInitialized:function(e,t){e.initialized=t.payload}}}),Et=function(e){return e.zesp.connectionStatus},Tt=function(e){return e.zesp.initialized},zt=Ct.actions,Ft=zt.setConnected,Rt=zt.setDisconnected,Pt=zt.setInitialized,Lt=Ct.reducer,Bt=function(){var e=Object(v.c)(Tt),t=Object(v.b)();return e?(setTimeout((function(){return t(x(!1))}),300),Object(f.jsxs)(a.Fragment,{children:[Object(f.jsx)(b.b,{exact:!0,path:"/",children:Object(f.jsx)(b.a,{to:"/devices"})}),Object(f.jsx)(b.b,{path:"/devices",component:be}),Object(f.jsx)(b.b,{path:"/devices/:ieee",component:jt}),Object(f.jsx)(b.b,{path:"/setup",component:Ie}),Object(f.jsx)(b.b,{exact:!0,path:"/setup",component:kt}),Object(f.jsx)(b.b,{path:"/setup/mqtt",component:It}),Object(f.jsx)(b.b,{path:"/setup/zigbee",component:_t}),Object(f.jsx)(b.b,{path:"/setup/telegram",component:_t}),Object(f.jsx)(b.b,{path:"/setup/z2m",component:_t}),Object(f.jsx)(b.b,{path:"/setup/zesp-ui",component:_t}),Object(f.jsx)(b.b,{path:"/socket-test",component:Nt})]})):(setTimeout((function(){return t(x(!0))}),0),Object(f.jsx)(a.Fragment,{}))},Mt=(n(117),function(e){var t=Object(j.a)("pages.welcome").t,n=e.servers.map((function(e,t){return{server:e,index:t}})).sort((function(e,t){return e.server.name>t.server.name?1:-1}));return Object(f.jsx)("div",{className:"container welcome-page h-100",children:Object(f.jsx)(w,{children:Object(f.jsxs)(_.a,{className:"text-start",children:[Object(f.jsx)(_.a.Header,{children:t("list.title")}),Object(f.jsxs)(_.a.Body,{children:[0==e.servers.length&&Object(f.jsx)("div",{children:t("list.add_message")}),e.servers.length>0&&Object(f.jsx)("nav",{className:"servers-list",children:n.map((function(t,n){return Object(f.jsxs)("div",{className:"item",children:[Object(f.jsxs)(u.b,{className:"server-button",to:"/",onClick:function(n){e.openServerAction(t.index),n.preventDefault()},activeClassName:"none",children:[Object(f.jsx)("i",{className:"bi bi-caret-right-fill"})," ",t.server.name]}),Object(f.jsx)("button",{type:"button",onClick:function(){return e.openEditAction(t.server)},className:"edit-button",children:Object(f.jsx)("i",{className:"bi bi-pencil-fill"})})]},"item-".concat(n))}))})]}),Object(f.jsx)(_.a.Footer,{className:"text-right",children:Object(f.jsx)("button",{type:"button",onClick:e.openAddServer,className:"btn btn-primary",children:t("list.add_button")})})]})})})}),At=n(173),Zt=n(360),Dt=n(354),Vt=function(e){var t,n,c=Object(j.a)("pages.welcome").t,o=Object(a.useState)(!1),r=Object(d.a)(o,2),s=r[0],i=r[1],l=Object(f.jsxs)(At.a,{id:"popover-basic",children:[Object(f.jsx)(At.a.Header,{as:"h3",children:c("edit.delete_title")}),Object(f.jsx)(At.a.Body,{children:Object(f.jsx)("span",{dangerouslySetInnerHTML:{__html:c("edit.delete_message")}})})]});return Object(f.jsx)("div",{className:"container welcome-page h-100",children:Object(f.jsx)(w,{children:Object(f.jsx)(gt,{onSubmit:function(t){return e.editServer?e.updateAction(t):e.addAction(t),Promise.resolve()},children:Object(f.jsxs)(_.a,{className:"text-start",children:[Object(f.jsxs)(_.a.Header,{className:"d-flex justify-content-between",children:[Object(f.jsx)("span",{className:"modal-title",children:c("edit.title")}),Object(f.jsx)("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:e.closeAction})]}),Object(f.jsxs)(_.a.Body,{children:[Object(f.jsx)(Je.a,{className:"mb-2",id:"name",defaultValue:null===(t=e.editServer)||void 0===t?void 0:t.name,placeholder:c("edit.name_input_placeholder")}),Object(f.jsxs)(Zt.a,{children:[Object(f.jsxs)(Zt.a.Text,{id:"basic-addon3",children:["https:"===document.location.protocol?"wss":"ws","://"]}),Object(f.jsx)(Je.a,{id:"address",defaultValue:null===(n=e.editServer)||void 0===n?void 0:n.address,"aria-describedby":"basic-addon3",placeholder:c("edit.address_input_placeholder")})]})]}),e.editServer&&Object(f.jsxs)(_.a.Footer,{className:"d-flex justify-content-between",children:[Object(f.jsx)("div",{children:Object(f.jsx)(Dt.a,{trigger:"click",placement:"top",overlay:l,rootClose:!0,onToggle:i,children:Object(f.jsx)("button",{onClick:function(){s&&e.deleteAction()},type:"button",className:"btn btn-outline-danger",children:c("edit.delete_button")})})}),Object(f.jsx)("button",{type:"submit",className:"btn btn-primary",children:c("edit.save_button")})]}),!e.editServer&&Object(f.jsx)(_.a.Footer,{className:"text-right",children:Object(f.jsx)("button",{type:"submit",className:"btn btn-primary",children:c("edit.add_button")})})]})})})})},Jt=function(e){var t=Object(a.useState)("welcome"),n=Object(d.a)(t,2),c=n[0],o=n[1],r=Object(a.useState)(),s=Object(d.a)(r,2),i=s[0],l=s[1],u=We("servers",[]),b=Object(d.a)(u,2),j=b[0],p=b[1],m=function(){l(void 0),o("welcome")};return"edit"===c?Object(f.jsx)(Vt,{editServer:i,addAction:function(e){j.push(e),p(j),m()},updateAction:function(e){var t=j.indexOf(i);j[t]=e,p(j),console.log(j),m()},closeAction:m,deleteAction:function(){p(j.filter((function(e){return e!==i}))),m()}}):Object(f.jsx)(Mt,{servers:j,openAddServer:function(){l(void 0),o("edit")},openEditAction:function(e){l(e),o("edit")},openServerAction:function(t){return e.setServerIndex(t)}})},qt=n(171),Kt=function(e){var t=Wt(Ee,e),n=Wt(Te,e);if(t&&n&&Ut(["battery"],n)&&Ut(["door","motion"],t))return console.debug("Auto detected layout 'binarySensorLayout' for '".concat(e.IEEE,"'")),"binarySensorLayout"},Ut=function(e,t){var n=t.role&&t.role.split("&");if(n.length<2)return!1;var c=JSON.parse(n[1]).device_class;return!!c&&e.indexOf(c)>=0},Wt=function(e,t){var n,c=Object(Ce.a)(e);try{for(c.s();!(n=c.n()).done;){var o=n.value,r=t.Report[o];if(r)return r}}catch(a){c.e(a)}finally{c.f()}},Ht={getDevicesListAsync:function(e){return new Promise((function(t,n){e.requestAsync({data:"getDeviceList",responseValidator:xe("alldev")}).then((function(e){var n=Gt(e);t(n)})).catch((function(e){return n(e)}))}))}},Gt=function(e){var t=e.dataParts[0],n=[];return Object.assign(n,JSON.parse(t)),n.map(Yt)},Qt=function(e){var t=qt.find((function(t){return t.modelIds.findIndex((function(t){return t===e}))>=0}))||{};return{settings:t,controls:(null===t||void 0===t?void 0:t.controls)&&n(342)("./".concat(t.controls))||[]}},Yt=function(e){var t=Qt(e.ModelId),n=t.settings,c=t.controls;c.forEach((function(t){if(t.reportKey){var n=t.reportKey.endpoint+t.reportKey.clusterId+t.reportKey.attributeId;e.Report[n]||(e.Report[n]={})}}));var o=n.layout||Kt(e);return{zespInfo:e,settings:Object(T.a)(Object(T.a)({},n),{layout:o}),customLayout:c}},$t=Ht,Xt=function(e,t){e.subscribe(xe("rep"),(function(e){return en(e,t)}))},en=function(e,t){if(e.dataParts.length<2)return console.warn("Unknown format of updated received"),void console.warn(e.response);var n=e.dataParts[1],c=JSON.parse(e.dataParts[0]);t(n,c.EndPoint+c.ClusterId+c.AttribId,{parsed:c.parsed,val:c.Data})},tn=function(e){return new Promise((function(t,n){e.requestAsync({data:"get_Mi_lamp",responseValidator:xe("Mi_lamp")}).then((function(e){var c=nn(e);c?t(c):n("Cannot update root device information")})).catch((function(e){return n(e)}))}))},nn=function(e){var t,n,c,o,r,a,s,i=Qt("ZESP_Root").controls;if(0==i.length)return{};var l=JSON.parse(e.dataParts[0]),d={},u=null===(t=i.find((function(e){return"on_off_root"===e.id})))||void 0===t?void 0:t.reportKey;u?d[u.endpoint+u.clusterId+u.attributeId]={val:l.on.toString()}:console.warn("Root device report 'on_off_root' not found");var b=null===(n=i.find((function(e){return"level_root"===e.id})))||void 0===n?void 0:n.reportKey;b?d[b.endpoint+b.clusterId+b.attributeId]={val:l.level.toString()}:console.warn("Root device report 'level_root' not found");var j=null===(c=i.find((function(e){return"rgb_root"===e.id})))||void 0===c?void 0:c.reportKey;j?d[j.endpoint+j.clusterId+j.attributeId]={val:"".concat(l.B,":").concat(l.G,":").concat(l.R)}:console.warn("Root device report 'rgb_root' not found");var f=null===(o=i.find((function(e){return"level_control"===e.id})))||void 0===o?void 0:o.reportKey;f?d[f.endpoint+f.clusterId+f.attributeId]={val:l.sound.volume.toString()}:console.warn("Root device report 'level_control' not found");var p=null===(r=i.find((function(e){return"player_src_root"===e.id})))||void 0===r?void 0:r.reportKey;p?d[p.endpoint+p.clusterId+p.attributeId]={val:null===(a=l.sound.current_path)||void 0===a?void 0:a.toString()}:console.warn("Root device report 'player_src_root' not found");var m=null===(s=i.find((function(e){return"player_control_root"===e.id})))||void 0===s?void 0:s.reportKey;return m?d[m.endpoint+m.clusterId+m.attributeId]={val:l.sound.play.toString()}:console.warn("Root device report 'player_control_root' not found"),d},cn=function(e){var t=Object(v.b)();return"connected"===Object(v.c)(Et)||K.ZespConnector.connectAsync(e.server,(function(e){return t(e?Ft():Rt())})).then((function(e){return new Promise((function(n,c){$t.getDevicesListAsync(e).then((function(c){t(ce(c)),n(e)})).catch((function(e){return c(e)}))}))})).then((function(e){return new Promise((function(n,c){tn(e).then((function(c){t(re(c)),n(e),console.debug("Root device reports updated")})).catch((function(e){return c(e)}))}))})).then((function(e){Xt(e,(function(e,n,c){t(oe({ieee:e,reportKey:n,update:c}))}))})).then((function(){return t(Pt(!0))})).catch((function(e){return console.error(e)})).finally((function(){return console.debug("ZESP initialization completed")})),Object(f.jsx)(a.Fragment,{})},on=function(){var e=Object(a.useState)(null),t=Object(d.a)(e,2),n=t[0],c=t[1],o=window.localStorage.getItem("servers"),r=o&&JSON.parse(o)||[],s=null===n||r.length<=n?null:r[n];return s?Object(f.jsx)(rn,{server:s}):Object(f.jsx)(Jt,{setServerIndex:c})},rn=function(e){return console.debug("App starting..."),Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(cn,{server:e.server}),Object(f.jsxs)("div",{className:"container-md d-flex w-100 h-100 p-3 mx-auto flex-column",children:[Object(f.jsxs)("header",{className:"masthead",children:[Object(f.jsx)("a",{href:"/",children:Object(f.jsx)("h3",{className:"masthead-brand",children:"ZESP:UI"})}),Object(f.jsx)(p,{})]}),Object(f.jsx)("main",{role:"main",className:"text-start d-flex flex-grow-1 flex-column",children:Object(f.jsx)(Bt,{})}),Object(f.jsx)("footer",{className:"mastfoot mt-3",children:Object(f.jsxs)("p",{children:["ZESP UI application, by ",Object(f.jsx)("a",{href:"https://t.me/NickRimmer",target:"_blank",rel:"noreferrer",children:"@NickRimmer"}),". (0.0.0 version, ",Object(f.jsx)("span",{children:"dev build"}),")"]})})]})]})},an=function(){return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(u.a,{children:Object(f.jsx)(b.d,{children:Object(f.jsx)(on,{})})}),Object(f.jsx)(N,{}),Object(f.jsx)(S.a,{})]})},sn=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,361)).then((function(t){var n=t.getCLS,c=t.getFID,o=t.getFCP,r=t.getLCP,a=t.getTTFB;n(e),c(e),o(e),r(e),a(e)}))},ln=Object(h.a)({reducer:{zesp:Lt,devices:ae,spinner:y,settings:ge}});l.a.render(Object(f.jsx)(s.a.StrictMode,{children:Object(f.jsx)(v.a,{store:ln,children:Object(f.jsx)(an,{})})}),document.getElementById("root")),sn()},82:function(e){e.exports=JSON.parse('[{"clusterId":"0000","name":"Basic"},{"clusterId":"0006","name":"On_Off","attributes":{"0000":{"id":"on_off_control","commandOn":"cmd_on|...","commandOff":"cmd_off|..."}}},{"clusterId":"0008","name":"Level_Control"},{"clusterId":"0106","name":"Illuminance"},{"clusterId":"0300","name":"Color_Control"},{"clusterId":"0406","name":"Occupancy_Sensing"},{"clusterId":"BBBB","name":"Custom"}]')},98:function(e,t,n){"use strict";n.r(t);var c=n(94),o=n(58),r=["en"],a=["common","nav","pages.setup-mqtt","pages.setup-wifi","pages.welcome","pages.devices"];c.a.use(o.e).init({fallbackLng:r[0],lng:r[0],resources:function(){for(var e={},t=0,c=r;t<c.length;t++){var o=c[t];e[o]={};for(var s=0,i=a;s<i.length;s++){var l=i[s],d="./locales/".concat(o,"/").concat(l.replace(".","/"),".json");try{e[o][l]=n(202)(""+d),console.debug("".concat(d," (ok)"))}catch(u){console.debug("".concat(d," (error)"))}}}return e}(),ns:a,defaultNS:"common"}),c.a.languages=r,t.default=c.a}},[[343,1,2]]]);
//# sourceMappingURL=main.031a7f8b.chunk.js.map