{"version":3,"sources":["i18n/config.js","loader.js","i18n sync /^.*$","data/controls sync /^/.//.*$","store/slices/spinnerSlice.tsx","shared/loading-spinner/index.tsx","shared/fadein-transition/index.tsx","store/slices/zespSlice.tsx","services/zesp/common/ZespResponseValidators.tsx","services/deviceControls.tsx","device-controls/root/OnOffRoot.tsx","device-controls/root/LevelRoot.tsx","services/localStorage.tsx","device-controls/root/RgbRoot.tsx","shared/transition/index.tsx","shared/transition/HighlightOnUpdate.tsx","device-controls/unknown.tsx","device-controls/sensors/IlluminanceSensor.tsx","device-controls/controls/LevelControl.tsx","device-controls/root/PlayerSrcRoot.tsx","device-controls/sensors/OnOffBinarySensor.tsx","device-controls/sensors/ValueSensor.tsx","device-controls/controls/OnOffToggle.tsx","device-controls/index.tsx","device-controls/layouts/DefaultLayout.tsx","device-controls/layouts/binary-sensor/index.tsx","device-controls/layouts/index.tsx","device-controls/layouts/ble-beacon/index.tsx","device-controls/layouts/binary-sensor/auto.tsx","device-controls/layouts/ble-beacon/auto.tsx","services/zesp/service-devices.tsx","store/slices/devicesSlice.tsx","store/slices/zespFirmwareSlice.tsx","services/zesp/service-root.tsx","services/zesp/zespSettings.hook.tsx","services/zesp/service-firmware.tsx","models/UiSettings.tsx","store/slices/settingsSlice.tsx","services/zesp/service-report-updates.tsx","shared/agents/ZespAgent.hook.tsx","services/zesp/common/Constants.tsx","services/zesp/common/ZespDataEvent.tsx","services/zesp/common/service-connector.tsx","shared/agents/ZespAgent.tsx","services/devices.tsx","pages/devices/hook.tsx","pages/devices/item-image.tsx","pages/devices/item.tsx","shared/app-dialog/index.tsx","pages/devices/add-zigbee-dialog/index.tsx","pages/devices/add-zigbee-dialog/hook.tsx","pages/devices/add-buttons/index.tsx","pages/devices/add-buttons/hook.tsx","pages/devices/index.tsx","pages/setup/index.tsx","pages/device-info/hook.tsx","pages/device-info/header.tsx","pages/device-info/body.tsx","pages/device-info/not-found.tsx","shared/device-settings-dialog/index.tsx","shared/device-settings-dialog/hook.tsx","pages/device-info/index.tsx","shared/form/react-form/logic.tsx","shared/form/react-form/index.tsx","pages/socket-test/index.tsx","shared/form/input-group-horizontal.tsx","shared/form/checkbox-group-inline.tsx","pages/setup/mqtt.tsx","pages/setup/not-implemented-yet.tsx","pages/setup/wifi.tsx","pages/device-template/hook.tsx","shared/error-message/index.tsx","pages/device-template/device-template-report/hook.tsx","pages/device-template/device-template-report/index.tsx","pages/device-template/device-report-settings/index.tsx","pages/device-template/device-template-editor/index.tsx","pages/device-template/index.tsx","Routes.tsx","shared/footer/AppFooter.tsx","shared/power-dialog/index.tsx","shared/top-menu/index.tsx","shared/updates-notification/UpdatesNotificationDialog.tsx","shared/updates-notification/UpdatesNotification.tsx","shared/header/index.tsx","App.tsx","reportWebVitals.ts","store/configure.tsx","index.tsx"],"names":["languages","namespaces","i18n","use","initReactI18next","init","fallbackLng","lng","resources","result","lang","ns","path","replace","require","error","console","debug","loadResources","defaultNS","map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","initialState","spinnerShow","spinnerMessage","spinnerSlice","createSlice","name","reducers","setSpinnerShow","state","action","payload","setSpinner","show","message","getSpinner","spinner","actions","CustomSpinner","Modal","centered","size","backdrop","Body","className","Spinner","animation","variant","LoadingSpinner","useSelector","useState","setShow","showTimerRef","useRef","useEffect","current","clearTimeout","undefined","setTimeout","FadeIn","props","setClassName","children","zespSlice","connectionStatus","initialized","setConnectionStatus","setInitialized","getStatus","zesp","getInitialized","JsonZespResponseValidator","fileName","isValid","event","dataType","responseFileName","dataParts","exec","TypedZespResponseValidator","ReportZespResponseValidator","deviceId","endpointId","clusterId","attributeId","length","response","JSON","parse","ShortAddr","EndPoint","ClusterId","AttribId","AllMessagesZespResponseValidator","DeviceControls","config","reportKey","deviceInfo","zespInfo","IEEE","endpoint","Report","layoutId","settings","customLayout","find","x","OnOffRoot","zespSend","useContext","ZespContext","report","Row","ButtonGroup","Button","val","toString","onClick","data","arguments","commandOn","isBinary","commandOff","LevelRoot","currentValue","Number","max","min","value","setValue","minMaxAttributes","inRange","Math","FormControl","style","width","type","onChange","command","inputChangeHandler","target","FormRange","onMouseUp","useLocalStorage","key","initialValue","readValue","window","item","localStorage","getItem","warn","storedValue","setStoredValue","handleStorageChange","addEventListener","removeEventListener","newValue","Function","setItem","stringify","dispatchEvent","Event","RgbRoot","split","r","g","b","color","setColor","colorPicker","setColorPicker","colorChangeHandler","rgb","rgbToXY","y","colorPickerButton","onChangeComplete","triangle","red","pow","green","blue","X","Y","Z","isNaN","toFixed","Transition","onRefresh","classNameFrom","onLoad","classNameTo","timeOutMs","HighlightOnUpdate","UnknownControl","showDetails","setShowDetails","configData","reportData","label","parsed","trim","roleParts","role","roleSettings","units","preventDefault","href","title","NoReport","IlluminanceSensor","parseInt","LevelControl","sendValueToZesp","formatCommand","Device","PlayerSrcRoot","srcReport","playSettings","playReport","toast","src","setSrc","play","setPlay","list","placeholder","icon","i","OnOffBinarySensor","payloadOn","zespRoleSettings","ValueSensor","unit","OnOffToggle","applyTemplate","template","commandToggle","DeviceControlCol1","Col","md","DeviceControlCol2","DefaultLayout","controls","unknown","forEach","control","controlProps","element","getControlForDevice","device","push","showUnknown","setShowUnknown","reportKeysValue","reportKeysBattery","deviceClasses","batteryValuesRange","getValueSettings","onOffReport","getReport","iconClassName","icons","onFalse","valueClassName","valueTitle","statusValue","status","deviceClass","valueSettings","onTrue","styles","titles","getBatterySettings","stateClassName","valuePercents","valueString","valueNumber","round","oneOfKeys","layoutsAvailable","default","binarySensorLayout","battery","bleBeacon","isInRange","signalLevel","lastUpdateMs","time","lastDate","Date","calculateRelative","now","relative","setRelative","timer","setInterval","clearInterval","lastUpdateStyle","rangeStyle","toLocaleDateString","toLocaleTimeString","autoDetectors","valueReportKey","layoutTools","binarySensorValueKeys","batteryReportKey","binarySensorBatteryKeys","roleDeviceClassIs","DevType","class","rangeReport","signalReport","autoDetect","layout","autoDetector","expectedDeviceClasses","reportDeviceClass","indexOf","ServiceDevices","getDevicesListAsync","Promise","reject","zespRequestAsync","responseValidator","then","onDevicesListReceived","devices","zespVersion","catch","reason","subscribeListUpdate","onUpdateHandler","subscribe","jsonString","zespDevices","assign","buildDeviceInfo","getDeviceModelSettings","modelId","predefinedDevices","modelIds","findIndex","ModelId","devicesSlice","setDevices","updateDevices","root","updateWithoutRoot","filter","updateDevice","deviceIndex","updateZespInfo","updateReport","ieee","update","updateRootReports","updateReportsOrder","orderedReportKeys","reduce","a","getDeviceByIee","getAllDevices","zespFirmwareUpdateInfo","zespFirmwareInstalledVersion","zespSkipVersion","zespFirmwareSlice","setZespFirmwareUpdate","setZespFirmwareInstalledVersion","getZespFirmwareUpdateInfo","zespFirmware","getZespFirmwareInstalledVersion","extractReports","reportOnOff","on","reportLevel","level","reportRgb","B","G","R","volumeLevel","sound","volume","srcRadio","current_path","playControl","useZespSettings","setCustom","dataStr","getAsync","json","parseResponse","setAsync","join","toLocaleLowerCase","getCustomAsync","jsonStr","setUiSettings","timeoutSeconds","updates","currentVersion","updatesInformation","UiDefaultSettings","zespSettings","uiSettings","settingsSlice","setZespSettings","getZespSettings","getUiSettings","onReport","onUpdate","Data","useZespAgent","dispatch","uiSettingsRef","connectAsync","server","getDevices","getRoot","ServiceRoot","reports","readUiSettings","readFirmwareUpdates","firmwareUpdate","firmwareLastCheck","ServiceFirmware","firmwareInfo","subscribeReportUpdates","ServiceUpdates","subscribeDevicesListUpdate","Result","ConnectionStartTimeout","RestartConnectionTimeout","DefaultRequestTimeoutSeconds","WatcherIntervalSeconds","ZespDataEventType","ZespDataEvent","useZespConnector","_server","_onMessageEvent","EventTarget","_ws","_lastMessageTimestamp","_watcher","_onMessageReceived","ws","messageParts","messageType","shift","unshift","resultEvent","_runWatcher","zespStatusChangeHandler","underlyingWebsocket","readyState","Constants","args","dataHex","replaceAll","match","group","Uint8Array","_getBinaryData","send","responseReceived","validator","listener","force","close","_tryToCloseWS","protocol","document","location","serverAddress","address","WebsocketBuilder","onOpen","onClose","onError","onMessage","build","_tryConnectWs","handler","zespEvent","unsubscribe","getServerAddress","React","createContext","ZespAgent","useDispatch","zespStatus","setZesp","_restartTimerRef","Provider","finally","Devices","buildLayoutSettingsFromZesp","groupName","deviceType","substr","reportKeyInfo","registeredCluster","DataHaClusterIds","buildLayoutItemForRole","attributes","getLayoutItem","dataCluster","roleName","layoutItem","devicesUpdateDetector","Name","devicesSorting","buildListItem","image","getImageUrl","tags","getTagsFromReports","process","Img","reportKeyDetails","clusterInfo","HomeAutoClusters","sort","setImage","testImage","Image","onerror","backgroundImage","detailsLink","xs","sm","lg","xxl","to","AppDialog","footer","forceClose","onShow","onHide","onClosed","onSubmit","onHideHandler","Header","Footer","onExited","Form","AddZigbeeDialog","logs","setLogs","logRef","isCompleted","setIsCompleted","isCompletedRef","joinListenerRef","allDevListenerRef","onJoinReceivedHandler","onAllDevReceivedHandler","stopPairing","stopListening","includes","messages","onChannelChangedHandler","channel","useHook","channels","Select","currentTarget","ProgressBar","animated","striped","dangerouslySetInnerHTML","__html","AddDeviceButton","showDialog","setShowDialog","onAddZigbeeClickedHandler","onAddBleClickedHandler","success","DropdownButton","Dropdown","Item","deviceItems","t","useTranslation","Card","SaveSettings","updatedSettings","alert","Container","Nav","exact","deviceUpdateDetector","keysA","keysB","Location","deleteConfirmed","setDeleteConfirmed","headerClassName","groups","headerContent","activeGroupName","setActiveGroupName","popover","Popover","as","Toggle","Menu","onSettingsHandler","onReportsHandler","OverlayTrigger","trigger","placement","overlay","rootClose","onToggle","onDeleteDeviceHandler","Divider","onDebugDeviceHandler","onCloseClickHandler","layoutProps","layoutName","LayoutElements","history","useHistory","DeviceSettingsDialog","setForceClose","onCancelHandler","onSaveHandler","toLowerCase","setName","setLocation","Group","Label","column","Control","useParams","showSettings","setShowSettings","autoExit","setAutoExit","_returnBack","onExitHandler","log","duration","onSettingsClosedHandler","headerHandlers","handleSubmit","inputs","getElementsByTagName","input","getNamedItem","checked","ReactForm","restProps","$","predefinedMessages","predefinedBinary","_setMessages","messageSendValue","setMessageSendValue","paused","_setPaused","repsPaused","_setRepsPaused","messagesRef","pausedRef","repsPausedRef","addMessages","startsWith","cutCount","splice","onSendPredefined","innerText","onSendBinary","messageToSend","togglePause","toggleRepsPause","i2","controlId","defaultValue","inputProps","defaultChecked","checkedValue","uncheckedValue","defaultCheckedBool","checked_value","unchecked_value","Check","allSettings","MQTT","mqttup","mqtt","mqttPort","mqttLogin","mqttPassw","mqttEnable","Home_Assistant","rel","Wifi","ssid","pass","ip","mask","gw","ErrorMessage","fontSize","DeviceTemplateReportHook","showSettingsHandler","keyInfo","attributeInfo","editHandler","reportInfo","DeviceTemplateReport","hook","playHandler","onMoveReport","deleteHandler","DeviceReportSettings","onSave","setLabel","setRole","mat","setMat","roleDataList","isInvalid","DeviceTemplateEditor","onAddReport","cluster","setCluster","attribute","setAttribute","setAttributes","readData","setReadData","showAll","setShowAll","sendButtonDisabled","setSendButtonDisabled","readDataMessage","setReadDataMessage","showAddSettings","setShowAddSettings","alignTimers","endpointClusters","EP","entries","clusters","ClO","ClI","responseDataTypes","ResponseDataTypes","alignSelected","lists","getElementsByClassName","delay","listGroup","activeElement","scrollIntoView","behavior","block","readingDataBegin","Dtype","readOnly","disabled","ListGroup","vertical","active","attributeParts","FormGroup","FormLabel","FormCheckInput","DeviceTemplatePage","setTemplate","setStatus","onSaveReportSettings","updatedReports","updatedTemplate","onDelete","moveReport","amount","reportKeys","currentIndex","newIndex","tmp","changeDeviceHandler","Routes","isInitialized","component","DevicesPage","DeviceInfoPage","SetupPage","SetupWifiPage","SetupMqttPage","NotImplementedYetPage","SocketTestPage","AppFooter","PowerDialogLink","navLink","buttons","UpdatesNotificationDialog","zespFirmwareUpdate","zespFirmwareCurrentVersion","SettingsService","zespFirmwareUpdateVersion","updateData","firmwareSkipUpdate","UpdatesNotification","zespCurrentVersion","AppHeader","Content","selfHostedServer","REACT_APP_SELF_HOSTED_DEV","hostname","App","reportWebVitals","onPerfEntry","getCLS","getFID","getFCP","getLCP","getTTFB","store","configureStore","reducer","zespReducer","devicesReducer","spinnerReducer","settingsReducer","zespFirmwareReducer","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.370cb5a9.chunk.js","sourcesContent":["import i18n from \"i18next\";\nimport {initReactI18next} from \"react-i18next\";\n\nconst languages = [\"en\"];\nconst namespaces = [\n    \"common\",\n    \"nav\",\n    \"pages.setup-mqtt\",\n    \"pages.setup-wifi\",\n    \"pages.welcome\",\n    \"pages.devices\",\n];\n\nconst i18next = i18n.use(initReactI18next);\ni18next.init({\n    fallbackLng: languages[0],\n    lng: languages[0],\n    resources: loadResources(),\n    ns: namespaces,\n    defaultNS: 'common'\n});\ni18n.languages = languages;\n\nfunction loadResources() {\n    const result = {};\n\n    for (let lang of languages) {\n        result[lang] = {};\n\n        for (let ns of namespaces) {\n            const path = `./locales/${lang}/${ns.replace(\".\", \"/\")}.json`;\n            try {\n                // eslint-disable-next-line \n                result[lang][ns] = require('' + path); // wtf with JS???\n              // console.debug(`${path} (ok)`);\n            } catch (error) {\n                // it's ok\n                console.debug(`${path} (error)`);\n            }\n        }\n    }\n\n    return result;\n}\n\nexport default i18n;","// window.$ = window.jQuery = require('jquery')\n\nif (process.env.NODE_ENV !== \"development\") console.debug = () => {\n  // show info for dev environment only\n  // console.log(\"Debug logs are disabled\");\n};","var map = {\n\t\"./config\": 121,\n\t\"./config.js\": 121,\n\t\"./locales/en/common\": 146,\n\t\"./locales/en/common.json\": 146,\n\t\"./locales/en/nav\": 147,\n\t\"./locales/en/nav.json\": 147,\n\t\"./locales/en/pages/devices\": 148,\n\t\"./locales/en/pages/devices.json\": 148,\n\t\"./locales/en/pages/setup-mqtt\": 149,\n\t\"./locales/en/pages/setup-mqtt.json\": 149,\n\t\"./locales/en/pages/setup-wifi\": 150,\n\t\"./locales/en/pages/setup-wifi.json\": 150,\n\t\"./locales/en/pages/welcome\": 151,\n\t\"./locales/en/pages/welcome.json\": 151\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 228;","var map = {\n\t\"./root\": 177,\n\t\"./root.json\": 177\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 348;","import {createSlice, PayloadAction} from \"@reduxjs/toolkit\";\nimport {RootState} from \"../configure\";\n\ninterface IState {\n  spinnerShow: boolean,\n  spinnerMessage: string,\n}\n\nconst initialState: IState = {\n  spinnerShow: false,\n  spinnerMessage: \"Loading...\",\n}\n\nexport const spinnerSlice = createSlice({\n  name: \"spinner\",\n  initialState,\n  reducers: {\n    setSpinnerShow: (state, action: PayloadAction<boolean>): void => {\n      state.spinnerShow = action.payload;\n      if (state.spinnerShow) state.spinnerMessage = initialState.spinnerMessage;\n    },\n\n    setSpinner: (state, action: PayloadAction<{ show: boolean, message: string | undefined }>): void => {\n      state.spinnerShow = action.payload.show;\n      state.spinnerMessage = action.payload.message || initialState.spinnerMessage;\n    }\n  }\n});\n\nconst getters = {\n  getSpinner: (state: RootState) => state.spinner,\n}\n\nexport const {getSpinner} = getters;\nexport const {setSpinnerShow, setSpinner} = spinnerSlice.actions;\nexport default spinnerSlice.reducer;\n","import React, {useEffect, useRef, useState} from \"react\";\nimport \"./styles.scss\"\nimport {Modal, Spinner} from \"react-bootstrap\";\nimport {useSelector} from \"react-redux\";\nimport {getSpinner} from \"../../store/slices/spinnerSlice\";\n\nexport const LoadingSpinner = () => {\n  const {spinnerShow, spinnerMessage} = useSelector(getSpinner);\n  const [show, setShow] = useState(spinnerShow);\n  const showTimerRef = useRef<NodeJS.Timeout>();\n\n  useEffect(() => {\n    if (showTimerRef.current) {\n      clearTimeout(showTimerRef.current)\n      showTimerRef.current = undefined\n    }\n    if (spinnerShow) showTimerRef.current = setTimeout(() => setShow(true), 1000);\n    else setShow(false)\n  }, [spinnerShow])\n\n  return (\n    <Modal show={show} centered size=\"sm\" backdrop={true}>\n      <Modal.Body>\n        <div className=\"d-flex align-items-center\">\n          <Spinner animation=\"border\" variant=\"primary\" className=\"me-3\"/>\n          <div>{spinnerMessage}</div>\n        </div>\n      </Modal.Body>\n    </Modal>\n  );\n}\n\nexport const CustomSpinner: React.FC<{ message: string }> = ({message}) => {\n  return (\n    <Modal show={true} centered size=\"sm\" backdrop={true}>\n      <Modal.Body>\n        <div className=\"d-flex align-items-center\">\n          <Spinner animation=\"border\" variant=\"primary\" className=\"me-3\"/>\n          <div>{message}</div>\n        </div>\n      </Modal.Body>\n    </Modal>\n  );\n}\n\nexport default LoadingSpinner;","import React, {HTMLAttributes, useState} from \"react\";\nimport \"./styles.scss\";\n\nexport const FadeIn: React.FC<HTMLAttributes<HTMLDivElement>> = (props): React.ReactElement => {\n  const [className, setClassName] = useState(\"show-transition hidden\");\n  setTimeout(() => setClassName(\"show-transition\"), 0);\n\n  return (\n    <div className={`${className} ${props.className}`}>\n      {props.children}\n    </div>\n  )\n}","import {createSlice, PayloadAction} from \"@reduxjs/toolkit\";\nimport {RootState} from \"../configure\";\n\nexport type zespConnectionStatus = \"disconnected\" | \"connected\" | \"connecting\" | \"reconnect\" | \"closed\";\n\nexport interface ZespState {\n  connectionStatus: zespConnectionStatus,\n  initialized: boolean,\n}\n\nconst initialState: ZespState = {\n  connectionStatus: \"disconnected\",\n  initialized: false,\n}\n\nexport const zespSlice = createSlice({\n  name: \"zesp\",\n  initialState,\n  reducers: {\n    setConnectionStatus: (state, action: PayloadAction<zespConnectionStatus>) => {\n      state.connectionStatus = action.payload;\n    },\n\n    setInitialized: (state, action: PayloadAction<boolean>) => {\n      state.initialized = action.payload;\n    },\n  }\n})\n\nconst getters = {\n  getStatus: (state: RootState) => state.zesp.connectionStatus,\n  getInitialized: (state: RootState) => state.zesp.initialized,\n}\n\nexport const {getStatus, getInitialized,} = getters;\nexport const {setConnectionStatus, setInitialized,} = zespSlice.actions;\nexport default zespSlice.reducer;","import {ZespDataEvent} from \"./ZespDataEvent\";\nimport {IZespResponseValidator} from \"../interfaces/IZespResponseValidator\";\nimport {ZespDeviceUpdate} from \"../models/ZespDeviceUpdate\";\n\nexport const JsonZespResponseValidator = (fileName: string): IZespResponseValidator => ({\n  name: JsonZespResponseValidator.name,\n  isValid: (event: ZespDataEvent) => {\n    if (event.dataType !== \"json\") return false;\n    const responseFileName = event.dataParts[0];\n    const foundFileName = (/\\/(.+)\\.json/ig.exec(responseFileName) as string[])[1];\n\n    return foundFileName === fileName;\n  }\n});\n\nexport const TypedZespResponseValidator = (dataType: string): IZespResponseValidator => ({\n  name: TypedZespResponseValidator.name,\n  isValid: (event: ZespDataEvent) => event.dataType === dataType\n});\n\nexport const ReportZespResponseValidator = (deviceId: string, endpointId: string, clusterId: string, attributeId: string) => ({\n  name: ReportZespResponseValidator.name,\n  isValid: (event: ZespDataEvent) => {\n    if (!event.dataType || event.dataType !== \"rep\") return false\n    if (event.dataParts.length < 1) return false\n    const response = JSON.parse(event.dataParts[0]) as ZespDeviceUpdate\n\n    if (!response.ShortAddr || response.ShortAddr !== deviceId) return false;\n    if (!response.EndPoint || response.EndPoint !== endpointId) return false;\n    if (!response.ClusterId || response.ClusterId !== clusterId) return false;\n    if (!response.AttribId || response.AttribId !== attributeId) return false;\n\n    return true;\n  }\n})\n\nexport const AllMessagesZespResponseValidator: IZespResponseValidator = ({\n  name: \"AllZespResponseValidator\",\n  isValid: (event => true)\n});","import {IDeviceControlProps} from \"../interfaces/IDeviceControlProps\";\nimport {DataControlSettings} from \"../models/DataControlSettings\";\nimport {ZespReportInfo} from \"./zesp/models/ZespReportInfo\";\n\nexport const DeviceControls = {\n  getControlReport: (props: IDeviceControlProps<DataControlSettings>): ZespReportInfo | null => {\n    if (!props.config.reportKey) {\n      console.debug(`No report key in config found for ${props.deviceInfo.zespInfo.IEEE} device and ${props.config.id} control`);\n      return null;\n    }\n    const reportKey = props.config.reportKey.endpoint + props.config.reportKey.clusterId + props.config.reportKey.attributeId;\n    return props.deviceInfo.zespInfo.Report[reportKey];\n  },\n\n  getControlSettings: function <T extends DataControlSettings>(props: IDeviceControlProps<DataControlSettings>, layoutId: string): [T | undefined, ZespReportInfo | undefined] {\n    const settings = props.deviceInfo.customLayout?.find(x => x.id === layoutId) as T;\n    const report = settings && settings.reportKey\n      ? props.deviceInfo.zespInfo.Report[settings.reportKey.endpoint + settings.reportKey.clusterId + settings.reportKey.attributeId]\n      : undefined;\n\n    return [settings, report];\n  },\n}\n","import React, {useContext} from \"react\";\nimport {Button, ButtonGroup, Row} from \"react-bootstrap\";\nimport {LayoutSettingsOnOff} from \"../settings\";\nimport {IDeviceControlProps} from \"../../interfaces/IDeviceControlProps\";\nimport {DeviceControls} from \"../../services/deviceControls\";\nimport {DeviceControlCol1, DeviceControlCol2} from \"../index\";\nimport {ZespContext} from \"../../shared/agents/ZespAgent\";\n\nexport const OnOffRoot = (props: IDeviceControlProps<LayoutSettingsOnOff>) => {\n  const {zespSend} = useContext(ZespContext);\n  const report = DeviceControls.getControlReport(props);\n\n  const onHandler = () => {\n    zespSend({data: props.config.arguments.commandOn, isBinary: true});\n  };\n\n  const offHandler = () => {\n    zespSend({data: props.config.arguments.commandOff, isBinary: true});\n  };\n\n  return (\n    <Row>\n      <DeviceControlCol1>Light power:</DeviceControlCol1>\n      <DeviceControlCol2>\n        <ButtonGroup>\n          <Button variant={report?.val.toString() === \"1\" ? \"primary\" : \"secondary\"} onClick={onHandler}>ON</Button>\n          <Button variant={report?.val.toString() === \"1\" ? \"secondary\" : \"primary\"} onClick={offHandler}>OFF</Button>\n        </ButtonGroup>\n      </DeviceControlCol2>\n    </Row>\n  )\n}\n","import React, {useContext, useState} from \"react\";\nimport {FormControl, Row} from \"react-bootstrap\";\nimport FormRange from \"react-bootstrap/FormRange\";\nimport {LayoutSettingsLevel} from \"../settings\";\nimport {IDeviceControlProps} from \"../../interfaces/IDeviceControlProps\";\nimport {DeviceControls} from \"../../services/deviceControls\";\nimport {DeviceControlCol1, DeviceControlCol2} from \"../index\";\nimport {ZespContext} from \"../../shared/agents/ZespAgent\";\n\n// TODO add localization\nexport const LevelRoot = (props: IDeviceControlProps<LayoutSettingsLevel>) => {\n  const {zespSend} = useContext(ZespContext);\n  const report = DeviceControls.getControlReport(props);\n  const currentValue = report?.val ? Number(report.val) : ((props.config.arguments.max - props.config.arguments.min) / 2 + props.config.arguments.min);\n  const [value, setValue] = useState(currentValue);\n\n  const minMaxAttributes = {\n    min: props.config.arguments.min,\n    max: props.config.arguments.max\n  };\n\n  const inRange = (value: number) => Math.max(Math.min(props.config.arguments.max, value), props.config.arguments.min);\n\n  // const setCurrentValue = (value: number) => DeviceControls.setControlReport(globalState, props, value.toString());\n\n  const sliderChangeHandler = () => {\n    const result = inRange(value);\n    const data = props.config.arguments.command.replace(\"{value}\", result.toString(16));\n    zespSend({data: data});\n    // setCurrentValue(result);\n  }\n\n  const inputChangeHandler = (value: number) => {\n    const result = inRange(value);\n    setValue(result);\n    const data = props.config.arguments.command.replace(\"{value}\", result.toString(16));\n    zespSend({data: data});\n    // setCurrentValue(result);\n  }\n\n  return (\n    <Row>\n      <DeviceControlCol1>Level:</DeviceControlCol1>\n      <DeviceControlCol2>\n        <FormControl\n          style={{width: \"80px\"}}\n          className=\"me-2\"\n          type=\"number\"\n          value={value}\n          onChange={event => inputChangeHandler(Number(event.target.value))}\n          {...minMaxAttributes}\n        />\n\n        <FormRange\n          value={value}\n          onChange={event => setValue(Number(event.target.value))}\n          onMouseUp={sliderChangeHandler}\n          {...minMaxAttributes}\n        />\n      </DeviceControlCol2>\n    </Row>\n  )\n}\n","// Copy-pasted from here: https://usehooks-typescript.com/react-hook/use-local-storage\n\nimport {Dispatch, SetStateAction, useEffect, useState} from 'react'\n\ntype SetValue<T> = Dispatch<SetStateAction<T>>\n\nexport function useLocalStorage<T>(key: string, initialValue: T): [T, SetValue<T>] {\n  // Get from local storage then\n  // parse stored json or return initialValue\n  const readValue = (): T => {\n    // Prevent build error \"window is undefined\" but keep keep working\n    if (typeof window === 'undefined') {\n      return initialValue\n    }\n\n    try {\n      const item = window.localStorage.getItem(key)\n      return item ? (JSON.parse(item) as T) : initialValue\n    } catch (error) {\n      console.warn(`Error reading localStorage key “${key}”:`, error)\n      return initialValue\n    }\n  }\n\n  // State to store our value\n  // Pass initial state function to useState so logic is only executed once\n  const [storedValue, setStoredValue] = useState<T>(readValue)\n\n  // Return a wrapped version of useState's setter function that ...\n  // ... persists the new value to localStorage.\n  const setValue: SetValue<T> = value => {\n    // Prevent build error \"window is undefined\" but keeps working\n    if (typeof window == 'undefined') {\n      console.warn(\n        `Tried setting localStorage key “${key}” even though environment is not a client`,\n      )\n    }\n\n    try {\n      // Allow value to be a function so we have the same API as useState\n      const newValue = value instanceof Function ? value(storedValue) : value\n\n      // Save to local storage\n      window.localStorage.setItem(key, JSON.stringify(newValue))\n\n      // Save state\n      setStoredValue(newValue)\n\n      // We dispatch a custom event so every useLocalStorage hook are notified\n      window.dispatchEvent(new Event('local-storage'))\n    } catch (error) {\n      console.warn(`Error setting localStorage key “${key}”:`, error)\n    }\n  }\n\n  useEffect(() => {\n    setStoredValue(readValue())\n  }, [])\n\n  useEffect(() => {\n    const handleStorageChange = () => {\n      setStoredValue(readValue())\n    }\n\n    // this only works for other documents, not the current one\n    window.addEventListener('storage', handleStorageChange)\n\n    // this is a custom event, triggered in writeValueToLocalStorage\n    window.addEventListener('local-storage', handleStorageChange)\n\n    return () => {\n      window.removeEventListener('storage', handleStorageChange)\n      window.removeEventListener('local-storage', handleStorageChange)\n    }\n  }, [])\n\n  return [storedValue, setValue]\n}\n","import React, {useContext, useState} from \"react\";\nimport {IDeviceControlProps} from \"../../interfaces/IDeviceControlProps\";\nimport {LayoutSettingsCommand} from \"../settings\";\nimport {HuePicker, GithubPicker, CompactPicker, RGBColor} from \"react-color\";\nimport {Row} from \"react-bootstrap\";\nimport {useLocalStorage} from \"../../services/localStorage\";\nimport {DeviceControls} from \"../../services/deviceControls\";\nimport {DeviceControlCol1, DeviceControlCol2} from \"../index\";\nimport {ZespContext} from \"../../shared/agents/ZespAgent\";\n\n//TODO localize\nexport const RgbRoot = (props: IDeviceControlProps<LayoutSettingsCommand>) => {\n  const {zespSend} = useContext(ZespContext);\n  const report = DeviceControls.getControlReport(props);\n  let currentValue: number[] = report?.val ? report?.val.split(\":\").map(x => Number(x)) : [255, 255, 255];\n  if (currentValue.length !== 3) {\n    console.warn(`Incorrect RGB value stored to reportd: ${report?.val}`);\n    currentValue = [255, 255, 255];\n  }\n\n  const [color, setColor] = useState<RGBColor>({r: currentValue[0], g: currentValue[1], b: currentValue[2]});\n  const [colorPicker, setColorPicker] = useLocalStorage(\"colorPicker\", 1);\n\n  // const setCurrentValue = (rgb: RGBColor) => DeviceControls.setControlReport(globalState, props, `${rgb.r}:${rgb.g}:${rgb.b}`);\n  const colorChangeHandler = (rgb: RGBColor) => {\n    setColor(rgb);\n\n    const [x, y] = rgbToXY(rgb);\n    let command = props.config.arguments.command.replace(\"{x}\", x.toString(16));\n    command = command.replace(\"{y}\", y.toString(16));\n    zespSend({data: command});\n    // setCurrentValue(rgb);\n  }\n\n  const sendColorHandler = () => {\n    const [x, y] = rgbToXY(color);\n\n    let command = props.config.arguments.command.replace(\"{x}\", x.toString(16));\n    command = command.replace(\"{y}\", y.toString(16));\n\n    zespSend({data: command});\n    // setCurrentValue(color);\n  }\n\n  const colorPickerButton = (id: number) =>\n    (<button className={`btn btn-outline-secondary me-1 btn-xs ${colorPicker == id ? \"active\" : \"\"}`} type=\"button\" onClick={() => setColorPicker(id)}>{id}</button>)\n\n  return (\n    <Row>\n      <DeviceControlCol1 className=\"user-select-none\">\n        <div>\n          <div>Light color:</div>\n          <div>\n            {colorPickerButton(1)}\n            {colorPickerButton(2)}\n            {colorPickerButton(3)}\n          </div>\n        </div>\n      </DeviceControlCol1>\n      <DeviceControlCol2>\n        <div className=\"flex-grow-1\">\n          {colorPicker === 1 && (<HuePicker color={color} onChange={event => setColor(event.rgb)} onChangeComplete={sendColorHandler} width=\"270px\"/>)}\n          {colorPicker === 2 && (<GithubPicker color={color} onChange={event => colorChangeHandler(event.rgb)} triangle=\"hide\" width=\"214px\"/>)}\n          {colorPicker === 3 && (<CompactPicker color={color} onChange={event => colorChangeHandler(event.rgb)}/>)}\n        </div>\n      </DeviceControlCol2>\n    </Row>\n  );\n}\n\nconst rgbToXY = (rgb: RGBColor) => {\n  // Apply a gamma correction to the RGB values, which makes the color more vivid and more the like the color displayed on the screen of your device\n  // const red = (rgb.r > 0.04045) ? Math.pow((rgb.r + 0.055) / (1.0 + 0.055), 2.4) : (rgb.r / 12.92);\n  const red = (rgb.b > 0.04045) ? Math.pow((rgb.b + 0.055) / (1.0 + 0.055), 2.4) : (rgb.b / 12.92);\n  const green = (rgb.g > 0.04045) ? Math.pow((rgb.g + 0.055) / (1.0 + 0.055), 2.4) : (rgb.g / 12.92);\n  // const blue = (rgb.b > 0.04045) ? Math.pow((rgb.b + 0.055) / (1.0 + 0.055), 2.4) : (rgb.b / 12.92);\n  const blue = (rgb.r > 0.04045) ? Math.pow((rgb.r + 0.055) / (1.0 + 0.055), 2.4) : (rgb.r / 12.92);\n\n\n  // RGB values to XYZ using the Wide RGB D65 conversion formula\n  const X = red * 0.664511 + green * 0.154324 + blue * 0.162028;\n  const Y = red * 0.283881 + green * 0.668433 + blue * 0.047685;\n  const Z = red * 0.000088 + green * 0.072310 + blue * 0.986039;\n\n  // Calculate the xy values from the XYZ values\n  // let x = (X / (X + Y + Z)).toFixed(4);\n  // let y = (Y / (X + Y + Z)).toFixed(4)\n  let x = (X / (X + Y + Z));\n  let y = (Y / (X + Y + Z));\n\n  if (isNaN(x)) x = 0;\n  if (isNaN(y)) y = 0;\n\n  return [Number((x * 65279).toFixed(0)), Number((y * 65279).toFixed(0))];\n}","import React, {ReactNode, useEffect, useState} from \"react\";\n\ninterface IProps {\n  children?: ReactNode | undefined,\n  classNameFrom: string,\n  classNameTo: string,\n  timeOutMs?: number,\n  onRefresh?: boolean,\n  onLoad?: boolean\n}\n\nexport const Transition = (props: IProps) => {\n  const [className, setClassName] = useState<string>();\n  if (props.onRefresh === true) useEffect(\n    () => setClassName(props.classNameFrom),\n    [props.children?.toString()]);\n\n  if (props.onLoad === false) useEffect(() => setClassName(props.classNameTo), []);\n\n  setTimeout(() => setClassName(props.classNameTo), props.timeOutMs || 100);\n  return (<span className={className}>{props.children}</span>)\n}\n","import React, {FunctionComponent} from \"react\";\nimport {Transition} from \"./index\";\n\nexport const HighlightOnUpdate: FunctionComponent = (props) => {\n  return (\n    <Transition classNameFrom=\"highlight-value just-added\" classNameTo=\"highlight-value\" onRefresh={true} onLoad={false}>\n      {props.children}\n    </Transition>\n  )\n}","import React, {useState} from \"react\";\nimport {IDeviceControlProps} from \"../interfaces/IDeviceControlProps\";\nimport {DataControlSettings} from \"../models/DataControlSettings\";\nimport {DeviceControls} from \"../services/deviceControls\";\nimport {DeviceControlCol1, DeviceControlCol2} from \"./index\";\nimport {HighlightOnUpdate} from \"../shared/transition/HighlightOnUpdate\";\nimport {Row} from \"react-bootstrap\";\n\nexport const UnknownControl = (props: IDeviceControlProps<DataControlSettings>) => {\n  const [showDetails, setShowDetails] = useState(false);\n  const configData = JSON.stringify(props.config)\n  const reportData = JSON.stringify(DeviceControls.getControlReport(props));\n\n  const report = DeviceControls.getControlReport(props);\n  if (!report) return (<NoReport id={props.config.id} reportData={reportData} configData={configData}/>)\n\n  const label = report.label || props.config.name || props.config.id || \"Unknown data\";\n  const value =\n    (report.parsed && report.parsed.toString().trim() === report.val.toString().trim() && report.parsed)\n    || (report.parsed && report.val && `${report.parsed} (${report.val})`)\n    || report.val\n    || \"No data\";\n\n  const roleParts = report.role?.split(\"&\");\n  const roleSettings = roleParts && roleParts.length > 1 && JSON.parse(roleParts[1]);\n  const units = (roleSettings && roleSettings[\"unit_of_measurement\"]) || \"\";\n\n  const showDetailsClicked = (event: React.MouseEvent<HTMLAnchorElement>) => {\n    event.preventDefault();\n    setShowDetails(!showDetails);\n  }\n\n  return (\n    <Row>\n      <DeviceControlCol1>{label}:</DeviceControlCol1>\n      <DeviceControlCol2>\n        <HighlightOnUpdate>{value} {units}</HighlightOnUpdate>\n        <a onClick={showDetailsClicked} href=\"#\" className=\"value-info\" title=\"Unrecognized data, click to show details\">\n          <i className=\"bi bi-info-circle-fill ms-2 text-secondary\"/>\n        </a>\n      </DeviceControlCol2>\n      <div className={`alert alert-info flex-column col-12 ${showDetails ? \"\" : \"d-none\"}`}>\n        <div>{configData}</div>\n        {reportData && (<div className=\"mt-2\">{reportData}</div>)}\n      </div>\n    </Row>\n  )\n\n  // return \n}\n\nconst NoReport = (props: { id: string, configData: string, reportData: string }) => (\n  <Row>\n    <DeviceControlCol1>{props.id}</DeviceControlCol1>\n    <DeviceControlCol2>\n      <div className=\"alert alert-info\">\n        <div>{props.configData}</div>\n        {props.reportData && (<div className=\"mt-2\">{props.reportData}</div>)}\n      </div>\n    </DeviceControlCol2>\n  </Row>\n)\n","import React from \"react\";\nimport {Row} from \"react-bootstrap\";\nimport {LayoutSettingsSensor} from \"../settings\";\nimport {IDeviceControlProps} from \"../../interfaces/IDeviceControlProps\";\nimport {DeviceControls} from \"../../services/deviceControls\";\nimport {HighlightOnUpdate} from \"../../shared/transition/HighlightOnUpdate\";\nimport {DeviceControlCol1, DeviceControlCol2} from \"../index\";\n\n//TODO localization\nexport const IlluminanceSensor = (props: IDeviceControlProps<LayoutSettingsSensor>) => {\n  const report = DeviceControls.getControlReport(props);\n  const value = report?.val ? parseInt(report.val, 16).toString() : null;\n\n  return (\n    <Row>\n      <DeviceControlCol1>Illuminance:</DeviceControlCol1>\n      <DeviceControlCol2>\n        {value && (<HighlightOnUpdate>{value}</HighlightOnUpdate>)}\n        {!value && (<span className=\"alert alert-warning small py-2 m-0\">No data</span>)}\n      </DeviceControlCol2>\n    </Row>\n  )\n}\n","import React, {useContext, useState} from \"react\";\nimport {FormControl, Row} from \"react-bootstrap\";\nimport FormRange from \"react-bootstrap/FormRange\";\nimport {LayoutSettingsLevel} from \"../settings\";\nimport {IDeviceControlProps} from \"../../interfaces/IDeviceControlProps\";\nimport {DeviceControls} from \"../../services/deviceControls\";\nimport {DeviceControlCol1, DeviceControlCol2} from \"../index\";\nimport {ZespContext} from \"../../shared/agents/ZespAgent\";\n\nexport const LevelControl = (props: IDeviceControlProps<LayoutSettingsLevel>) => {\n  const {zespSend} = useContext(ZespContext);\n  const minMaxAttributes = {\n    min: props.config.arguments.min,\n    max: props.config.arguments.max\n  };\n\n  const report = DeviceControls.getControlReport(props);\n  const currentValue = report?.parsed ? Number(report.parsed) : ((minMaxAttributes.max - minMaxAttributes.min) / 2 + minMaxAttributes.min);\n  const [value, setValue] = useState(currentValue);\n\n  const inRange = (value: number) => Math.max(Math.min(props.config.arguments.max, value), props.config.arguments.min);\n\n  const sliderChangeHandler = () => {\n    const result = inRange(value);\n    sendValueToZesp(result);\n  }\n\n  const inputChangeHandler = (value: number) => {\n    const result = inRange(value);\n    setValue(result);\n    sendValueToZesp(result);\n  }\n\n  const sendValueToZesp = (value: number) => {\n    const data = formatCommand(props.config.arguments.command, value, props);\n    zespSend({data: data});\n  }\n\n  const label = report?.label || props.config.name || \"Level\";\n\n  return (\n    <Row>\n      <DeviceControlCol1>{label}:</DeviceControlCol1>\n      <DeviceControlCol2>\n        <FormControl\n          style={{width: \"100px\"}}\n          className=\"me-2 text-center\"\n          type=\"number\"\n          value={value}\n          onChange={event => inputChangeHandler(Number(event.target.value))}\n          {...minMaxAttributes}\n        />\n\n        <FormRange\n          value={value}\n          onChange={event => setValue(Number(event.target.value))}\n          onMouseUp={sliderChangeHandler}\n          {...minMaxAttributes}\n        />\n      </DeviceControlCol2>\n    </Row>\n  )\n}\n\nconst formatCommand = (command: string, value: number, props: IDeviceControlProps<LayoutSettingsLevel>): string => command\n  .replace(\"{endpoint}\", props.config.reportKey?.endpoint || \"\")\n  .replace(\"{device}\", props.deviceInfo.zespInfo.Device)\n  .replace(\"{value}\", value.toString(16))\n  .replace(\"{value:dec}\", value.toString());","import React, {ChangeEvent, useContext, useEffect, useState} from \"react\";\nimport {Row} from \"react-bootstrap\";\nimport {IDeviceControlProps} from \"../../interfaces/IDeviceControlProps\";\nimport {DataControlSettings} from \"../../models/DataControlSettings\";\nimport {DeviceControls} from \"../../services/deviceControls\";\nimport toast from \"react-hot-toast\";\nimport {LayoutSettingsOnOff} from \"../settings\";\nimport {DeviceControlCol1, DeviceControlCol2} from \"../index\";\nimport {ZespContext} from \"../../shared/agents/ZespAgent\";\n\n// TODO add localization\nexport const PlayerSrcRoot = (props: IDeviceControlProps<DataControlSettings>) => {\n  const {zespSend} = useContext(ZespContext);\n  const srcReport = DeviceControls.getControlReport(props);\n  const [playSettings, playReport] = DeviceControls.getControlSettings<LayoutSettingsOnOff>(props, \"player_control_root\");\n\n  if (!srcReport) {\n    useEffect(() => {\n      toast.error(`'${props.config.id}' layout settings not found`);\n    }, []);\n    return (<></>);\n  }\n\n  if (!playReport) {\n    useEffect(() => {\n      toast.error(\"'player_control_root' layout settings not found\");\n    }, []);\n    return (<></>);\n  }\n\n  const [src, setSrc] = useState(srcReport.val || \"\");\n  const [play, setPlay] = useState(playReport!.val || \"OFF\");\n\n  const srcs: string[] = [\n    \"http://chanson.hostingradio.ru:8041/chanson128.mp3\",\n    \"http://dorognoe.hostingradio.ru:8000/radio?type=.mp3\",\n    \"http://stream3.radiostyle.ru:8001/biker-fm\",\n    \"http://air.radiorecord.ru:8102/sd90_320\",\n    \"http://stream.hitroe.com/stream\",\n    \"http://air.radiorecord.ru:8102/tm_320\",\n    \"http://eu.radioboss.fm:8024/stream\",\n    \"http://listen.181fm.com/181-thebox_128k.mp3?\",\n    \"http://stream.live.vc.bbcmedia.co.uk/bbc_radio_one\"\n  ];\n\n  const handleChange = (event: ChangeEvent) => {\n    const value = (event.target as HTMLInputElement).value\n    setSrc(value);\n\n    // DeviceControls.setControlReport(globalState, props, value);\n  }\n\n  const handleStop = () => {\n    setPlay(\"OFF\");\n    // DeviceControls.setControlReport(globalState, props, \"OFF\", playSettings!.reportKey);\n\n    setSrc(\"\");\n    // DeviceControls.setControlReport(globalState, props, \"\");\n\n    if (playSettings) zespSend({data: playSettings.arguments.commandOff});\n    else console.warn(\"No configured OFF command for 'player_control_root' operation found in layout\");\n  }\n\n  const handlePlay = () => {\n    if (!src || src.length === 0) {\n      toast.error(\"Please select source first\", {icon: \"🎵\"});\n      return;\n    }\n\n    setPlay(\"ON\");\n    // DeviceControls.setControlReport(globalState, props, \"ON\", playSettings!.reportKey);\n    if (playSettings) zespSend({data: playSettings.arguments.commandOn.replace(\"{value}\", src)});\n    else console.warn(\"No configured ON command for 'player_control_root' operation found in layout\");\n  }\n\n  return (\n    <Row>\n      <DeviceControlCol1>Radio stream:</DeviceControlCol1>\n      <DeviceControlCol2>\n        <div className=\"input-group\">\n          <input className=\"form-control\" list=\"datalistOptions\" placeholder=\"Click to see dropdown suggestions\" value={src} onChange={handleChange}/>\n          <button className={`btn btn-outline-secondary ${play !== \"ON\" ? \"active\" : \"\"}`} type=\"button\" onClick={handleStop}><i className=\"bi-stop\"/></button>\n          <button className={`btn btn-outline-secondary rounded-end ${play === \"ON\" ? \"active\" : \"\"}`} type=\"button\" onClick={handlePlay}><i className=\"bi-play\"/></button>\n          <datalist id=\"datalistOptions\">\n            {srcs.map((src, i) => (<option key={i} value={src}/>))}\n          </datalist>\n        </div>\n      </DeviceControlCol2>\n    </Row>\n  )\n}\n","import React from \"react\";\nimport {Row} from \"react-bootstrap\";\nimport {IDeviceControlProps} from \"../../interfaces/IDeviceControlProps\";\nimport {DeviceControls} from \"../../services/deviceControls\";\nimport {HighlightOnUpdate} from \"../../shared/transition/HighlightOnUpdate\";\nimport {DataControlSettings} from \"../../models/DataControlSettings\";\nimport {DeviceControlCol1, DeviceControlCol2} from \"../index\";\n\nexport const OnOffBinarySensor = (props: IDeviceControlProps<DataControlSettings>) => {\n  const report = DeviceControls.getControlReport(props);\n  if (!report) return (<div className=\"alert alert-warning\">Report missed</div>);\n  const payloadOn = Number(props.config.zespRoleSettings[\"payload_on\"]?.toString() || \"0\");\n  const value = Number(report.parsed?.toString() || report.val?.toString() || \"1\");\n  const result = value === payloadOn;\n\n  return (\n    <Row>\n      <DeviceControlCol1>{report.label || \"State\"}:</DeviceControlCol1>\n      <DeviceControlCol2>\n        <HighlightOnUpdate>{result ? \"ON\" : \"OFF\"}</HighlightOnUpdate>\n      </DeviceControlCol2>\n    </Row>\n  )\n}","import React from \"react\";\nimport {Row} from \"react-bootstrap\";\nimport {IDeviceControlProps} from \"../../interfaces/IDeviceControlProps\";\nimport {DeviceControls} from \"../../services/deviceControls\";\nimport {HighlightOnUpdate} from \"../../shared/transition/HighlightOnUpdate\";\nimport {DataControlSettings} from \"../../models/DataControlSettings\";\nimport {DeviceControlCol1, DeviceControlCol2} from \"../index\";\n\nexport const ValueSensor = (props: IDeviceControlProps<DataControlSettings>) => {\n  const report = DeviceControls.getControlReport(props);\n  if (!report) return (<div className=\"alert alert-warning\">Report missed</div>);\n\n  const value = report.parsed || report.val;\n  const unit = (props.config.zespRoleSettings && props.config.zespRoleSettings[\"unit_of_measurement\"]) || \"\";\n\n  return (\n    <Row>\n      <DeviceControlCol1>{report.label || \"Value\"}:</DeviceControlCol1>\n      <DeviceControlCol2>\n        <HighlightOnUpdate>{value ? `${value} ${unit}` : \"No data\"}</HighlightOnUpdate>\n      </DeviceControlCol2>\n    </Row>\n  )\n}\n","import React, {useContext} from \"react\";\nimport {Button, ButtonGroup, Row} from \"react-bootstrap\";\nimport {LayoutSettingsOnOffToggle} from \"../settings\";\nimport {IDeviceControlProps} from \"../../interfaces/IDeviceControlProps\";\nimport {DeviceControls} from \"../../services/deviceControls\";\nimport {DeviceControlCol1, DeviceControlCol2} from \"../index\";\nimport {ZespContext} from \"../../shared/agents/ZespAgent\";\n\nexport const OnOffToggle = (props: IDeviceControlProps<LayoutSettingsOnOffToggle>) => {\n  const {zespSend} = useContext(ZespContext);\n  const report = DeviceControls.getControlReport(props);\n\n  const applyTemplate = (template: string): string => template\n    .replace(\"{endpoint}\", props.config.reportKey?.endpoint || \"\")\n    .replace(\"{device}\", props.deviceInfo.zespInfo.Device)\n\n  const onHandler = () => {\n    const command = applyTemplate(props.config.arguments.commandOn)\n    zespSend({data: command, isBinary: true});\n  };\n\n  const offHandler = () => {\n    const command = applyTemplate(props.config.arguments.commandOff)\n    zespSend({data: command, isBinary: true});\n  };\n\n  const toggleHandler = () => {\n    const command = applyTemplate(props.config.arguments.commandToggle)\n    zespSend({data: command, isBinary: true});\n  }\n\n  const label = report?.label || props.config.name || \"Power\";\n\n  return (\n    <Row>\n      <DeviceControlCol1>{label}:</DeviceControlCol1>\n      <DeviceControlCol2>\n        <ButtonGroup>\n          <Button variant={report?.parsed.toString() === \"1\" ? \"primary\" : \"secondary\"} onClick={onHandler}>ON</Button>\n          <Button variant=\"secondary\" onClick={toggleHandler}>Toggle</Button>\n          <Button variant={report?.parsed.toString() === \"0\" ? \"primary\" : \"secondary\"} onClick={offHandler}>OFF</Button>\n        </ButtonGroup>\n      </DeviceControlCol2>\n    </Row>\n  )\n}\n","import React, {Fragment, FunctionComponent} from \"react\";\nimport {LayoutSettingsCommand, LayoutSettingsLevel, LayoutSettingsOnOff, LayoutSettingsOnOffToggle, LayoutSettingsSensor} from \"./settings\";\nimport {IDeviceControlProps} from \"../interfaces/IDeviceControlProps\";\nimport {OnOffRoot} from \"./root/OnOffRoot\";\nimport {LevelRoot} from \"./root/LevelRoot\";\nimport {RgbRoot} from \"./root/RgbRoot\";\nimport {UnknownControl} from \"./unknown\";\nimport {IlluminanceSensor} from \"./sensors/IlluminanceSensor\";\n\nimport {DataControlSettings} from \"../models/DataControlSettings\";\nimport {LevelControl} from \"./controls/LevelControl\";\nimport {DeviceInfo} from \"../models/DeviceInfo\";\nimport {PlayerSrcRoot} from \"./root/PlayerSrcRoot\";\nimport {OnOffBinarySensor} from \"./sensors/OnOffBinarySensor\";\nimport {ValueSensor} from \"./sensors/ValueSensor\";\nimport {Col} from \"react-bootstrap\";\nimport {OnOffToggle} from \"./controls/OnOffToggle\";\n\ntype ElementTypes = \"regular\" | \"skip\" | \"unknown\";\n\ninterface IResult {\n  element: JSX.Element,\n  type: ElementTypes\n}\n\nexport const getControlForDevice = (config: DataControlSettings, deviceInfo: DeviceInfo): IResult => {\n  const controlProps: IDeviceControlProps<DataControlSettings> = {\n    config,\n    deviceInfo,\n  }\n\n  switch (config.id) {\n    case \"on_off_root\" :\n      return {type: \"regular\", element: (<OnOffRoot {...controlProps} config={controlProps.config as LayoutSettingsOnOff}/>)};\n    case \"level_root\" :\n      return {type: \"regular\", element: (<LevelRoot {...controlProps} config={controlProps.config as LayoutSettingsLevel}/>)};\n    case \"rgb_root\" :\n      return {type: \"regular\", element: (<RgbRoot {...controlProps} config={controlProps.config as LayoutSettingsCommand}/>)};\n    case \"player_src_root\" :\n      return {type: \"regular\", element: (<PlayerSrcRoot {...controlProps} config={controlProps.config as DataControlSettings}/>)};\n    case \"player_control_root\":\n      return {type: \"skip\", element: (<Fragment/>)};\n\n    case \"level_control\" :\n      return {type: \"regular\", element: (<LevelControl {...controlProps} config={controlProps.config as LayoutSettingsLevel}/>)};\n\n    case \"illuminance_sensor\" :\n      return {type: \"regular\", element: (<IlluminanceSensor {...controlProps} config={controlProps.config as LayoutSettingsSensor}/>)};\n    case \"binary_sensor\" :\n      return {type: \"regular\", element: (<OnOffBinarySensor {...controlProps} config={controlProps.config as DataControlSettings}/>)};\n    case \"sensor\" :\n      return {type: \"regular\", element: (<ValueSensor {...controlProps} config={controlProps.config as DataControlSettings}/>)};\n\n    case \"on_off_toggle\":\n      return {type: \"regular\", element: (<OnOffToggle {...controlProps} config={controlProps.config as LayoutSettingsOnOffToggle}/>)};\n\n    default:\n      return {type: \"unknown\", element: (<UnknownControl {...controlProps}/>)}\n  }\n}\n\nexport const DeviceControlCol1: FunctionComponent<React.HTMLProps<HTMLButtonElement>> = (props) => {\n  return (<Col md=\"4\">{props.children}</Col>)\n}\n\nexport const DeviceControlCol2: FunctionComponent<React.HTMLProps<HTMLButtonElement>> = (props) => {\n  return (<Col>{props.children}</Col>)\n}","import {getControlForDevice} from \"../index\";\nimport React, {FunctionComponent, useState} from \"react\";\nimport {LayoutProps} from \"../../models/LayoutProps\";\n\nexport const DefaultLayout: FunctionComponent<LayoutProps> = (props: LayoutProps) => {\n  const controls: React.ReactElement[] = [];\n  const unknown: React.ReactElement[] = [];\n\n  props.settings.forEach(settings => {\n    const control = getControlForDevice(settings, props.device);\n    if (control.type === \"skip\") return;\n\n    if (control.type === \"unknown\") unknown.push(control.element);\n    else controls.push(control.element);\n  });\n\n  // show by default if now identified controls found\n  const [showUnknown, setShowUnknown] = useState(controls.length === 0);\n\n  const onToggleUnknownHandler = () => {\n    setShowUnknown(!showUnknown);\n  }\n\n  return (\n    <div className=\"default-layout\">\n      {controls.length > 0 && (\n        <div className=\"elements\">\n          {controls.map((element, i) => {\n            return (<div key={i} className=\"device-control-group\">{element}</div>);\n          })}\n        </div>\n      )}\n\n      {unknown.length > 0 && (\n        <>\n          <button onClick={onToggleUnknownHandler} className=\"show-unknown-btn btn btn-outline-info\">Unknown reports ({unknown.length})</button>\n          <div className={`elements unknown ${showUnknown ? \"show\" : \"hide\"}`}>\n            {unknown.map((element, i) => {\n              return (<div key={i} className=\"device-control-group\">{element}</div>);\n            })}\n          </div>\n        </>\n      )}\n    </div>\n  )\n}","import React, {FunctionComponent} from \"react\";\nimport \"./styles.scss\";\nimport {LayoutProps} from \"../../../models/LayoutProps\";\nimport {ZespReportInfo} from \"../../../services/zesp/models/ZespReportInfo\";\nimport {IDeviceClassSettings} from \"./IDeviceClassSettings\";\n\nexport const reportKeysValue = [\"0100060000\", \"0104060000\"];\nexport const reportKeysBattery = [\"010000FF02\"];\n\nconst deviceClasses: { [deviceClass: string]: IDeviceClassSettings } = require(\"./device-classes.json\");\nconst batteryWarningLevelPercents = 50;\nconst batteryValuesRange = [2.7, 3.1]; // battery values to calculate percents from 0 to 100%\n\nexport const BinarySensorLayout: FunctionComponent<LayoutProps> = (props: LayoutProps) => {\n  const value = getValueSettings(props);\n  const battery = getBatterySettings(props);\n\n  return (\n    <div className=\"row custom-binary-layout\">\n      <div className=\"col col-5 left\">\n        <i className={`bi ${value.iconClassName}`}/>\n      </div>\n      <div className=\"col right flex-column justify-content-center\">\n        <div className=\"text-center\">\n          <div>Current status:</div>\n          <div className={value.valueClassName}>{value.valueTitle}</div>\n        </div>\n\n        <div className=\"text-center mt-3 w-100\">\n          <div>Battery Level: <span className={`status ${battery.stateClassName}`}>{battery.valueTitle}</span></div>\n          <div className=\"progress mt-3\">\n            <div\n              className={`progress-bar ${battery.stateClassName}`}\n              role=\"progressbar\"\n              style={{width: `${battery.valuePercents}%`}}/>\n          </div>\n          <div className=\"battery-icon\">\n            <i className={`bi bi-battery-half ${battery.stateClassName}`}/>\n          </div>\n        </div>\n\n      </div>\n    </div>\n  );\n}\n\n// region getValueSettings \nconst getValueSettings = (props: LayoutProps): {\n  iconClassName: string,\n  valueClassName: string,\n  valueTitle: string\n} => {\n  const onOffReport = getReport(reportKeysValue, props);\n  if (!onOffReport) return {\n    iconClassName: deviceClasses[\"default\"].icons!.onFalse,\n    valueClassName: \"status-unknown\",\n    valueTitle: \"Unknown\"\n  }\n\n  // try to get status of binary sensor\n  const statusValue = onOffReport.parsed || onOffReport.val;\n  const roleParts = onOffReport.role && onOffReport.role.split(\"&\");\n  const roleSettings = roleParts && roleParts.length > 1 ? JSON.parse(roleParts[1]) : undefined;\n  const status: boolean = roleSettings && roleSettings[\"payload_on\"]\n    ? statusValue === roleSettings[\"payload_on\"] // compare with role settings\n    : (statusValue === \"1\" || statusValue === \"01\") // compare with default expected\n\n  // views configuration\n  const deviceClass: string = roleSettings && roleSettings[\"device_class\"] || \"default\";\n  const valueSettings: IDeviceClassSettings = {...deviceClasses[\"default\"], ...deviceClasses[deviceClass]};\n\n  const iconClassName = status ? `${valueSettings.icons!.onTrue} ${valueSettings.styles!.onTrue}` : `${valueSettings.icons!.onFalse} ${valueSettings.styles!.onFalse}`;\n  const valueClassName = status ? `status ${valueSettings.styles!.onTrue}` : `status ${valueSettings.styles!.onFalse}`;\n  const valueTitle = status ? valueSettings.titles.onTrue : valueSettings.titles.onFalse;\n\n  return {iconClassName, valueClassName, valueTitle};\n}\n// endregion\n\n// region getBatterySettings\nconst getBatterySettings = (props: LayoutProps): {\n  stateClassName: string,\n  valueTitle: string,\n  valuePercents: number\n} => {\n  const report = getReport(reportKeysBattery, props);\n\n  // return default for unknown\n  if (!report) return {stateClassName: \"??\", valueTitle: \"-\", valuePercents: 0};\n\n  const roleParts = report.role?.split(\"&\");\n  const roleSettings = roleParts && roleParts.length > 1 ? JSON.parse(roleParts[1]) : undefined;\n  const units = roleSettings && roleSettings[\"unit_of_measurement\"] || \"\";\n  const valueString = Number(report.parsed || report.val) || undefined;\n  let valuePercents: number | undefined = undefined;\n\n  // get percents\n  if (!valueString) valuePercents = undefined\n  else if (units === \"%\") valuePercents = Number(valueString);\n  else {\n    let valueNumber = Number(valueString) || undefined;\n    if (valueNumber) {\n      valueNumber = Math.min(batteryValuesRange[1], Math.max(batteryValuesRange[0], valueNumber));\n      valuePercents = Math.round((1 - (batteryValuesRange[1] - valueNumber) / (batteryValuesRange[1] - batteryValuesRange[0])) * 100);\n    }\n  }\n\n  // views configuration\n  const deviceClass: string = roleSettings && roleSettings[\"device_class\"] || \"default\";\n  const valueSettings: IDeviceClassSettings = {...deviceClasses[\"default\"], ...deviceClasses[deviceClass]};\n\n  const valueTitle = `${valueString || \"??\"} ${units}`;\n  const stateClassName = !valuePercents\n    ? \"status-unknown\"\n    : valuePercents <= batteryWarningLevelPercents\n      ? valueSettings.styles!.onFalse\n      : valueSettings.styles!.onTrue;\n\n  return {\n    stateClassName,\n    valuePercents: valuePercents || 0,\n    valueTitle\n  };\n}\n// endregion\n\nconst getReport = (oneOfKeys: string[], props: LayoutProps): ZespReportInfo | undefined => {\n  for (const key of oneOfKeys) {\n    const report = props.device.zespInfo.Report[key];\n    if (report) return report;\n  }\n}","import {DefaultLayout} from \"./DefaultLayout\";\nimport {BinarySensorLayout} from \"./binary-sensor\";\nimport {FunctionComponent} from \"react\";\nimport {LayoutProps} from \"../../models/LayoutProps\";\nimport {ZespReportInfo} from \"../../services/zesp/models/ZespReportInfo\";\nimport {ZespDeviceInfo} from \"../../services/zesp/models/ZespDeviceInfo\";\nimport AutoDetectionBinarySensor from \"./binary-sensor/auto\";\nimport AutoDetectionBleBeacon from \"./ble-beacon/auto\";\nimport BleBeaconLayout from \"./ble-beacon\";\n\n// list of available layouts with names\nexport const layoutsAvailable = {\n  default: DefaultLayout,\n  binarySensorLayout: BinarySensorLayout,\n  bleBeacon: BleBeaconLayout,\n} as { [name: string]: FunctionComponent<LayoutProps> };\n\n// list of layout auto detection functions, which return layout name\nconst autoDetectors: { (zespInfo: ZespDeviceInfo): string | undefined }[] = [\n  AutoDetectionBinarySensor,\n  AutoDetectionBleBeacon,\n];\n\n// region help methods\nexport const layoutTools = {\n  autoDetect: (zespInfo: ZespDeviceInfo): string | undefined => {\n    for (const autoDetector of autoDetectors) {\n      const layout = autoDetector(zespInfo);\n      if (layout) return layout;\n    }\n\n    return undefined;\n  },\n\n  roleDeviceClassIs: (expectedDeviceClasses: string[], report: ZespReportInfo): boolean => {\n    const roleParts = report.role && report.role.split(\"&\");\n    if (roleParts.length < 2) return false;\n\n    const roleSettings = JSON.parse(roleParts[1]);\n    const reportDeviceClass = roleSettings[\"device_class\"];\n    if (!reportDeviceClass) return false;\n\n    return expectedDeviceClasses.indexOf(reportDeviceClass) >= 0;\n  },\n  getReport: (oneOfKeys: string[], zespInfo: ZespDeviceInfo): ZespReportInfo | undefined => {\n    for (const key of oneOfKeys) {\n      const report = zespInfo.Report[key];\n      if (report) return report;\n    }\n  }\n}\n// endregion","import React, {FunctionComponent, useEffect, useState} from \"react\";\nimport {LayoutProps} from \"../../../models/LayoutProps\";\nimport {HighlightOnUpdate} from \"../../../shared/transition/HighlightOnUpdate\";\n\nconst lastUpdateTresholdSeconds = 60 * 5;\n\nexport const BleBeacon: FunctionComponent<LayoutProps> = (props) => {\n  const isInRange = props.device.zespInfo.Report[\"ble_InRange\"]?.parsed === \"1\";\n  const signalLevel = props.device.zespInfo.Report[\"ble_signal_level\"]?.parsed;\n\n  const lastUpdateMs = Math.max(props.device.zespInfo.Report[\"ble_InRange\"].time, props.device.zespInfo.Report[\"ble_signal_level\"].time);\n  const lastDate = new Date(lastUpdateMs);\n  const calculateRelative = () => Math.round((Date.now() - lastUpdateMs) / 1000);\n  const [relative, setRelative] = useState(calculateRelative());\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setRelative(calculateRelative());\n    }, 1000);\n    return () => {\n      clearInterval(timer);\n    }\n  }, [lastUpdateMs]);\n\n  const lastUpdateStyle = relative < lastUpdateTresholdSeconds\n    ? \"status-primary\"\n    : \"status-unknown\";\n\n  const rangeStyle = isInRange\n    ? \"status-primary\"\n    : \"status-unknown\";\n\n  return (\n    <div className=\"row custom-layout\">\n      <div className=\"col col-5 left flex-column position-relative\">\n        <i className={`bi bi-wifi ${rangeStyle}`}/>\n        <div className={`icon-description ${rangeStyle}`}>{isInRange ? \"In range\" : \"Out of range\"}</div>\n      </div>\n      <div className=\"col right flex-column justify-content-center\">\n        <div className=\"text-center\">\n          <div>Signal level:</div>\n          <div className={`status ${rangeStyle}`}><HighlightOnUpdate>{signalLevel}</HighlightOnUpdate></div>\n        </div>\n        <div className=\"text-center mt-3\">\n          <div>Last update:</div>\n          <div className={`status ${lastUpdateStyle}`}>{lastDate.toLocaleDateString()} {lastDate.toLocaleTimeString()}</div>\n          <div className=\"small text-muted opacity-50\">{\n            relative < 60 ? `${relative} seconds ago` :\n              relative / 60 < 60 ? `${Math.round(relative / 60)} minutes ago` :\n                `${Math.round(relative / 60 / 60)} hours ago`\n          }</div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default BleBeacon;","import {ZespDeviceInfo} from \"../../../services/zesp/models/ZespDeviceInfo\";\nimport {reportKeysBattery as binarySensorBatteryKeys, reportKeysValue as binarySensorValueKeys} from \"./index\";\nimport {layoutTools} from \"../index\";\n\nexport const AutoDetectionBinarySensor = (zespInfo: ZespDeviceInfo): string | undefined => {\n  const valueReportKey = layoutTools.getReport(binarySensorValueKeys, zespInfo);\n  const batteryReportKey = layoutTools.getReport(binarySensorBatteryKeys, zespInfo);\n\n  if (!valueReportKey || !batteryReportKey) return undefined; // these two guys required\n  if (!layoutTools.roleDeviceClassIs([\"battery\"], batteryReportKey)) return undefined;\n  if (!layoutTools.roleDeviceClassIs([\"door\", \"motion\"], valueReportKey)) return undefined;\n\n  console.debug(`Auto detected layout 'binarySensorLayout' for '${zespInfo.IEEE}'`);\n  return \"binarySensorLayout\";\n}\n\nexport default AutoDetectionBinarySensor;","import {ZespDeviceInfo} from \"../../../services/zesp/models/ZespDeviceInfo\";\nimport {layoutTools} from \"../index\";\n\nexport const AutoDetectionBleBeacon = (zespInfo: ZespDeviceInfo): string | undefined => {\n  if (zespInfo.DevType !== \"BED\" || zespInfo.class !== \"beacon\") return undefined;\n\n  const rangeReport = layoutTools.getReport([\"ble_InRange\"], zespInfo);\n  const signalReport = layoutTools.getReport([\"ble_signal_level\"], zespInfo);\n  if (!rangeReport || !signalReport) return undefined;\n\n  return \"bleBeacon\";\n}\n\nexport default AutoDetectionBleBeacon;","import {ZespDataEvent} from \"./common/ZespDataEvent\";\nimport {ZespDeviceInfo} from \"./models/ZespDeviceInfo\";\nimport {TypedZespResponseValidator} from \"./common/ZespResponseValidators\";\nimport predefinedDevices from \"../../data/devices.json\";\nimport {DataControlSettings} from \"../../models/DataControlSettings\";\nimport {DeviceInfo} from \"../../models/DeviceInfo\";\nimport {DataDeviceSettings} from \"../../models/DataDeviceSettings\";\nimport {ZespReportInfo} from \"./models/ZespReportInfo\";\nimport {layoutTools} from \"../../device-controls/layouts\";\nimport {IZespConnector} from \"./common/service-connector.interfaces\";\n\ninterface IGetDevicesResponse {\n  devices: DeviceInfo[],\n  zespVersion: string | undefined,\n}\n\nconst ServiceDevices = {\n  getDevicesListAsync: (zesp: IZespConnector) => new Promise<IGetDevicesResponse>((resolve, reject) => {\n    zesp.zespRequestAsync({\n      data: \"getDeviceList\",\n      responseValidator: TypedZespResponseValidator(\"alldev\")\n    })\n      .then(event => {\n        const result = onDevicesListReceived(event);\n        resolve({\n          devices: result,\n          zespVersion: event.dataParts.length > 1 ? event.dataParts[1] : undefined,\n        } as IGetDevicesResponse);\n      })\n      .catch(reason => reject(reason));\n  }),\n\n  subscribeListUpdate: (zesp: IZespConnector, onUpdateHandler: (devices: DeviceInfo[]) => void): void => {\n    // setTimeout(() => zesp.zespSend({data: \"getDeviceList\"}), 3000);\n    zesp.subscribe(TypedZespResponseValidator(\"alldev\"), event => {\n      const result = onDevicesListReceived(event);\n      onUpdateHandler(result);\n    })\n  }\n}\n\n// when list of devices received from ZESP\nconst onDevicesListReceived = (event: ZespDataEvent): DeviceInfo[] => {\n  const jsonString: string = event.dataParts[0];\n  const zespDevices: ZespDeviceInfo[] = [];\n  Object.assign(zespDevices, JSON.parse(jsonString))\n  return zespDevices.map(buildDeviceInfo);\n}\n\nexport const getDeviceModelSettings = (modelId: string): { settings: DataDeviceSettings, controls: DataControlSettings[] } => {\n  const settings: DataDeviceSettings = predefinedDevices.find(x => x.modelIds.findIndex(y => y === modelId) >= 0) || {} as DataDeviceSettings;\n  const controls = settings?.controls && require(`../../data/controls/${settings.controls}`) as DataControlSettings[] || [];\n\n  return {settings, controls};\n}\n\nconst buildDeviceInfo = (zespInfo: ZespDeviceInfo): DeviceInfo => {\n  const {settings, controls} = getDeviceModelSettings(zespInfo.ModelId);\n  controls.forEach(control => {\n    if (!control.reportKey) return;\n    const reportKey = control.reportKey.endpoint + control.reportKey.clusterId + control.reportKey.attributeId;\n    if (!zespInfo.Report[reportKey]) zespInfo.Report[reportKey] = {} as ZespReportInfo;\n  });\n\n  // try to autodetect layout by reports\n  const layout = settings.layout || layoutTools.autoDetect(zespInfo);\n\n  return {\n    zespInfo: zespInfo,\n    settings: {...settings, ...{layout: layout}},\n    customLayout: controls\n  };\n}\n\nexport default ServiceDevices;\n","import {createSlice, PayloadAction} from \"@reduxjs/toolkit\";\nimport {DeviceInfo} from \"../../models/DeviceInfo\";\nimport {RootState} from \"../configure\";\nimport {ZespReportInfo} from \"../../services/zesp/models/ZespReportInfo\";\nimport {ZespReportUpdates} from \"../../services/zesp/service-root\";\nimport {ZespDeviceInfo} from \"../../services/zesp/models/ZespDeviceInfo\";\n\nexport interface DevicesState {\n  devices: DeviceInfo[]\n}\n\nconst initialState: DevicesState = {\n  devices: []\n}\n\nexport const devicesSlice = createSlice({\n  name: \"devices\",\n  initialState,\n  reducers: {\n    setDevices: (state, action: PayloadAction<DeviceInfo[]>): void => {\n      state.devices = action.payload;\n    },\n\n    // like 'setDevices' but keeping root device \n    updateDevices: (state, action: PayloadAction<DeviceInfo[]>): void => {\n      const root = state.devices.find(x => x.zespInfo.ModelId === \"ZESP_Root\");\n      if (!root) {\n        state.devices = action.payload;\n        return;\n      }\n\n      const updateWithoutRoot = action.payload.filter(x => x.zespInfo.ModelId !== \"ZESP_Root\");\n      state.devices = [root, ...updateWithoutRoot];\n    },\n\n    updateDevice: (state, action: PayloadAction<DeviceInfo>): void => {\n      const deviceIndex = state.devices.findIndex(x => x.zespInfo.IEEE === action.payload.zespInfo.IEEE);\n      if (deviceIndex < 0) {\n        state.devices.push(action.payload);\n      } else {\n        state.devices[deviceIndex] = action.payload;\n      }\n    },\n\n    updateZespInfo: (state, action: PayloadAction<ZespDeviceInfo>): void => {\n      const deviceIndex = state.devices.findIndex(x => x.zespInfo.IEEE === action.payload.IEEE);\n      if (deviceIndex < 0) {\n        console.warn(\"Cannot update zesp data, cause device information not found\")\n        return\n      } else {\n        state.devices[deviceIndex].zespInfo = action.payload;\n      }\n    },\n\n    updateReport: (state, action: PayloadAction<{ ieee: string, reportKey: string, update: Partial<ZespReportInfo> }>): void => {\n      const device = state.devices.find(x => x.zespInfo.IEEE === action.payload.ieee);\n      if (!device) {\n        console.warn(`Device '${action.payload.ieee}' not found to update`);\n        return;\n      }\n\n      device.zespInfo.Report[action.payload.reportKey] = {...device.zespInfo.Report[action.payload.reportKey], ...action.payload.update};\n      // console.debug(`Device '${action.payload.ieee}' with report '${action.payload.reportKey}' has been updated`);\n    },\n    updateRootReports: (state, action: PayloadAction<ZespReportUpdates>) => {\n      const device = state.devices.find(x => x.zespInfo.ModelId === \"ZESP_Root\");\n      if (!device) {\n        console.warn(`Root device not found to update`);\n        return;\n      }\n\n      device.zespInfo.Report = {...device.zespInfo.Report, ...action.payload} as { [reportId: string]: ZespReportInfo };\n    },\n\n    updateReportsOrder: (state, action: PayloadAction<{ ieee: string, orderedReportKeys: string[] }>) => {\n      const device = state.devices.find(x => x.zespInfo.IEEE === action.payload.ieee);\n      if (!device) {\n        console.warn(`Root device not found to update`);\n        return;\n      }\n\n      device.zespInfo.Report = action.payload.orderedReportKeys.reduce((a, key) => ({...a, [key]: device.zespInfo.Report[key]}), {});\n    }\n  }\n})\n\nconst getters = {\n  getDeviceByIee: (state: RootState, ieee: string): DeviceInfo | undefined => state.devices.devices.find(x => x.zespInfo.IEEE === ieee),\n  getDevicesByModelId: (state: RootState, modelId: string): DeviceInfo[] => state.devices.devices.filter(x => x.zespInfo.ModelId === modelId),\n  getAllDevices: (state: RootState): DeviceInfo[] => state.devices.devices || [] as DeviceInfo[],\n}\n\nexport const {getDevicesByModelId, getDeviceByIee, getAllDevices} = getters;\nexport const {setDevices, updateReport, updateRootReports, updateDevices, updateDevice, updateZespInfo, updateReportsOrder} = devicesSlice.actions;\nexport default devicesSlice.reducer;\n","import {createSlice, PayloadAction} from \"@reduxjs/toolkit\";\nimport {RootState} from \"../configure\";\nimport {DictionaryStrings} from \"../../models/DictionaryStrings\";\n\ninterface IState {\n  zespFirmwareUpdateInfo: DictionaryStrings | undefined,\n  zespFirmwareInstalledVersion: string,\n  zespSkipVersion: string | undefined,\n}\n\nconst initialState: IState = {\n  zespFirmwareUpdateInfo: undefined,\n  zespFirmwareInstalledVersion: \"-\",\n  zespSkipVersion: undefined,\n}\n\nexport const zespFirmwareSlice = createSlice({\n  name: \"zespFirmwareUpdate\",\n  initialState: initialState,\n  reducers: {\n    setZespFirmwareUpdate: (state, action: PayloadAction<DictionaryStrings>): void => {\n      state.zespFirmwareUpdateInfo = action.payload;\n    },\n\n    setZespFirmwareInstalledVersion: (state, action: PayloadAction<string>): void => {\n      state.zespFirmwareInstalledVersion = action.payload;\n    },\n  }\n});\n\nconst getters = {\n  getZespFirmwareUpdateInfo: (state: RootState) => state.zespFirmware.zespFirmwareUpdateInfo,\n  getZespFirmwareInstalledVersion: (state: RootState) => state.zespFirmware.zespFirmwareInstalledVersion,\n}\n\nexport const {getZespFirmwareUpdateInfo, getZespFirmwareInstalledVersion} = getters;\nexport const {setZespFirmwareUpdate, setZespFirmwareInstalledVersion} = zespFirmwareSlice.actions;\nexport default zespFirmwareSlice.reducer;","import {TypedZespResponseValidator} from \"./common/ZespResponseValidators\";\nimport {ZespDataEvent} from \"./common/ZespDataEvent\";\nimport {ZespRootData} from \"./models/ZespRootData\";\nimport {ZespReportInfo} from \"./models/ZespReportInfo\";\nimport {getDeviceModelSettings} from \"./service-devices\";\nimport {IZespConnector} from \"./common/service-connector.interfaces\";\n\nexport default {\n  getRootDataAsync: (zesp: IZespConnector) => new Promise<ZespReportUpdates>((resolve, reject) => {\n    zesp.zespRequestAsync({\n      data: \"get_Mi_lamp\",\n      responseValidator: TypedZespResponseValidator(\"Mi_lamp\"),\n    })\n      .then(event => {\n        const result = extractReports(event);\n\n        if (result) resolve(result);\n        else reject(\"Cannot update root device information\");\n      })\n      .catch(reason => reject(reason));\n  }),\n}\n\nexport type ZespReportUpdates = {\n  [key: string]: Partial<ZespReportInfo>\n}\n\nconst extractReports = (event: ZespDataEvent): ZespReportUpdates => {\n  const {controls} = getDeviceModelSettings(\"ZESP_Root\");\n  if (controls.length == 0) return {};\n\n  const data = JSON.parse(event.dataParts[0]) as ZespRootData;\n  const result: ZespReportUpdates = {};\n\n  const reportOnOff = controls.find(x => x.id === \"on_off_root\")?.reportKey;\n  if (reportOnOff) result[reportOnOff.endpoint + reportOnOff.clusterId + reportOnOff.attributeId] = {val: data.on.toString()};\n  else console.warn(\"Root device report 'on_off_root' not found\");\n\n  const reportLevel = controls.find(x => x.id === \"level_root\")?.reportKey;\n  if (reportLevel) result[reportLevel.endpoint + reportLevel.clusterId + reportLevel.attributeId] = {val: data.level.toString()};\n  else console.warn(\"Root device report 'level_root' not found\");\n\n  // ZESP returns wrong colors red and blue swapped\n  const reportRgb = controls.find(x => x.id === \"rgb_root\")?.reportKey;\n  if (reportRgb) result[reportRgb.endpoint + reportRgb.clusterId + reportRgb.attributeId] = {val: `${data.B}:${data.G}:${data.R}`};\n  else console.warn(\"Root device report 'rgb_root' not found\");\n\n  const volumeLevel = controls.find(x => x.id === \"level_control\")?.reportKey;\n  if (volumeLevel) result[volumeLevel.endpoint + volumeLevel.clusterId + volumeLevel.attributeId] = {val: data.sound.volume.toString()};\n  else console.warn(\"Root device report 'level_control' not found\");\n\n  const srcRadio = controls.find(x => x.id === \"player_src_root\")?.reportKey;\n  if (srcRadio) result[srcRadio.endpoint + srcRadio.clusterId + srcRadio.attributeId] = {val: data.sound.current_path?.toString()};\n  else console.warn(\"Root device report 'player_src_root' not found\");\n\n  const playControl = controls.find(x => x.id === \"player_control_root\")?.reportKey;\n  if (playControl) result[playControl.endpoint + playControl.clusterId + playControl.attributeId] = {val: data.sound.play.toString()};\n  else console.warn(\"Root device report 'player_control_root' not found\");\n\n  return result;\n}\n\n","import {ZespSettings} from \"./models/ZespSettings\";\nimport {JsonZespResponseValidator, TypedZespResponseValidator} from \"./common/ZespResponseValidators\";\nimport {UiSettings} from \"../../models/UiSettings\";\nimport {IZespConnector} from \"./common/service-connector.interfaces\";\n\nexport const useZespSettings = ({zespRequestAsync, zespSend}: IZespConnector) => {\n  const getAsync = (): Promise<ZespSettings> => new Promise<ZespSettings>((resolve, reject) => {\n    zespRequestAsync({data: \"loadConfig\", responseValidator: TypedZespResponseValidator(\"jsconfig\")})\n      .then(event => parseResponse(event.dataParts[0]))\n      .then(settings => resolve(settings))\n      .catch(error => reject(error));\n  })\n\n  const setAsync = (settings: ZespSettings): Promise<void> => {\n    const data = [\n      \"SaveJson\",\n      \"/jsconfig.txt\",\n      JSON.stringify(settings)\n    ].join(\"|\");\n\n    return new Promise((resolve, reject) => {\n      zespRequestAsync({data: data, responseValidator: TypedZespResponseValidator(\"ZD_RSP\")})\n        .then(event => {\n          // console.log(event);\n          if (event.dataParts[1].toLocaleLowerCase() === \"ok\") resolve();\n          else reject(`Settings was not saved: ${event.response}`)\n        })\n        .catch(error => reject(error));\n    })\n  }\n\n  const getCustomAsync = function getCustom<T>(name: string): Promise<T | undefined> {\n    return zespRequestAsync({\n      data: `LoadJson|/${name}.json`,\n      responseValidator: JsonZespResponseValidator(name)\n    })\n      .then(event => {\n        if (event.dataParts.length < 1) throw new Error(\"Unexpected JSON file response from ZESP\");\n        const jsonStr = event.dataParts[1];\n\n        if (!jsonStr || jsonStr.length === 0 || jsonStr.trim().toLocaleLowerCase() === \"null\") return undefined;\n        return JSON.parse(jsonStr) as T;\n      })\n  }\n\n  const setCustom = function setCustom<T>(name: string, data: T): void {\n    const fileName = `/${name}.json`;\n    const dataStr = JSON.stringify(data);\n\n    zespSend({\n      data: `SaveJson|${fileName}|${dataStr}`\n    });\n  }\n\n  const setUiSettings = (data: UiSettings): void => {\n    setCustom(\"zesp_ui\", data);\n  }\n\n  return {\n    getAsync,\n    setAsync,\n    getCustomAsync,\n    setCustom,\n    setUiSettings,\n  }\n}\n\nfunction parseResponse(jsonString: string): ZespSettings {\n  const json = JSON.parse(jsonString);\n  const result = {} as ZespSettings;\n  Object.assign(result, json);\n\n  return result;\n}\n\nexport default useZespSettings;","import {FirmwareInfo} from \"../../models/FirmwareInfo\";\nimport {TypedZespResponseValidator} from \"./common/ZespResponseValidators\";\nimport {DictionaryStrings} from \"../../models/DictionaryStrings\";\nimport {IZespConnector} from \"./common/service-connector.interfaces\";\n\nexport default {\n  getFirmwareInfoAsync: (zesp: IZespConnector): Promise<FirmwareInfo> => zesp\n    .zespRequestAsync({\n      data: \"loadfwlist\",\n      responseValidator: TypedZespResponseValidator(\"rsploadfwlist\"),\n      timeoutSeconds: 15,\n    }).then(event => {\n      if (event.dataParts.length < 2) throw Error(\"Unexpected zesp firmware information response\");\n\n      const updates = JSON.parse(event.dataParts[0]) as DictionaryStrings[];\n      const currentVersion = event.dataParts[1];\n      if (!updates || updates.length === 0) throw Error(\"Unexpected zesp firmware udpates response\");\n      if (!currentVersion || currentVersion.length === 0) throw Error(\"Unexpected zesp current version response\");\n\n      const result: FirmwareInfo = {\n        currentVersion,\n        updatesInformation: updates[0]\n      };\n\n      return result;\n    }),\n}\n","import {DictionaryStrings} from \"./DictionaryStrings\";\n\nexport type UiSettings = {\n  firmwareUpdate: DictionaryStrings | undefined,\n  firmwareLastCheck: number | undefined,\n  firmwareSkipUpdate: string | undefined,\n}\n\nexport const UiDefaultSettings: UiSettings = {} as UiSettings;","import {createSlice, PayloadAction} from \"@reduxjs/toolkit\";\nimport {RootState} from \"../configure\";\nimport {ZespSettings} from \"../../services/zesp/models/ZespSettings\";\nimport {UiSettings} from \"../../models/UiSettings\";\n\ninterface IState {\n  zespSettings: ZespSettings | undefined,\n  uiSettings: UiSettings | undefined,\n}\n\nconst initialState: IState = {\n  zespSettings: undefined,\n  uiSettings: undefined,\n}\n\nexport const settingsSlice = createSlice({\n  name: \"settings\",\n  initialState,\n  reducers: {\n    setZespSettings: (state, action: PayloadAction<ZespSettings>): void => {\n      state.zespSettings = action.payload;\n    },\n\n    setUiSettings: (state, action: PayloadAction<UiSettings>): void => {\n      state.uiSettings = action.payload;\n    },\n  }\n});\n\nconst getters = {\n  getZespSettings: (state: RootState) => state.settings.zespSettings,\n  getUiSettings: (state: RootState) => state.settings.uiSettings,\n}\n\nexport const {getZespSettings, getUiSettings} = getters;\nexport const {setZespSettings, setUiSettings} = settingsSlice.actions;\nexport default settingsSlice.reducer;\n","import {TypedZespResponseValidator} from \"./common/ZespResponseValidators\";\nimport {ZespDataEvent} from \"./common/ZespDataEvent\";\nimport {ZespDeviceUpdate} from \"./models/ZespDeviceUpdate\";\nimport {ZespReportInfo} from \"./models/ZespReportInfo\";\nimport {IZespConnector} from \"./common/service-connector.interfaces\";\n\nexport default {\n  subscribeToEvents: (zesp: IZespConnector, onReport: (ieee: string, reportKey: string, updates: Partial<ZespReportInfo>) => void) => {\n    zesp.subscribe(TypedZespResponseValidator(\"rep\"), event => onUpdate(event, onReport))\n  }\n}\n\nconst onUpdate = (event: ZespDataEvent, onReport: (ieee: string, reportKey: string, updates: Partial<ZespReportInfo>) => void): void => {\n  // we are expecting 'rep|{...}' string\n  if (event.dataParts.length < 2) {\n    console.warn(\"Unknown format of updated received\");\n    console.warn(event.response);\n    return;\n  }\n\n  const ieee = event.dataParts[1];\n  const data = JSON.parse(event.dataParts[0]) as ZespDeviceUpdate;\n  const reportKey = data.EndPoint + data.ClusterId + data.AttribId;\n  const report = {\n    parsed: data.parsed,\n    val: data.Data,\n    time: data.time,\n  } as Partial<ZespReportInfo>\n\n  onReport(ieee, reportKey, report);\n}","import {Dispatch} from \"redux\";\nimport {setConnectionStatus} from \"../../store/slices/zespSlice\";\nimport {IServerInfo} from \"../../pages/welcome/interfaces\";\nimport ServiceDevices from \"../../services/zesp/service-devices\";\nimport {setDevices, updateDevices, updateReport, updateRootReports} from \"../../store/slices/devicesSlice\";\nimport {setZespFirmwareInstalledVersion, setZespFirmwareUpdate} from \"../../store/slices/zespFirmwareSlice\";\nimport ServiceRoot from \"../../services/zesp/service-root\";\nimport useZespSettings from \"../../services/zesp/zespSettings.hook\";\nimport ServiceFirmware from \"../../services/zesp/service-firmware\";\nimport {UiDefaultSettings, UiSettings} from \"../../models/UiSettings\";\nimport {setUiSettings} from \"../../store/slices/settingsSlice\";\nimport {useRef} from \"react\";\nimport {ZespReportInfo} from \"../../services/zesp/models/ZespReportInfo\";\nimport ServiceUpdates from \"../../services/zesp/service-report-updates\";\nimport {IZespConnector} from \"../../services/zesp/common/service-connector.interfaces\";\nimport {DeviceInfo} from \"../../models/DeviceInfo\";\n\nexport const useZespAgent = (dispatch: Dispatch, zesp: IZespConnector) => {\n  const uiSettingsRef = useRef<UiSettings>({} as UiSettings);\n  const firmwareUpdateMinTimout = 1000 * 60 * 60 * 24;\n\n  // init\n  const connectAsync = (server: IServerInfo): Promise<void> => zesp\n    .connectAsync(server, (status) => dispatch(setConnectionStatus(status)), false)\n\n  // read devices list\n  const getDevices = (): Promise<void> => ServiceDevices.getDevicesListAsync(zesp)\n    .then(result => {\n      dispatch(setDevices(result.devices));\n      if (result.zespVersion) dispatch(setZespFirmwareInstalledVersion(result.zespVersion));\n    });\n\n  // read root info\n  const getRoot = (): Promise<void> => ServiceRoot\n    .getRootDataAsync(zesp)\n    .then(reports => {\n      dispatch(updateRootReports(reports))\n      console.debug(\"Root device reports updated\");\n    });\n\n  // read ui settings\n  const readUiSettings = (): Promise<void> => useZespSettings(zesp)\n    .getCustomAsync<UiSettings>(\"zesp_ui\")\n    .then(settings => {\n      const result = settings || UiDefaultSettings;\n      dispatch(setUiSettings(result))\n      uiSettingsRef.current = result;\n    })\n\n  // private firmware updates downloading\n  const _getFirmware = (): void => {\n    ServiceFirmware\n      .getFirmwareInfoAsync(zesp)\n      .then(firmwareInfo => {\n        dispatch(setZespFirmwareInstalledVersion(firmwareInfo.currentVersion));\n        dispatch(setZespFirmwareUpdate(firmwareInfo.updatesInformation));\n\n        uiSettingsRef.current = {...uiSettingsRef.current, ...{firmwareUpdate: firmwareInfo.updatesInformation, firmwareLastCheck: Date.now()}};\n        useZespSettings(zesp).setCustom(\"zesp_ui\", uiSettingsRef.current);\n\n        dispatch(setUiSettings(uiSettingsRef.current));\n        console.debug(\"Firmware updates information loaded\");\n      })\n      .catch(reason => {\n        console.warn(\"Cannot read Firmware update information\");\n        console.warn(reason);\n      });\n  }\n\n  // read firmware updates\n  const readFirmwareUpdates = (): Promise<void> => {\n    const uiSettings = uiSettingsRef.current\n    if (!uiSettings) throw new Error(\"Read UI settings before firmware checking\");\n\n    if (uiSettings.firmwareUpdate && uiSettings.firmwareLastCheck && (Date.now() - uiSettings.firmwareLastCheck) < firmwareUpdateMinTimout) {\n      dispatch(setZespFirmwareUpdate(uiSettings.firmwareUpdate));\n      console.debug(\"Firmware information read from settings\");\n      return Promise.resolve();\n    }\n\n    // run firmware loading in background\n    _getFirmware();\n\n    return Promise.resolve();\n  }\n\n  // subscribe to report updates events\n  const subscribeReportUpdates = (): Promise<void> => {\n    const onReport = (ieee: string, reportKey: string, update: Partial<ZespReportInfo>) =>\n      dispatch(updateReport({ieee, reportKey, update}));\n\n    ServiceUpdates.subscribeToEvents(zesp, onReport);\n    return Promise.resolve();\n  }\n\n  const subscribeDevicesListUpdate = (): Promise<void> => {\n    const onUpdate = (devices: DeviceInfo[]): void => {\n      // devices.pop();\n      dispatch(updateDevices(devices));\n      console.debug(\"Devices list updated\");\n    }\n\n    ServiceDevices.subscribeListUpdate(zesp, onUpdate);\n    return Promise.resolve();\n  }\n\n  return {\n    connectAsync,\n    getDevices,\n    getRoot,\n    readUiSettings,\n    readFirmwareUpdates,\n    subscribeReportUpdates,\n    subscribeDevicesListUpdate,\n  }\n}\n\nexport default useZespAgent;","const Result = {\n  // delay before connection start\n  ConnectionStartTimeout: 100,\n\n  // connection verify interval\n  RestartConnectionTimeout: 5000,\n\n  // default timeout for requests in seconds \n  DefaultRequestTimeoutSeconds: 5,\n\n  // connection checker interval, should be greater then 'DefaultRequestTimeoutSeconds' \n  WatcherIntervalSeconds: 15,\n}\n\nexport default Result;","export const ZespDataEventType = \"zesp-data-received\";\n\nexport class ZespDataEvent extends Event {\n  readonly dataType: string;\n  readonly response: string;\n  readonly dataParts: string[];\n\n  constructor(dataType: string, dataParts: string[], response: string) {\n    super(ZespDataEventType);\n\n    this.dataType = dataType;\n    this.dataParts = dataParts;\n    this.response = response;\n  }\n}","import {Websocket, WebsocketBuilder} from \"websocket-ts\";\nimport {IServerInfo} from \"../../../pages/welcome/interfaces\";\nimport Constants from \"./Constants\";\nimport {IZespResponseValidator} from \"../interfaces/IZespResponseValidator\";\nimport {ZespDataEvent, ZespDataEventType} from \"./ZespDataEvent\";\nimport {IRequestAsyncArgs, ISendArgs, ZespConnectedAction, ZespConnectorHandler, ZespConnectorListener} from \"./service-connector.interfaces\";\nimport {AllMessagesZespResponseValidator} from \"./ZespResponseValidators\";\n\nexport const useZespConnector = () => {\n  const _onMessageEvent = new EventTarget();\n  let _ws: Websocket | undefined = undefined;\n  let _server: IServerInfo | undefined;\n  let _lastMessageTimestamp: number = Date.now();\n  let _watcher: NodeJS.Timeout | undefined = undefined;\n\n  const _onMessageReceived = (ws: Websocket, e: MessageEvent) => {\n    _lastMessageTimestamp = Date.now();\n    const messageParts = e.data\n      .replace(/\\|(?=([^\"]*\"[^\"]*\")*[^\"]*$)/ig, \"\\x00\")\n      .split(\"\\x00\");\n\n    if (messageParts.length == 0) {\n      console.warn(\"Received empty message from zesp\");\n      return;\n    }\n\n    let messageType = messageParts.shift();\n\n    const jsonMatch = /\\/(.+)\\.json/ig.exec(messageType);\n    if (jsonMatch) {\n      messageParts.unshift(messageType);\n      messageType = \"json\";\n    }\n\n    const resultEvent = new ZespDataEvent(messageType, messageParts, e.data);\n    _onMessageEvent.dispatchEvent(resultEvent);\n  }\n\n  const _tryToCloseWS = (): boolean => {\n    if (_ws) {\n      try {\n        _ws.close(1000);\n        return true;\n      } catch {\n        // it's ok :P\n      }\n    }\n    return false;\n  }\n\n  const _tryConnectWs = (zespStatusChangeHandler: ZespConnectedAction) => new Promise<void>((resolve, reject) => {\n    const protocol = document.location.protocol === \"https:\" ? \"wss\" : \"ws\";\n    const serverAddress = `${protocol}://${_server!.address}:81`;\n    console.debug(`Create connection to ${serverAddress}`)\n    _ws = new WebsocketBuilder(serverAddress)\n      .onOpen(() => {\n        console.debug(\"ZESP connected\");\n        zespStatusChangeHandler(\"connected\");\n        resolve();\n      })\n      .onClose(() => {\n        console.debug(\"ZESP connection closed\");\n        zespStatusChangeHandler(\"closed\");\n        reject(\"ZESP connection closed\");\n      })\n      .onError(() => reject(\"ZESP connection error\"))\n      .onMessage(_onMessageReceived)\n      .build();\n  });\n\n  const _getBinaryData = (message: string): Uint8Array => {\n    const data = message.replaceAll(\" \", \"\");\n    const dataHex = data.match(/[\\da-f]{2}/gi)?.map(group => parseInt(group, 16)) as ArrayLike<number>;\n    return new Uint8Array(dataHex);\n  }\n\n  const _pingAsync = (): Promise<ZespDataEvent> =>\n    zespRequestAsync({data: \"LoadJson|/ping.json\", responseValidator: AllMessagesZespResponseValidator})\n\n  const _runWatcher = (zespStatusChangeHandler: ZespConnectedAction): Promise<void> => {\n    if (_watcher) {\n      console.debug(\"Stop old watcher\");\n      clearInterval(_watcher);\n    }\n\n    console.debug(\"Start watcher\");\n    _watcher = setInterval(() => {\n      if (_ws?.underlyingWebsocket?.readyState !== 1) return;\n\n      const periodWithoutMessageSeconds = (Date.now() - _lastMessageTimestamp) / 1000;\n      if (periodWithoutMessageSeconds > Constants.WatcherIntervalSeconds) {\n        _lastMessageTimestamp = Date.now() + Constants.DefaultRequestTimeoutSeconds * 1000;\n        if (_watcher) clearInterval(_watcher); // stop watcher until 'ping' finished\n        \n        _pingAsync()\n          .then(() => _runWatcher(zespStatusChangeHandler)) // everything fine, continue watching\n          .catch(() => zespStatusChangeHandler(\"reconnect\")); // oops, try to restart. Do not start watcher at the moment\n      }\n    }, 5000);\n\n    return Promise.resolve();\n  }\n\n  const connectAsync = (server: IServerInfo, zespStatusChangeHandler: ZespConnectedAction, force: boolean) => {\n    _server = server;\n    return new Promise<void>((resolve, reject) => {\n      console.debug(\"Start WS connection...\");\n\n      if (!force) {\n        if (_ws?.underlyingWebsocket?.readyState === 0) {\n          reject(\"Already connecting\");\n          return;\n        }\n\n        if (_ws?.underlyingWebsocket?.readyState === 1) {\n          console.debug(\"ZESP already connected, skip connection\");\n          resolve();\n          return;\n        }\n      }\n\n      _tryToCloseWS();\n      _tryConnectWs(zespStatusChangeHandler)\n        .then(() => _runWatcher(zespStatusChangeHandler))\n        .then(resolve)\n        .catch(reject);\n    })\n  }\n\n  const zespSend = (args: ISendArgs): void => {\n    if (!_ws) {\n      console.warn(\"WebSocket client is not initialized yet\");\n      return;\n    }\n\n    const data = args.isBinary === true\n      ? _getBinaryData(args.data)\n      : args.data;\n\n    _ws.send(data);\n  }\n\n  const zespRequestAsync = (args: IRequestAsyncArgs) => new Promise<ZespDataEvent>((resolve, reject) => {\n    if (!args.timeoutSeconds || args.timeoutSeconds <= 0) args.timeoutSeconds = Constants.DefaultRequestTimeoutSeconds;\n    if (args.isBinary !== true) args.isBinary = false;\n\n    let responseReceived = false;\n    const validator = args.responseValidator;\n\n    // on response received from zesp\n    const listener = (event: Event) => {\n      const result = event as ZespDataEvent;\n      if (!validator.isValid(result)) return;\n\n      responseReceived = true;\n      _onMessageEvent.removeEventListener(ZespDataEventType, listener);\n      resolve(result);\n    }\n\n    // if no response for a specific time (timeout)\n    const onTimeout = () => {\n      if (responseReceived) return;\n\n      _onMessageEvent.removeEventListener(ZespDataEventType, listener);\n      console.warn(`zesp response did not received (timeout: ${args.timeoutSeconds} seconds)`);\n      reject(\"timeout\");\n    };\n\n    // send request\n    try {\n      _onMessageEvent.addEventListener(ZespDataEventType, listener);\n      zespSend({data: args.data, isBinary: args.isBinary})\n      setTimeout(onTimeout, args.timeoutSeconds * 1000);\n    } catch (error) {\n      reject(`exception: ${error}`);\n    }\n  })\n\n  const subscribe = (validator: IZespResponseValidator, handler: ZespConnectorHandler): ZespConnectorListener => {\n    const listener = (event: Event): void => {\n      const zespEvent = event as ZespDataEvent;\n      if (!validator.isValid(zespEvent)) return;\n\n      handler(zespEvent);\n    }\n\n    _onMessageEvent.addEventListener(ZespDataEventType, listener)\n    return listener;\n  }\n\n  const unsubscribe = (listener: ZespConnectorListener) => _onMessageEvent.removeEventListener(ZespDataEventType, listener)\n\n  const getServerAddress = () => _server?.address;\n\n  return {\n    connectAsync,\n    zespSend,\n    zespRequestAsync,\n    subscribe,\n    unsubscribe,\n    getServerAddress,\n  }\n}\n\nexport default useZespConnector;","import React, {Fragment, useContext, useEffect, useRef, useState} from \"react\";\nimport {IServerInfo} from \"../../pages/welcome/interfaces\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport {getStatus, setConnectionStatus, setInitialized} from \"store/slices/zespSlice\";\nimport useZespAgent from \"./ZespAgent.hook\";\nimport useZespConnector from \"../../services/zesp/common/service-connector\";\nimport Constants from \"../../services/zesp/common/Constants\";\nimport {IZespConnector} from \"../../services/zesp/common/service-connector.interfaces\";\n\ninterface IProps {\n  server: IServerInfo\n}\n\nexport const ZespContext = React.createContext<IZespConnector>(useZespConnector());\n\nexport const ZespAgent: React.FC<IProps> = ({server, children})\n  : React.ReactElement => {\n  const dispatch = useDispatch();\n  const zespStatus = useSelector(getStatus);\n  const [zesp, setZesp] = useState(useContext(ZespContext));\n  const _restartTimerRef = useRef<NodeJS.Timeout | undefined>(undefined);\n\n  useEffect(() => {\n    if (zespStatus === \"reconnect\") {\n      setZesp(useZespConnector());\n      dispatch(setConnectionStatus(\"disconnected\"));\n    }\n\n    console.debug(`ZESP agent status: ${zespStatus}`);\n  }, [zespStatus])\n\n  const {\n    connectAsync,\n    getDevices,\n    getRoot,\n    readUiSettings,\n    readFirmwareUpdates,\n    subscribeReportUpdates,\n    subscribeDevicesListUpdate,\n  } = useZespAgent(dispatch, zesp);\n\n  if (zespStatus === \"connected\") return (\n    <ZespContext.Provider value={zesp}>\n      {children}\n    </ZespContext.Provider>\n  );\n\n  if (zespStatus === \"closed\") {\n    if (_restartTimerRef.current) {\n      clearTimeout(_restartTimerRef.current);\n      _restartTimerRef.current = undefined;\n    }\n\n    _restartTimerRef.current = setTimeout(() => {\n      if (zespStatus === \"closed\") {\n        dispatch(setConnectionStatus(\"reconnect\"));\n      } else {\n        console.debug(`Cancel restarting, cause status: ${zespStatus}`);\n      }\n    }, Constants.RestartConnectionTimeout);\n  }\n\n  if (zespStatus !== \"disconnected\") return (<Fragment/>);\n  dispatch(setConnectionStatus(\"connecting\"));\n  connectAsync(server)\n    .then(getDevices)\n    .then(getRoot)\n    .then(readUiSettings)\n    .then(readFirmwareUpdates)\n    .then(subscribeReportUpdates)\n    .then(subscribeDevicesListUpdate)\n\n    // final steps\n    .then(() => dispatch(setInitialized(true)))\n    .catch(reason => console.error(reason))\n    .finally(() => {\n      setZesp(zesp);\n      console.debug(\"ZESP initialization completed\");\n    });\n\n  return (<Fragment/>);\n}\n","import {DataControlSettings, DataLayoutItemsGroup} from \"../models/DataControlSettings\";\nimport {DataReportInfo} from \"../models/DataReportInfo\";\nimport DataHaClusterIds from \"../data/reports.json\";\nimport {DeviceInfo} from \"../models/DeviceInfo\";\nimport {ReportKeyInfo} from \"../models/ReportKeyInfo\";\n\nconst defaultLayoutGroupName = \"main\";\n\nexport const Devices = {\n  getControlGroups: (device: DeviceInfo): DataLayoutItemsGroup[] => {\n    const layout = device.customLayout && device.customLayout.length > 0\n      ? device.customLayout\n      : buildLayoutSettingsFromZesp(device);\n\n    // group by group name (undefined groups will be saved as 'main')\n    return layout.reduce((r, x) => {\n      const groupName = x.group || defaultLayoutGroupName;\n      let group = r.find(x => x.name === groupName);\n      if (!group) {\n        group = {name: groupName} as DataLayoutItemsGroup;\n        r.push(group);\n      }\n\n      group.settings = [...group.settings || [], x];\n\n      return r;\n    }, [] as DataLayoutItemsGroup[]);\n  },\n\n  getReportKeyDetails: (reportKey: string, deviceType: string): ReportKeyInfo | undefined => {\n    if (!deviceType || deviceType === \"ZED\" || deviceType === \"ZR\") {\n      if (reportKey?.length !== 10) // 01 0000 0000\n      {\n        console.warn(`Unknown format of Zigbee report key: '${reportKey}'`);\n        return undefined;\n      }\n\n      return {\n        endpoint: reportKey.substr(0, 2),\n        clusterId: reportKey.substr(2, 4),\n        attributeId: reportKey.substr(6),\n      }\n    }\n\n    if (deviceType === \"BED\") {\n      if (reportKey?.length < 1) // a-ny-thing\n      {\n        console.warn(`Unknown format of BLE report key: '${reportKey}'`);\n        return undefined;\n      }\n\n      return {\n        endpoint: \"\",\n        clusterId: reportKey,\n        attributeId: \"\",\n      }\n    }\n\n    console.warn(`Unknown device type '${deviceType}'`);\n    return undefined;\n  },\n}\n\nconst buildLayoutSettingsFromZesp = (device: DeviceInfo): DataControlSettings[] => {\n  const getLayoutItem = (reportKey: string): DataControlSettings | undefined => {\n    const reportKeyInfo = Devices.getReportKeyDetails(reportKey, device.zespInfo.DevType);\n    if (!reportKeyInfo) {\n      console.warn(`Cannot get report key details for '${device.zespInfo.IEEE}' device`);\n      return undefined;\n    }\n\n    const registeredCluster = (DataHaClusterIds as DataReportInfo[]).find(x => x.clusterId == reportKeyInfo.clusterId);\n\n    const result = {\n      id: reportKeyInfo.clusterId,\n      reportKey: reportKeyInfo\n    } as DataControlSettings;\n\n    // if cluster information not found\n    if (!registeredCluster) {\n      console.debug(`Report key '${reportKey}' with unregistered cluster '${reportKeyInfo.clusterId}' received`);\n      return result;\n    }\n\n    // build layout based on role\n    const report = device.zespInfo.Report[reportKey];\n    const roleParts = report.role?.split(\"&\");\n    if (roleParts && roleParts.length > 0)\n      return {...result, ...buildLayoutItemForRole(roleParts, registeredCluster, reportKey, device.zespInfo.DevType)};\n\n    // otherwise build layout based on cluster\n    const attributeInfo = registeredCluster.attributes && registeredCluster.attributes[reportKeyInfo.attributeId];\n    if (!attributeInfo) return result;\n\n    return attributeInfo;\n  }\n\n  const reportKeys = Object.keys(device.zespInfo.Report);\n  return reportKeys.map(key => getLayoutItem(key)).filter(x => x !== undefined) as DataControlSettings[];\n}\n\nconst buildLayoutItemForRole = (roleParts: string[], dataCluster: DataReportInfo, reportKey: string, deviceType: string): DataControlSettings | undefined => {\n  // return undefined;\n  const reportKeyInfo = Devices.getReportKeyDetails(reportKey, deviceType);\n  if (!reportKeyInfo) return undefined;\n\n  const roleName = roleParts[0];\n  const roleSettings = roleParts.length > 1 ? roleParts[1] : null;\n  const layoutItem = !dataCluster.attributes\n    ? {id: roleName} as DataControlSettings // if no attributes at all\n    : dataCluster.attributes[`${reportKeyInfo.attributeId}:${roleName}`]\n    || dataCluster.attributes[roleName]\n    || {id: roleName} as DataControlSettings; // if required attribute not found\n\n  // add role configured settings\n  if (roleSettings)\n    layoutItem.zespRoleSettings = JSON.parse(roleSettings);\n\n  return layoutItem;\n}","import {DeviceInfo} from \"../../models/DeviceInfo\";\nimport {useContext} from \"react\";\nimport {ZespContext} from \"../../shared/agents/ZespAgent\";\nimport {useSelector} from \"react-redux\";\nimport {getAllDevices} from \"../../store/slices/devicesSlice\";\nimport {DeviceListItem} from \"../../models/DeviceListItem\";\nimport {ZespReportInfo} from \"../../services/zesp/models/ZespReportInfo\";\nimport {Devices} from \"../../services/devices\";\nimport HomeAutoClusters from \"../../data/reports.json\";\nimport {DataReportInfo} from \"../../models/DataReportInfo\";\n\nexport default () => {\n  const {getServerAddress} = useContext(ZespContext)\n  const devices = useSelector(getAllDevices, devicesUpdateDetector)\n\n  const serverAddress = getServerAddress() || \"/\"\n  const deviceItems = [...devices]\n    .sort(devicesSorting)\n    .map(x => buildListItem(x, serverAddress))\n\n  return {\n    serverAddress,\n    deviceItems,\n  }\n}\n\n// region tools\n\nconst devicesUpdateDetector = (a: DeviceInfo[], b: DeviceInfo[]) => {\n  if (a.length !== b.length) return false;\n  for (let i = 0; i < a.length; i++) {\n    if (a[i].zespInfo.Name !== b[i].zespInfo.Name) return false;\n  }\n\n  return true;\n}\n\nconst devicesSorting = (a: DeviceInfo, b: DeviceInfo): number => {\n  if (a.zespInfo.ModelId === \"ZESP_Root\") return -1;\n  if (b.zespInfo.ModelId === \"ZESP_Root\") return 1;\n\n  if (a.zespInfo.ModelId < b.zespInfo.ModelId) return -1;\n  if (a.zespInfo.ModelId > b.zespInfo.ModelId) return 1;\n\n  return 0;\n}\n\nconst buildListItem = (device: DeviceInfo, serverAddress: string): DeviceListItem => {\n  const title = device.zespInfo.Name && device.zespInfo.Name.length > 0 ? device.zespInfo.Name : device.zespInfo.ModelId;\n  const image = getImageUrl(device, serverAddress);\n  const tags = getTagsFromReports(device.zespInfo.Report, device.zespInfo.DevType);\n\n  return {\n    title,\n    ieee: device.zespInfo.IEEE,\n    image,\n    tags\n  };\n}\n\nconst getImageUrl = (device: DeviceInfo, serverAddress: string): string => {\n  // device.settings?.image || device.zespInfo.Img\n  if (device.settings?.image)\n    return `${process.env.PUBLIC_URL}/device-images/${device.settings.image}`;\n\n  if (device.zespInfo.Img)\n    return `http://${serverAddress}:8081/${device.zespInfo.Img}`\n\n  const modelId = device.zespInfo.ModelId;\n  return `http://${serverAddress}:8081/img/${modelId}.jpg`;\n}\n\nconst getTagsFromReports = (reports: { [key: string]: ZespReportInfo }, deviceType: string): string[] => {\n  const result: string[] = [];\n\n  for (const key of Object.keys(reports)) {\n    const reportKeyDetails = Devices.getReportKeyDetails(key, deviceType);\n\n    if (!reportKeyDetails) {\n      console.warn(`Cannot read report '${key}' details for '${deviceType}' device type`);\n      continue;\n    }\n\n    const clusterInfo = HomeAutoClusters.find(x => x.clusterId === reportKeyDetails.clusterId) as DataReportInfo | undefined\n    result.push(clusterInfo?.name || reportKeyDetails.clusterId);\n  }\n\n  return result\n    .filter((x, i) => result.indexOf(x) == i)\n    .sort((a, b) => a > b ? 1 : -1);\n}\n\n// endregion\n","import React, {useEffect, useState} from \"react\";\nimport {DeviceListItem} from \"../../models/DeviceListItem\";\n\ninterface IProps {\n  device: DeviceListItem\n}\n\nconst defaultImage = \"/device-images/default.png\";\n\nexport default (props: IProps) => {\n  const [image, setImage] = useState(props.device.image);\n\n  useEffect(() => {\n    const testImage = new Image();\n    testImage.onerror = () => {\n      setImage(defaultImage);\n    }\n    testImage.src = image;\n  }, []);\n\n  return (<div className=\"item-image\" style={{backgroundImage: `url(${image})`}}/>);\n}","import React from \"react\";\nimport ItemImage from \"./item-image\";\nimport {NavLink} from \"react-router-dom\";\nimport {DeviceListItem} from \"../../models/DeviceListItem\";\nimport {Col} from \"react-bootstrap\";\n\ninterface IProps {\n  device: DeviceListItem\n}\n\nexport default (props: IProps) => {\n  const {device} = props;\n  const detailsLink = `/devices/${device.ieee}`;\n\n  return (\n    <Col xs={12} sm={6} lg={4} xxl={3} className=\"p-1\">\n      <NavLink className=\"item p-3 border rounded d-block\" to={detailsLink}>\n        <div className=\"d-flex\">\n          <div><ItemImage device={props.device}/></div>\n          <div className=\"ps-2\">\n            <div className=\"title\">{device.title}</div>\n            <div className=\"ieee text-muted small\">{device.ieee}</div>\n            {device.tags.length > 0 && (\n              <div className=\"badges small text-wrap\">\n                {device.tags.map((x, i) => (<span key={i} className=\"badge bg-secondary\">{x}</span>))}\n              </div>\n            )}\n          </div>\n        </div>\n      </NavLink>\n    </Col>\n  );\n}\n","import React, {FormEvent, useEffect, useState} from \"react\";\nimport {Form, Modal} from \"react-bootstrap\";\n\ninterface IProps {\n  title: string,\n  className?: string,\n  size?: 'sm' | 'lg' | 'xl',\n  footer?: React.ReactElement | undefined,\n  forceClose?: boolean,\n  onShow?: () => void,\n  onHide?: () => void,\n  onClosed?: () => void,\n  onSubmit?: () => void,\n}\n\nexport const AppDialog: React.FunctionComponent<IProps> = ({\n  children,\n  title,\n  size,\n  className,\n\n  footer,\n  forceClose,\n  onShow,\n  onHide,\n  onClosed,\n  onSubmit,\n}): React.ReactElement => {\n  const [show, setShow] = useState(true);\n  useEffect(() => {\n    if (forceClose) setShow(false);\n  }, [forceClose]);\n\n  const onClosedHandler = () => {\n    if (onClosed) onClosed();\n  }\n\n  const onHideHandler = () => {\n    setShow(false)\n    if (onHide) onHide();\n  }\n\n  const onSubmitHandler = (event: FormEvent) => {\n    event.preventDefault();\n\n    if (onSubmit) onSubmit();\n  }\n\n  const result = (\n    <>\n      <Modal.Header>\n        <div>{title}</div>\n        <div className=\"text-end modal-right-buttons\">\n          <button type=\"button\" className=\"btn-close me-1\" aria-label=\"Close\" onClick={onHideHandler}/>\n        </div>\n      </Modal.Header>\n      <Modal.Body className=\"text-start\">\n        {children}\n      </Modal.Body>\n\n      {footer && (\n        <Modal.Footer>\n          {footer}\n        </Modal.Footer>\n      )}\n    </>\n  )\n\n  return (\n    <Modal show={show} onExited={onClosedHandler} onHide={onHideHandler} onShow={onShow} className={className} size={size}>\n      {onSubmit && (<Form onSubmit={onSubmitHandler}>{result}</Form>)}\n      {!onSubmit && result}\n    </Modal>\n  )\n}","import React from \"react\";\nimport useHook from \"./hook\";\nimport {AppDialog} from \"../../../shared/app-dialog\";\nimport {Col, Form, ProgressBar, Row} from \"react-bootstrap\";\n\ninterface IProps {\n  onClosed: () => void,\n}\n\nexport const AddZigbeeDialog: React.FC<IProps> = ({\n  onClosed\n}): React.ReactElement => {\n\n  const {\n    isCompleted,\n    logs,\n    onChannelChangedHandler\n  } = useHook();\n\n  const channels: React.ReactElement[] = []\n  for (let channel = 11; channel <= 26; channel++)\n    channels.push(<option>{channel}</option>);\n\n  return (\n    <AppDialog title=\"Add Zigbee device\" onClosed={onClosed} className=\"add-zigbee-dialog\">\n      {!isCompleted && (\n        <>\n          <Row className=\"mb-3 align-items-center\">\n            <Col>I'm ready to pair new devices on channels:</Col>\n            <Col xs={3}>\n              <Form.Select className=\"d-inline-block\" onChange={event => onChannelChangedHandler(event.currentTarget.value)}>\n                <option value=\"\">All</option>\n                {channels}\n              </Form.Select>\n            </Col>\n          </Row>\n\n          <ProgressBar animated={true} striped={true} now={100}/>\n        </>\n      )}\n      {isCompleted && (\n        <>\n          <p>Pairing completed. To set device template or edit reports, click to device and choose <span className=\"badge bg-secondary\">Edit</span> in settings.</p>\n          <ProgressBar now={100} variant=\"success\" label=\"Completed\"/>\n        </>\n      )}\n      {logs.length > 0 && (<div className=\"logs\" dangerouslySetInnerHTML={{__html: logs}}/>)}\n    </AppDialog>\n  )\n}\n\nexport default AddZigbeeDialog;","import {useContext, useEffect, useRef, useState} from \"react\";\nimport \"./styles.scss\";\nimport {ZespContext} from \"../../../shared/agents/ZespAgent\";\nimport {TypedZespResponseValidator} from \"../../../services/zesp/common/ZespResponseValidators\";\nimport {ZespConnectorListener} from \"../../../services/zesp/common/service-connector.interfaces\";\nimport {ZespDataEvent} from \"../../../services/zesp/common/ZespDataEvent\";\n\nexport default () => {\n  const {zespSend, subscribe, unsubscribe} = useContext(ZespContext)\n  const [logs, setLogs] = useState(\"\")\n  const logRef = useRef(logs)\n  const [isCompleted, setIsCompleted] = useState(false)\n  const isCompletedRef = useRef(isCompleted);\n  const joinListenerRef = useRef<ZespConnectorListener>()\n  const allDevListenerRef = useRef<ZespConnectorListener>()\n\n  useEffect(() => {\n    console.debug(\"start pairing...\");\n    joinListenerRef.current = subscribe(TypedZespResponseValidator(\"join\"), onJoinReceivedHandler);\n    allDevListenerRef.current = subscribe(TypedZespResponseValidator(\"alldev\"), onAllDevReceivedHandler)\n    zespSend({data: \"addDevice\"});\n\n    return () => {\n      stopPairing()\n      stopListening()\n    }\n  }, []);\n\n  const stopPairing = (): void => {\n    if (!isCompletedRef.current) {\n      console.debug(\"stop pairing\")\n      zespSend({data: \"addDeviceDone\"})\n    }\n  }\n\n  const stopListening = (): void => {\n    if (joinListenerRef.current) {\n      unsubscribe(joinListenerRef.current)\n      joinListenerRef.current = undefined\n    }\n\n    if (allDevListenerRef.current) {\n      unsubscribe(allDevListenerRef.current)\n      allDevListenerRef.current = undefined\n    }\n  }\n\n  const onJoinReceivedHandler = (event: ZespDataEvent): void => {\n    let message = event.dataParts[0];\n    if (message.includes(\": timeout\")) message = `<div class=\"warning\">${message}</div>`;\n\n    const messages = logRef.current + message;\n    logRef.current = messages;\n    setLogs(messages);\n  }\n\n  const onAllDevReceivedHandler = (event: ZespDataEvent): void => {\n    stopPairing();\n\n    setIsCompleted(true);\n    isCompletedRef.current = true;\n  }\n\n  const onChannelChangedHandler = (channel: string): void => {\n    zespSend({data: `addDevice||${channel}`});\n  }\n\n  return {\n    logs,\n    isCompleted,\n    onChannelChangedHandler,\n  }\n}","import React from \"react\";\nimport useHook from \"./hook\";\nimport {Dropdown, DropdownButton} from \"react-bootstrap\";\nimport AddZigbeeDialog from \"../add-zigbee-dialog\";\n\nexport const AddDeviceButton: React.FC = (): React.ReactElement => {\n  const {\n    onAddZigbeeClickedHandler,\n    onAddBleClickedHandler,\n    showDialog,\n    setShowDialog,\n  } = useHook();\n\n  return (\n    <>\n      <DropdownButton title=\"Add device\" variant=\"outline-secondary\">\n        <Dropdown.Item onClick={onAddZigbeeClickedHandler}>Zigbee</Dropdown.Item>\n        <Dropdown.Item onClick={onAddBleClickedHandler}>Bluetooth</Dropdown.Item>\n      </DropdownButton>\n      {showDialog && (<AddZigbeeDialog onClosed={() => setShowDialog(false)}/>)}\n    </>\n  )\n}","import {useState} from \"react\";\nimport toast from \"react-hot-toast\";\n\nexport default () => {\n  const [showDialog, setShowDialog] = useState(false);\n\n  const onAddZigbeeClickedHandler = () => {\n    setShowDialog(true);\n  }\n\n  const onAddBleClickedHandler = () => {\n    toast.success(\"Not implemented yet\", {icon: \"😅\"})\n  }\n\n  return {\n    onAddZigbeeClickedHandler,\n    onAddBleClickedHandler,\n    showDialog,\n    setShowDialog,\n  }\n}\n","import React from \"react\";\nimport \"./styles.scss\";\nimport useHook from \"./hook\";\nimport {FadeIn} from \"../../shared/fadein-transition\";\nimport {Card, Row} from \"react-bootstrap\";\nimport Item from \"./item\";\nimport {AddDeviceButton} from \"./add-buttons\";\nimport {useTranslation} from \"react-i18next\";\n\nconst Result: React.FC = (): React.ReactElement => {\n  const {\n    deviceItems\n  } = useHook();\n\n  const {t} = useTranslation(\"pages.devices\");\n\n  if (deviceItems.length == 0) return (\n    <div>No devices found...</div>\n  )\n\n  console.debug(\"Building list of devices to show...\");\n\n  return (\n    <FadeIn>\n      <div className=\"devices\">\n        <Card>\n          <Card.Body>\n            <div className=\"group border-top pt-4\">\n              <div className=\"title h5 pb-2 d-flex justify-content-between align-items-center\">\n                <div>\n                  <span>{t(\"groups.all\")}</span>\n                  {deviceItems.length > 1 && (<span className=\"badge bg-secondary ms-2\">{deviceItems.length}</span>)}\n                </div>\n                <AddDeviceButton/>\n              </div>\n              <Row className=\"items\">\n                {deviceItems.map(device => (<Item device={device} key={device.ieee}/>))}\n              </Row>\n            </div>\n          </Card.Body>\n        </Card>\n      </div>\n    </FadeIn>\n  );\n}\n\nexport default Result;\n","import React, {Fragment, useContext, useEffect} from \"react\";\nimport {Container, Nav} from \"react-bootstrap\";\nimport {NavLink} from \"react-router-dom\";\nimport {FadeIn} from \"../../shared/fadein-transition\";\nimport {ZespSettings} from \"../../services/zesp/models/ZespSettings\";\nimport toast from \"react-hot-toast\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport {setSpinnerShow} from \"../../store/slices/spinnerSlice\"\nimport {setZespSettings, getZespSettings} from \"../../store/slices/settingsSlice\"\nimport useZespSettings from \"../../services/zesp/zespSettings.hook\";\nimport {Dispatch} from \"@reduxjs/toolkit\";\nimport {ZespContext} from \"../../shared/agents/ZespAgent\";\n\nconst Result = () => {\n  const dispatch = useDispatch();\n  const zesp = useContext(ZespContext);\n  const settings = useSelector(getZespSettings);\n  const {getAsync} = useZespSettings(zesp);\n\n  useEffect(() => {\n    dispatch(setSpinnerShow(true));\n\n    getAsync()\n      .then(data => {\n        dispatch(setZespSettings(data));\n      })\n      .catch(error => {\n        //TODO show error window\n        alert(error);\n      })\n      .finally(() => dispatch(setSpinnerShow(false)));\n  }, []);\n\n  if (!settings) return (<Fragment/>);\n\n  return (\n    <FadeIn>\n      <Container className=\"p-0\">\n        <Nav variant=\"pills\">\n          <Nav.Item><NavLink className=\"nav-link\" to=\"/setup\" exact>Wifi client</NavLink></Nav.Item>\n          <Nav.Item><NavLink className=\"nav-link\" to=\"/setup/zigbee\">Zigbee</NavLink></Nav.Item>\n          <Nav.Item><NavLink className=\"nav-link\" to=\"/setup/mqtt\">MQTT client</NavLink></Nav.Item>\n          <Nav.Item><NavLink className=\"nav-link\" to=\"/setup/telegram\">Telegram bot</NavLink></Nav.Item>\n          <Nav.Item><NavLink className=\"nav-link\" to=\"/setup/z2m\">Z2M client</NavLink></Nav.Item>\n          <Nav.Item><NavLink className=\"nav-link\" to=\"/setup/firmware\">Firmware manager</NavLink></Nav.Item>\n          {/*<Nav.Item className=\"ms-auto\"><NavLink className=\"nav-link\" to=\"/setup/zesp-ui\"><i className=\"bi bi-gear-fill\"/> ZESP:UI</NavLink></Nav.Item>*/}\n        </Nav>\n      </Container>\n    </FadeIn>\n  );\n}\n\nexport const SaveSettings = (\n  data: Partial<ZespSettings>,\n  settings: ZespSettings | undefined,\n  dispatch: Dispatch,\n  setAsync: { (settings: ZespSettings): Promise<void> }) =>\n  new Promise<void>((resolve, reject) => {\n    if (!settings) reject(\"Settings not loaded\");\n    dispatch(setSpinnerShow(true));\n\n    const updatedSettings: ZespSettings = ({...settings, ...data}) as ZespSettings;\n    setAsync(updatedSettings)\n      .then(() => {\n        dispatch(setZespSettings(updatedSettings));\n        resolve();\n        toast.success(\"Settings updated\");\n      })\n      .catch(reason => {\n        toast.error(`Cannot save: ${reason}`);\n        reject(reason);\n      })\n      .finally(() => dispatch(setSpinnerShow(false)));\n  })\n\nexport default Result;","import {useHistory, useParams} from \"react-router-dom\";\nimport {useSelector} from \"react-redux\";\nimport {RootState} from \"../../store/configure\";\nimport {getDeviceByIee} from \"../../store/slices/devicesSlice\";\nimport {DeviceInfo} from \"../../models/DeviceInfo\";\nimport {Devices} from \"../../services/devices\";\nimport toast from \"react-hot-toast\";\nimport {TypedZespResponseValidator} from \"../../services/zesp/common/ZespResponseValidators\";\nimport {useContext, useState} from \"react\";\nimport {ZespContext} from \"../../shared/agents/ZespAgent\";\n\nexport default () => {\n  const {ieee} = useParams<{ ieee: string }>();\n  const [showDialog, setShowDialog] = useState(true);\n  const [showSettings, setShowSettings] = useState(false);\n  const [autoExit, setAutoExit] = useState(false);\n  const history = useHistory();\n  const {zespRequestAsync} = useContext(ZespContext);\n  const deviceInfo = useSelector((state: RootState) => getDeviceByIee(state, ieee), deviceUpdateDetector);\n  const groups = deviceInfo && Devices.getControlGroups(deviceInfo);\n\n  if (!deviceInfo) throw new Error(\"Device information not found\");\n\n  const _returnBack = () => history.push(\"/devices\");\n\n  const onDebugDeviceHandler = () => {\n    console.log(deviceInfo);\n    toast.success(\"Check console for debug info\", {icon: \"👽\"});\n  }\n\n  const onDeleteDeviceHandler = () => {\n    _returnBack();\n    // zespSend({data: \"getDeviceList\"});\n\n    zespRequestAsync({\n      data: `removeDevice|${deviceInfo.zespInfo.Device}|${deviceInfo.zespInfo.IEEE}`,\n      // data: \"getDeviceList\",\n      responseValidator: TypedZespResponseValidator(\"alldev\")\n    })\n      .then(() => {\n        toast.success(\"Device deleted\", {icon: \"😵‍💫\"});\n      })\n      .catch(reason => {\n        toast.error(\"Cannot delete selected device\", {duration: 3000});\n        setShowDialog(true);\n      });\n  }\n\n  const onSettingsHandler = () => {\n    setShowDialog(false);\n    setShowSettings(true);\n  }\n\n  const onSettingsClosedHandler = () => {\n    setShowSettings(false);\n    setShowDialog(true);\n  }\n\n  const onReportsHandler = () => {\n    history.push(`/device/template/${deviceInfo.zespInfo.IEEE}`)\n  }\n\n  const onExitHandler = () => {\n    if (!autoExit) return;\n    setTimeout(_returnBack, 100)\n  };\n\n  const onCloseClickHandler = () => {\n    setAutoExit(true);\n    setShowDialog(false)\n  };\n\n  return {\n    deviceInfo,\n    groups,\n    showDialog,\n    showSettings,\n\n    onExitHandler,\n    onDebugDeviceHandler,\n    onDeleteDeviceHandler,\n    onCloseClickHandler,\n    onSettingsHandler,\n    onSettingsClosedHandler,\n    onReportsHandler,\n  }\n}\n\nconst deviceUpdateDetector = (a: DeviceInfo | undefined, b: DeviceInfo | undefined) => {\n  if (!a || !b) return false;\n  const keysA = Object.keys(a.zespInfo.Report);\n  const keysB = Object.keys(b.zespInfo.Report);\n\n  if (keysA.length != keysB.length) return false;\n  for (const key of keysA) {\n    if (a.zespInfo.Report[key] !== b.zespInfo.Report[key]) return false;\n  }\n\n  if (a.zespInfo.Name !== b.zespInfo.Name) return false;\n  if (a.zespInfo.Location !== b.zespInfo.Location) return false;\n\n  return true;\n}","import {DataLayoutItemsGroup} from \"../../models/DataControlSettings\";\nimport {Dropdown, Modal, OverlayTrigger, Popover} from \"react-bootstrap\";\nimport React, {useState} from \"react\";\nimport {DeviceInfo} from \"../../models/DeviceInfo\";\n\nexport default (props: {\n  device: DeviceInfo,\n  groups: DataLayoutItemsGroup[],\n  activeGroupName: string,\n  setActiveGroupName: (group: string) => void,\n  onCloseClickHandler: () => void,\n  onSettingsHandler: () => void,\n  onDeleteDeviceHandler: () => void,\n  onDebugDeviceHandler: () => void,\n  onReportsHandler: () => void,\n}) => {\n  const [deleteConfirmed, setDeleteConfirmed] = useState(false);\n  const title = props.device.zespInfo.Name || props.device.zespInfo.ModelId;\n\n  const buildMultiply = () => (\n    <ul className=\"nav nav-tabs\">\n      {props.groups.map((group, i) =>\n        (\n          <li className=\"nav-item\" key={i}>\n            <button\n              type=\"button\"\n              className={`btn btn-light nav-link ${props.activeGroupName === group.name ? \"active\" : \"\"}`}\n              onClick={() => props.setActiveGroupName(group.name)}>\n              {group.name === \"main\" ? title : group.name}\n            </button>\n          </li>\n        )\n      )}\n    </ul>\n  )\n\n  const buildSingle = () => (<div>{title}</div>);\n\n  const headerClassName = props.groups.length > 1 ? \"with-tabs\" : \"\";\n  const headerContent = props.groups.length > 1 ? buildMultiply() : buildSingle();\n\n  const onDeleteDeviceHandler = () => {\n    if (deleteConfirmed) props.onDeleteDeviceHandler();\n  }\n\n  const popover = (\n    <Popover id=\"popover-basic\">\n      <Popover.Header as=\"h3\" className=\"bg-danger text-light\">Achtung! Are you sure?</Popover.Header>\n      <Popover.Body>\n        To delete device registration, click <span className=\"text-danger\">Unpair device</span> one more time...\n      </Popover.Body>\n    </Popover>\n  );\n\n  return (\n    <Modal.Header className={`${headerClassName} with-buttons`}>\n      <div>{headerContent}</div>\n      <div className=\"text-end modal-right-buttons\">\n        <Dropdown className=\"d-inline-block\">\n          <Dropdown.Toggle variant=\"link\"><i className=\"bi bi-three-dots-vertical\"/></Dropdown.Toggle>\n          <Dropdown.Menu>\n            <Dropdown.Item onClick={props.onSettingsHandler}>Settings</Dropdown.Item>\n            <Dropdown.Item onClick={props.onReportsHandler}>Edit template</Dropdown.Item>\n            <OverlayTrigger trigger=\"click\" placement=\"left\" overlay={popover} rootClose={true} onToggle={setDeleteConfirmed}>\n              <button className=\"dropdown-item\" onClick={onDeleteDeviceHandler}>Unpair device</button>\n            </OverlayTrigger>\n            <Dropdown.Divider/>\n            <Dropdown.Item onClick={props.onDebugDeviceHandler}>Debug</Dropdown.Item>\n          </Dropdown.Menu>\n        </Dropdown>\n\n        <span className=\"border-end mx-2\"/>\n        <button type=\"button\" className=\"btn\" aria-label=\"Close\" onClick={props.onCloseClickHandler}><i className=\"bi bi-x-lg\"/></button>\n      </div>\n    </Modal.Header>\n  )\n}","import {DataLayoutItemsGroup} from \"../../models/DataControlSettings\";\nimport {Modal} from \"react-bootstrap\";\nimport React, {FunctionComponent} from \"react\";\nimport {DeviceInfo} from \"../../models/DeviceInfo\";\nimport {LayoutProps} from \"../../models/LayoutProps\";\nimport {DefaultLayout} from \"../../device-controls/layouts/DefaultLayout\";\nimport {layoutsAvailable} from \"../../device-controls/layouts\";\n\nexport default (props: {\n  device: DeviceInfo,\n  groups: DataLayoutItemsGroup[],\n  activeGroupName: string\n}) => {\n  const group = props.groups.find(x => x.name === props.activeGroupName);\n  if (!group) return (<div>Group '{props.activeGroupName}' not found.</div>)\n\n  const layoutProps: LayoutProps = {\n    device: props.device,\n    settings: group.settings\n  };\n\n  const layoutName = props.device.settings?.layout || \"default\";\n  const LayoutElements: FunctionComponent<LayoutProps> = layoutsAvailable[layoutName] || DefaultLayout;\n\n  return (\n    <Modal.Body className=\"text-start device-dialog p-4\">\n      <LayoutElements {...layoutProps}/>\n    </Modal.Body>\n  )\n}","import {useHistory} from \"react-router-dom\";\nimport React, {useEffect} from \"react\";\nimport toast from \"react-hot-toast\";\n\nexport default () => {\n  const history = useHistory();\n  useEffect(() => {\n    history.push(\"/devices\");\n    toast.error(\"Device information not found\");\n  }, []);\n  return (<></>);\n}","import React, {useState} from \"react\";\nimport useHook from \"./hook\";\nimport {Row, Col, Form, Button} from \"react-bootstrap\";\nimport {DeviceInfo} from \"../../models/DeviceInfo\";\nimport {AppDialog} from \"../app-dialog\";\n\ninterface IProps {\n  device: DeviceInfo,\n\n  onClosed: () => void,\n}\n\nexport const DeviceSettingsDialog: React.FC<IProps> = ({\n  device,\n  onClosed\n}): React.ReactElement => {\n  const {\n    forceClose,\n    // deviceData,\n\n    onCancelHandler,\n    onSaveHandler,\n  } = useHook(device);\n\n  const [name, setName] = useState(device.zespInfo.Name || \"\");\n  const [location, setLocation] = useState(device.zespInfo.Location || \"\");\n\n  const saveHandler = () => onSaveHandler(name, location)\n\n  const footer = (\n    <>\n      <Button type=\"submit\">Save changes</Button>\n      <Button variant=\"secondary\" role=\"cancel\" onClick={onCancelHandler}>Cancel</Button>\n    </>\n  )\n\n  return (\n    <AppDialog title=\"Device settings\" onClosed={onClosed} footer={footer} forceClose={forceClose} onSubmit={saveHandler}>\n      <Form.Group as={Row} className=\"mb-3\">\n        <Form.Label column sm=\"4\">Display name</Form.Label>\n        <Col><Form.Control value={name} onChange={event => setName(event.target.value)} placeholder={device.zespInfo.ModelId}/></Col>\n      </Form.Group>\n      <Form.Group as={Row} className=\"mb-3\">\n        <Form.Label column sm=\"4\">Location</Form.Label>\n        <Col><Form.Control value={location} onChange={event => setLocation(event.target.value)} placeholder=\"Default\"/></Col>\n      </Form.Group>\n    </AppDialog>\n  )\n}\n\nexport default DeviceSettingsDialog;","import {useContext, useState} from \"react\";\nimport {TypedZespResponseValidator} from \"../../services/zesp/common/ZespResponseValidators\";\nimport {DeviceInfo} from \"../../models/DeviceInfo\";\nimport {ZespContext} from \"../agents/ZespAgent\";\nimport toast from \"react-hot-toast\";\nimport {DictionaryStrings} from \"../../models/DictionaryStrings\";\nimport {useDispatch} from \"react-redux\";\nimport {updateDevice} from \"../../store/slices/devicesSlice\";\n\nexport default (device: DeviceInfo) => {\n  const [forceClose, setForceClose] = useState(false)\n  const {zespRequestAsync} = useContext(ZespContext);\n  const dispatch = useDispatch();\n  const fileName = `/Devices/${device.zespInfo.IEEE}`;\n\n  const onCancelHandler = () => {\n    setForceClose(true)\n  }\n\n  const onSaveHandler = (name: string | undefined, location: string | undefined) => {\n    // convert empty strings to undefined\n    name = name || undefined;\n    location = location || undefined;\n\n    // read current settings\n    zespRequestAsync({data: `LoadJson|${fileName}`, responseValidator: TypedZespResponseValidator(fileName)})\n      .then(event => {\n        if (event.dataParts.length < 1) throw Error(\"Unexpected device settings from ZESP\");\n        return JSON.parse(event.dataParts[0]) as DictionaryStrings;\n      })\n\n      // send updated settings\n      .then(data => {\n        data[\"Name\"] = name;\n        data[\"Location\"] = location;\n\n        const json = JSON.stringify(data);\n        return zespRequestAsync({\n          data: `SaveJson|${fileName}|${json}`,\n          responseValidator: TypedZespResponseValidator(\"ZD_RSP\")\n        });\n      })\n\n      // complete settings updating\n      .then(event => {\n        if (event.dataParts.length < 2 || event.dataParts[1].toLowerCase() !== \"ok\") throw Error(\"Cannot save device settings\");\n\n        device = {\n          ...device, ...{\n            zespInfo: {\n              ...device.zespInfo, ...{\n                Name: name,\n                Location: location\n              }\n            }\n          }\n        }\n\n        dispatch(updateDevice(device));\n        setForceClose(true);\n        toast.success(\"Settings updated\");\n      })\n\n      .catch(reason => {\n        toast.error(\"Cannot read device settings from ZESP\");\n        console.error(reason);\n        setForceClose(true);\n      });\n  }\n\n  return {\n    forceClose,\n\n    onCancelHandler,\n    onSaveHandler,\n  }\n}","import React, {useState} from \"react\";\nimport \"./styles.scss\";\nimport useHook from \"./hook\";\nimport {Modal} from \"react-bootstrap\";\nimport CustomHeader from \"./header\";\nimport CustomBody from \"./body\";\nimport CustomDeviceNotFound from \"./not-found\";\nimport DeviceSettingsDialog from \"../../shared/device-settings-dialog\";\n\nexport default () => {\n\n  const {\n    deviceInfo,\n    groups,\n    showDialog,\n    showSettings,\n\n    onDebugDeviceHandler,\n    onDeleteDeviceHandler,\n    onExitHandler,\n    onCloseClickHandler,\n    onSettingsHandler,\n    onSettingsClosedHandler,\n    onReportsHandler,\n  } = useHook()\n\n  if (!groups || groups.length === 0) {\n    console.warn(`No controls found for '${deviceInfo.zespInfo.IEEE}' device`);\n    return (<CustomDeviceNotFound/>);\n  }\n\n  const [activeGroupName, setActiveGroupName] = useState(groups[0].name);\n\n  const headerHandlers = {\n    onCloseClickHandler,\n    onSettingsHandler,\n    onSettingsClosedHandler,\n    onDeleteDeviceHandler,\n    onDebugDeviceHandler,\n    onReportsHandler\n  }\n\n  return (\n    <>\n      <Modal show={showDialog} onHide={onCloseClickHandler} onExited={onExitHandler}>\n        <CustomHeader\n          groups={groups}\n          device={deviceInfo}\n          activeGroupName={activeGroupName}\n          setActiveGroupName={setActiveGroupName}\n          {...headerHandlers}\n        />\n\n        <CustomBody\n          groups={groups}\n          device={deviceInfo}\n          activeGroupName={activeGroupName}/>\n      </Modal>\n      {showSettings && (<DeviceSettingsDialog onClosed={onSettingsClosedHandler} device={deviceInfo}/>)}\n    </>\n  )\n}\n","import {FormEvent} from \"react\";\n\ntype IAction = (arg: { [key: string]: string }) => void;\n\nconst Result = {\n  handleSubmit: function handleSubmit(e: FormEvent, action: IAction) {\n    e.preventDefault();\n\n    const data: { [key: string]: string } = {};\n    const inputs = e.currentTarget.getElementsByTagName(\"input\");\n    for (let i = 0; i < inputs.length; i++) {\n      const input = inputs[i];\n      const id = input.attributes.getNamedItem(\"id\")?.value;\n      const type = input.attributes.getNamedItem(\"type\")?.value;\n      if (!id || !type) continue;\n\n      if (type === \"checkbox\") {\n        data[id] = input.checked\n          ? input.attributes.getNamedItem(\"checked_value\")?.value || \"true\"\n          : input.attributes.getNamedItem(\"unchecked_value\")?.value || \"false\"\n      } else {\n        data[id] = input.value\n      }\n    }\n\n    action(data)\n  }\n};\n\nexport default Result;","import React, {FormEvent} from \"react\";\nimport {Form} from \"react-bootstrap\";\n\nimport {IProps} from \"./interfaces\";\nimport $ from \"./logic\";\n\nconst ReactForm = (props: IProps) => {\n  const {onSubmit, ...restProps} = props;\n  const onSubmitForm = (event: FormEvent) => $.handleSubmit(event, onSubmit);\n\n  return (\n    <Form onSubmit={onSubmitForm} {...restProps}>\n      {props.children}\n    </Form>\n  );\n}\n\nexport {ReactForm};","import React, {useContext, useEffect, useRef, useState} from \"react\";\nimport {FadeIn} from \"../../shared/fadein-transition\";\nimport {Button, Card} from \"react-bootstrap\";\nimport {ReactForm} from \"../../shared/form/react-form\";\nimport {AllMessagesZespResponseValidator} from \"../../services/zesp/common/ZespResponseValidators\";\nimport {ZespContext} from \"../../shared/agents/ZespAgent\";\n\nconst maxMessagesCount = 15;\nconst predefinedMessages = [\"getDeviceList\", \"get_Mi_lamp\", \"LoadJson|/location.json\", \"LoadJson|/groups.json\", \"LoadJson|/zesp_ui.json\"];\nconst predefinedBinary = [\"01 0000 01 0100\", \"01 0000 01 0000\"];\n\ninterface IFormData {\n  messageToSend?: string,\n}\n\nexport default (): React.ReactElement => {\n  const {zespSend, subscribe, unsubscribe} = useContext(ZespContext);\n  const [messages, _setMessages] = useState<string[]>([]);\n  const [messageSendValue, setMessageSendValue] = useState<string>(\"\");\n  const [paused, _setPaused] = useState<boolean>(false);\n  const [repsPaused, _setRepsPaused] = useState<boolean>(true);\n\n  const messagesRef = useRef(messages);\n  const pausedRef = useRef(paused);\n  const repsPausedRef = useRef(repsPaused);\n\n  const addMessages = (message: string) => {\n    if (pausedRef.current) return;\n\n    if (repsPausedRef.current && (\n      message.startsWith(\"rep|\") ||\n      message.startsWith(\"ArBle|\")\n    )) return;\n\n    const data: string[] = [message.substr(0, 500), ...messagesRef.current];\n    const cutCount = data.length - maxMessagesCount;\n    if (cutCount > 0) data.splice(data.length - cutCount, cutCount)\n\n    messagesRef.current = data;\n    _setMessages(data);\n  }\n\n  const togglePause = () => {\n    const data = !pausedRef.current;\n    pausedRef.current = data;\n    _setPaused(data);\n  }\n\n  const toggleRepsPause = () => {\n    const data = !repsPausedRef.current;\n    repsPausedRef.current = data;\n    _setRepsPaused(data);\n  }\n\n  const onSend = (data: IFormData) => {\n    if (!data.messageToSend) return;\n    addMessages(`>${data.messageToSend}`);\n    zespSend({data: data.messageToSend});\n  }\n\n  const onSendPredefined = (event: React.MouseEvent): void => {\n    const el = event.target as HTMLButtonElement;\n    const data = el.innerText;\n    setMessageSendValue(data);\n  }\n\n  const onSendBinary = (message?: string | null): void => {\n    const data = message || messageSendValue;\n    zespSend({data: data, isBinary: true});\n\n    // const dataHex = data.match(/[\\da-f]{2}/gi)?.map(group => parseInt(group, 16)) as ArrayLike<number>;\n    // const dataToSend = new Uint8Array(dataHex);\n    //\n    // addMessages(`>bin: ${data} (${dataToSend})`);\n    // Single.ZespConnector.send(dataToSend);\n  }\n\n  const onClearLog = () => {\n    messagesRef.current = [];\n    _setMessages([]);\n  }\n\n  useEffect(() => {\n    const listener = subscribe(AllMessagesZespResponseValidator, (event) => {\n      const message = event.response;\n      addMessages(message);\n    });\n    return () => unsubscribe(listener);\n  }, []);\n\n  return (\n\n    <FadeIn>\n      <ReactForm onSubmit={onSend}>\n        <Card>\n          <Card.Header>WebSocket tester (FOR DEVELOPMENT ONLY)</Card.Header>\n          <Card.Body>\n            <div className=\"row mb-2\">\n              <label className=\"col-md-3 col-lg-2\">Message to send</label>\n              <div className=\"col\">\n                <input type=\"text\" className=\"form-control\" id=\"messageToSend\" value={messageSendValue} onChange={event => setMessageSendValue(event.target.value)}/>\n              </div>\n            </div>\n            <div className=\"row\">\n              <div className=\"col-md-3 col-lg-2\"/>\n              <div className=\"col\">\n                <div>\n                  {predefinedMessages.map((x, i) => (\n                    <button key={i} type=\"button\" className=\"btn btn-sm btn-outline-primary me-1\" onClick={onSendPredefined}>{x}</button>\n                  ))}\n                </div>\n                <div className=\"mt-1\">\n                  {predefinedBinary.map((x, i) => (\n                    <button key={i} type=\"button\" className=\"btn btn-sm btn-outline-secondary me-1\" onClick={() => {\n                      setMessageSendValue(x);\n                      onSendBinary(x);\n                    }}>{x}</button>\n                  ))}\n                </div>\n              </div>\n            </div>\n          </Card.Body>\n          <Card.Footer>\n            <Button variant=\"primary\" type=\"submit\">Send message</Button>\n            <Button variant=\"secondary\" type=\"button\" onClick={() => onSendBinary()} className=\"ms-2\">Send binary</Button>\n          </Card.Footer>\n        </Card>\n      </ReactForm>\n\n      <Card className=\"mt-4\">\n        <Card.Header>\n          <span>Communication log <span className=\"badge bg-secondary small\">{messages.length}</span></span>\n          <button className=\"btn btn-outline-secondary ms-3 btn-sm\" onClick={onClearLog}>Clear log</button>\n          <button className=\"btn btn-outline-secondary ms-3 btn-sm\" onClick={() => togglePause()}>{paused ? \"Start logs\" : \"Pause logs\"}</button>\n          <button className={`btn btn-outline-${repsPaused ? \"secondary\" : \"info\"} ms-3 btn-sm float-end`}\n                  onClick={() => toggleRepsPause()}>{repsPaused ? \"REPs disabled\" : \"REPs enabled\"}</button>\n        </Card.Header>\n        <Card.Body>\n          {messages.map((message, i) => message.startsWith(\">\")\n            ? (<div key={i} className=\"px-2 mb-3 py-1 m-1 bg-success bg-opacity-25 rounded\">{message.substr(1)}</div>)\n            : (<div key={i} className=\"border-start mb-3 border-3 border-warning p-0 d-flex flex-wrap\">{message.split(\"|\").map((x, i2) => (\n              <span key={i2} className=\"bg-warning bg-opacity-25 m-1 px-2 rounded\">{x}</span>\n            ))}</div>))}\n        </Card.Body>\n      </Card>\n    </FadeIn>\n  );\n}","import React from \"react\";\nimport {Col, Form, Row} from \"react-bootstrap\";\n\ntype Props = {\n  defaultValue?: string | number | boolean | undefined;\n  controlId: string;\n  label: string;\n  placeholder?: string;\n  type?: \"text\" | \"password\";\n};\n\nconst Result = ({controlId, label, placeholder, defaultValue, type = \"text\"}: Props) => {\n  let inputProps = ({\n    placeholder,\n    type\n  });\n\n  if (defaultValue) inputProps = ({...inputProps, ...{defaultValue: defaultValue.toString()}});\n\n  return (\n    <Form.Group as={Row} className=\"mb-3\" controlId={controlId}>\n      <Form.Label column md=\"3\" lg=\"2\">{label}</Form.Label>\n      <Col>\n        <Form.Control {...inputProps} />\n      </Col>\n    </Form.Group>\n  );\n}\n\nexport default Result;\n","import React from \"react\";\nimport {Form} from \"react-bootstrap\";\n\ntype IProps = {\n  defaultChecked?: boolean | number | string;\n  controlId: string;\n  label: string;\n  checkedValue?: string | number | boolean | undefined;\n  uncheckedValue?: string | number | boolean | undefined;\n};\n\nconst Result = ({controlId, label, defaultChecked, checkedValue = \"true\", uncheckedValue = \"false\"}: IProps) => {\n  const defaultCheckedBool =\n    defaultChecked === \"true\" ||\n    defaultChecked === \"1\" ||\n    defaultChecked === 1 ||\n    defaultChecked === true ||\n    false;\n\n  let props = {checked_value: checkedValue, unchecked_value: uncheckedValue};\n  if (defaultChecked) props = ({...props, ...{defaultChecked: defaultCheckedBool}});\n\n  return (\n    <Form.Group controlId={controlId} className=\"d-inline-block\">\n      <Form.Label className=\"d-flex\">\n        <Form.Check className=\"pe-2\" {...props}/><span>{label}</span>\n      </Form.Label>\n    </Form.Group>\n  );\n}\n\nexport default Result;","import React, {useContext} from \"react\";\nimport {useTranslation} from \"react-i18next\";\nimport {Button, Card, Col, Row} from \"react-bootstrap\";\nimport {CheckGroupInline, InputGroupHorizontal} from \"../../shared/form\";\nimport {ReactForm} from \"../../shared/form/react-form\";\nimport {FadeIn} from \"../../shared/fadein-transition\";\nimport {ZespMqttSettings} from \"../../services/zesp/models/ZespSettings\";\nimport {SaveSettings} from \"./index\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport {getZespSettings} from \"../../store/slices/settingsSlice\";\nimport useZespSettings from \"../../services/zesp/zespSettings.hook\";\nimport {ZespContext} from \"../../shared/agents/ZespAgent\";\n\nconst Result = () => {\n  const dispatch = useDispatch();\n  const zesp = useContext(ZespContext);\n  const zespSettings = useZespSettings(zesp);\n  const allSettings = useSelector(getZespSettings);\n  const {t} = useTranslation([\"pages.setup-mqtt\", \"common\"]);\n\n  if (!allSettings) return (<div>No settings found...</div>);\n  const settings = allSettings.MQTT;\n\n  const onSubmit = (data: ZespMqttSettings) => SaveSettings({MQTT: data}, allSettings, dispatch, zespSettings.setAsync);\n\n  return (\n    <FadeIn>\n      <Card>\n        <ReactForm onSubmit={onSubmit}>\n          <Card.Body>\n            <InputGroupHorizontal controlId=\"mqttup\" defaultValue={settings.mqttup} label={t(\"topic.label\")} placeholder={t(\"topic.placeholder\")}/>\n            <InputGroupHorizontal controlId=\"mqtt\" defaultValue={settings.mqtt} label={t(\"server.label\")} placeholder={t(\"server.placeholder\")}/>\n            <InputGroupHorizontal controlId=\"mqttPort\" defaultValue={(settings.mqttPort)?.toString()} label={t(\"port.label\")} placeholder={t(\"port.placeholder\")}/>\n            <InputGroupHorizontal controlId=\"mqttLogin\" defaultValue={settings.mqttLogin} label={t(\"login.label\")} placeholder={t(\"login.placeholder\")}/>\n            <InputGroupHorizontal type=\"password\" controlId=\"mqttPassw\" defaultValue={settings.mqttPassw} label={t(\"password.label\")} placeholder={t(\"password.placeholder\")}/>\n            <Row>\n              <Col md=\"3\" lg=\"2\"/>\n              <Col className=\"space-between-4\">\n                <CheckGroupInline controlId=\"mqttEnable\" defaultChecked={settings.mqttEnable} label={t(\"is_enabled.label\")} checkedValue={1} uncheckedValue={0}/>\n                <CheckGroupInline controlId=\"Home_Assistant\" defaultChecked={settings.Home_Assistant} label={t(\"is_ha_enabled.label\")} checkedValue={1} uncheckedValue={0}/>\n              </Col>\n            </Row>\n\n          </Card.Body>\n          <Card.Footer><Button variant=\"primary\" type=\"submit\">{t(\"common:save_button\")}</Button></Card.Footer>\n        </ReactForm>\n      </Card>\n    </FadeIn>\n  );\n}\n\nexport default Result;","import React from \"react\";\nimport {FadeIn} from \"../../shared/fadein-transition\";\n\nconst Result = () => (\n  <FadeIn>\n    <div className=\"px-4 py-5 bg-light rounded-3\">\n      <div className=\"container-fluid\">\n        <h1 className=\"display-5 fw-bold\">Not implemented yet!</h1>\n        <p className=\"col-md-8 fs-4\">\n          Hello, my dear friend! Just imagine how awesome this feature can be and share it with developers ~_~ <br/><br/>\n          Or you can even implement it yourself, everything you need is just to jump to source codes, made some magic, test it and that's it!\n        </p>\n        <hr className=\"my-4\"/>\n        <p>This feature is under contruction. You can find latest verion on <a href=\"#\">github project page</a> or just click this big blue button bellow.</p>\n        <a href=\"#\" target={\"_blank\"} rel=\"noreferrer\" className=\"btn btn-primary btn-lg\" type=\"button\">Learn more</a>\n      </div>\n    </div>\n    {/*<div className=\"jumbotron\">*/}\n    {/*  <h1 className=\"display-4\">Not implemented yet!</h1>*/}\n    {/*  <p className=\"lead\">*/}\n    {/*    Hello, my dear friend! Just imagine how awesome this feature can be and share it with developers ~_~ <br/>*/}\n    {/*    Or you can even implement it yourself, everything you need is just to jump to source codes, made some magic, test it and that's it!*/}\n    {/*  </p>*/}\n    {/*  <hr className=\"my-4\"/>*/}\n    {/*  <p>This feature is under contruction. You can find latest verion on <a href=\"#\">github project page</a> or just click this big blue button bellow.</p>*/}\n    {/*  <a className=\"btn btn-primary btn-lg\" href=\"#\" target={\"_blank\"} rel=\"noreferrer\" role=\"button\">Learn more</a>*/}\n    {/*</div>*/}\n  </FadeIn>\n);\n\nexport default Result;","import React, {Fragment, useContext} from \"react\";\nimport {Button, Card} from \"react-bootstrap\";\nimport {FadeIn} from \"../../shared/fadein-transition\";\nimport {useTranslation} from \"react-i18next\";\nimport {ReactForm} from \"../../shared/form/react-form\";\nimport {InputGroupHorizontal} from \"../../shared/form\";\nimport {ZespWifiSettings} from \"../../services/zesp/models/ZespSettings\";\nimport {SaveSettings} from \"./index\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport {getZespSettings} from \"../../store/slices/settingsSlice\";\nimport {ZespContext} from \"../../shared/agents/ZespAgent\";\nimport useZespSettings from \"../../services/zesp/zespSettings.hook\";\n\nconst Result = () => {\n  const dispatch = useDispatch();\n  const zesp = useContext(ZespContext);\n  const zespSettings = useZespSettings(zesp);\n  const allSettings = useSelector(getZespSettings);\n  const {t} = useTranslation([\"pages.setup-wifi\", \"common\"]);\n\n  if (!allSettings) return (<Fragment/>);\n  const settings = allSettings.Wifi;\n\n  const onSubmit = (data: ZespWifiSettings): Promise<void> => SaveSettings({Wifi: data}, allSettings, dispatch, zespSettings.setAsync);\n\n  return (\n    <Fragment>\n      <FadeIn>\n        <ReactForm onSubmit={onSubmit}>\n          <Card>\n            <Card.Body>\n              <InputGroupHorizontal controlId=\"ssid\" defaultValue={settings?.ssid} label={t(\"ssid.label\")} placeholder={t(\"ssid.placeholder\")}/>\n              <InputGroupHorizontal type=\"password\" controlId=\"pass\" defaultValue={settings?.pass} label={t(\"pass.label\")} placeholder={t(\"pass.placeholder\")}/>\n              <InputGroupHorizontal controlId=\"ip\" defaultValue={settings?.ip} label={t(\"ip.label\")} placeholder={t(\"ip.placeholder\")}/>\n              <InputGroupHorizontal controlId=\"mask\" defaultValue={settings?.mask} label={t(\"mask.label\")} placeholder={t(\"mask.placeholder\")}/>\n              <InputGroupHorizontal controlId=\"gw\" defaultValue={settings?.gw} label={t(\"gw.label\")} placeholder={t(\"gw.placeholder\")}/>\n            </Card.Body>\n            <Card.Footer><Button variant=\"primary\" type=\"submit\">{t(\"common:save_button\")}</Button></Card.Footer>\n          </Card>\n        </ReactForm>\n      </FadeIn>\n    </Fragment>\n  )\n};\n\nexport default Result;","import {useParams} from \"react-router-dom\";\nimport {useContext, useEffect, useState} from \"react\";\nimport {ZespContext} from \"../../shared/agents/ZespAgent\";\nimport {TypedZespResponseValidator} from \"../../services/zesp/common/ZespResponseValidators\";\nimport {ZespReportInfo} from \"../../services/zesp/models/ZespReportInfo\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport {getAllDevices, updateReport, updateReportsOrder, updateZespInfo} from \"../../store/slices/devicesSlice\";\nimport {ReportKeyInfo} from \"../../models/ReportKeyInfo\";\nimport {ZespDeviceInfo} from \"../../services/zesp/models/ZespDeviceInfo\";\nimport toast from \"react-hot-toast\";\nimport {setSpinner, setSpinnerShow} from \"../../store/slices/spinnerSlice\";\n\ntype hookStatuses = \"loading\" | \"error\" | \"loaded\";\n\nexport default () => {\n  const dispatch = useDispatch()\n  const {ieee} = useParams<{ ieee: string }>();\n  const {zespRequestAsync} = useContext(ZespContext);\n  const fileName = `/Devices/${ieee}`;\n  const [template, setTemplate] = useState<ZespDeviceInfo>();\n  const [status, setStatus] = useState<hookStatuses>(\"loading\");\n  const [play, setPlay] = useState<ReportKeyInfo>();\n  const [showSettings, setShowSettings] = useState<{ keyInfo: ReportKeyInfo, reportInfo: ZespReportInfo }>();\n\n  const devices = useSelector(getAllDevices)\n    .filter(x => x.zespInfo.Device !== \"0000\")\n    .map(x => ({\n      name: x.zespInfo.Name || x.zespInfo.ModelId,\n      ieee: x.zespInfo.IEEE,\n    }))\n    .sort(devicesSorting);\n\n  useEffect(() => {\n    zespRequestAsync({data: `LoadJson|${fileName}`, responseValidator: TypedZespResponseValidator(fileName)})\n      .then(event => {\n        if (event.dataParts.length < 1) throw Error(\"Unexpected device settings from ZESP\")\n\n        // we need 'any' type here, but later will expose it by types\n        // eslint-disable-next-line\n        const response = JSON.parse(event.dataParts[0]) as ZespDeviceInfo\n        setTemplate(response);\n        setStatus(\"loaded\");\n      })\n      .catch(() => {\n        setStatus(\"error\");\n      })\n  }, [ieee]);\n\n  const onSaveReportSettings = (keyInfo: ReportKeyInfo, reportInfo: ZespReportInfo): void => {\n    const reportKey = keyInfo.attributeId\n      ? `${keyInfo.endpoint}${keyInfo.clusterId}${keyInfo.attributeId}`\n      : keyInfo.clusterId; // for BLE devices without endpoints and attributes\n\n    const updatedReports = {...template!.Report, ...{[reportKey]: reportInfo}}\n    const updatedTemplate = {...template, ...{Report: updatedReports}}\n    const json = JSON.stringify(updatedTemplate);\n\n    zespRequestAsync({\n      data: `SaveJson|${fileName}|${json}`,\n      responseValidator: TypedZespResponseValidator(\"ZD_RSP\")\n    })\n      .then(event => {\n        if (event.dataParts.length < 2 || event.dataParts[1].toLowerCase() !== \"ok\") throw Error(\"Cannot save device settings\");\n        dispatch(updateReport({ieee, reportKey, update: reportInfo}))\n        setTemplate(updatedTemplate as ZespDeviceInfo)\n        toast.success(\"Report settings updated\");\n      })\n  }\n\n  const playHandler = (keyInfo?: ReportKeyInfo): void => setPlay(keyInfo);\n\n  const onAddReport = (keyInfo: ReportKeyInfo, reportInfo: ZespReportInfo): void => {\n    onSaveReportSettings(keyInfo, reportInfo)\n  }\n\n  const onDelete = (keyInfo: ReportKeyInfo): void => {\n    const reportKey = `${keyInfo.endpoint}${keyInfo.clusterId}${keyInfo.attributeId}`\n    const updatedTemplate = JSON.parse(JSON.stringify(template)) as ZespDeviceInfo;\n    if (updatedTemplate!.Report) delete updatedTemplate!.Report[reportKey]\n    const json = JSON.stringify(updatedTemplate)\n\n    dispatch(setSpinner({show: true, message: \"Removing...\"}))\n    zespRequestAsync({\n      data: `SaveJson|${fileName}|${json}`,\n      responseValidator: TypedZespResponseValidator(\"ZD_RSP\")\n    })\n      .then(event => {\n        if (event.dataParts.length < 2 || event.dataParts[1].toLowerCase() !== \"ok\") throw Error(\"Cannot save device settings\");\n        dispatch(updateZespInfo(updatedTemplate))\n        setTemplate(updatedTemplate as ZespDeviceInfo)\n        toast.success(\"Report deleted\", {icon: \"🗑\"});\n      })\n      .catch(reason => toast.error(reason))\n      .finally(() => {\n        dispatch(setSpinnerShow(false))\n      })\n  }\n\n  const moveReport = (keyInfo: ReportKeyInfo, amount: number): void => {\n    if (!template) throw Error(\"Unexpected empty template\");\n\n    const reportKey = `${keyInfo.endpoint}${keyInfo.clusterId}${keyInfo.attributeId}`\n    const reportKeys = Object.keys(template.Report);\n\n    const currentIndex = reportKeys.indexOf(reportKey)\n    if (currentIndex == -1) {\n      console.warn(\"Cannot find report current index...\")\n      return\n    }\n\n    const newIndex = currentIndex + amount;\n    if (newIndex < 0 || newIndex >= reportKeys.length) {\n      console.debug(\"Didn't moved, cause limited\")\n      return;\n    }\n\n    const tmp = reportKeys[newIndex]\n    reportKeys[newIndex] = reportKeys[currentIndex]\n    reportKeys[currentIndex] = tmp\n\n    console.log(`old: ${currentIndex}; new: ${newIndex}`)\n    console.log(reportKeys)\n\n    const reports = reportKeys.reduce((a, key) => ({...a, [key]: template.Report[key]}), {});\n    const json = JSON.stringify({...template, ...{Report: reports}});\n\n    dispatch(setSpinner({show: true, message: \"Reordering...\"}))\n    zespRequestAsync({\n      data: `SaveJson|${fileName}|${json}`,\n      responseValidator: TypedZespResponseValidator(\"ZD_RSP\")\n    })\n      .then(event => {\n        if (event.dataParts.length < 2 || event.dataParts[1].toLowerCase() !== \"ok\") throw Error(\"Cannot save device settings\");\n        template.Report = reports;\n        setTemplate(template);\n        dispatch(updateReportsOrder({ieee: template.IEEE, orderedReportKeys: reportKeys}))\n      })\n      .catch(reason => toast.error(reason))\n      .finally(() => {\n        dispatch(setSpinnerShow(false))\n      })\n  }\n\n  return {\n    template,\n    devices,\n    status,\n    ieee,\n    showSettings,\n    play,\n\n    setShowSettings,\n    onSaveReportSettings,\n    playHandler,\n    onAddReport,\n    onDelete,\n    moveReport,\n  }\n}\n\nconst devicesSorting = (a: { name: string }, b: { name: string }): number => {\n  if (a.name === \"ZESP_Root\") return -1;\n  if (b.name === \"ZESP_Root\") return 1;\n\n  if (a.name < b.name) return -1;\n  if (a.name > b.name) return 1;\n\n  return 0;\n}\n","import React from \"react\";\nimport {Col, Row} from \"react-bootstrap\";\n\ninterface IProps {\n  title: string,\n}\n\nexport const ErrorMessage: React.FC<IProps> = ({title, children}): React.ReactElement => {\n  return (\n    <div className=\"modal-dialog\">\n      <div className=\"modal-content\">\n        <div className=\"modal-header\">\n          <h5 className=\"modal-title\">{title}</h5>\n        </div>\n        <div className=\"modal-body\">\n          <Row>\n            <Col xs={3} className=\"d-flex align-items-center justify-content-center\">\n              <i className=\"bi bi-exclamation-diamond text-danger\" style={{fontSize: \"60px\"}}/>\n            </Col>\n            <Col className=\"d-flex align-items-center\">{children}</Col>\n          </Row>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default ErrorMessage;","import {Devices} from \"../../../services/devices\";\nimport HomeAutoClusters from \"../../../data/reports.json\";\nimport {IClusterAttribute, IClusterInfo} from \"../../../interfaces/IClusterInfo\";\nimport {IDeviceTemplateReportProps} from \"./index\";\n\nconst DeviceTemplateReportHook = ({\n  template,\n  reportKey,\n  showSettingsHandler,\n}: IDeviceTemplateReportProps) => {\n  const report = template.Report[reportKey]\n  const keyInfo = Devices.getReportKeyDetails(reportKey, template.DevType)\n\n  if (!report || !keyInfo) return undefined;\n\n  const clusterInfo = (HomeAutoClusters.find(x => x.clusterId === keyInfo.clusterId) || {name: \"Unknown\"}) as IClusterInfo;\n  const role = (report.role || \"\").split(\"&\")[0];\n  const attributeInfo: IClusterAttribute | undefined = (!clusterInfo?.attributes || Object.keys(clusterInfo.attributes).length === 0)\n    ? undefined\n    : !role\n      ? clusterInfo.attributes[keyInfo.attributeId] || undefined\n      : clusterInfo.attributes[`${keyInfo.attributeId}:${role}`] || clusterInfo.attributes[keyInfo.attributeId] || undefined\n\n  const editHandler = () => showSettingsHandler({keyInfo, reportInfo: report})\n\n  return {\n    report,\n    keyInfo,\n    clusterInfo,\n    attributeInfo,\n\n    editHandler,\n  }\n}\n\nexport default DeviceTemplateReportHook;\n","import React, {Fragment, useState} from \"react\";\nimport useHook from \"./hook\";\nimport {Dropdown, OverlayTrigger, Popover} from \"react-bootstrap\";\nimport {ZespReportInfo} from \"../../../services/zesp/models/ZespReportInfo\";\nimport {ReportKeyInfo} from \"../../../models/ReportKeyInfo\";\nimport {ZespDeviceInfo} from \"../../../services/zesp/models/ZespDeviceInfo\";\n\nexport interface IDeviceTemplateReportProps {\n  template: ZespDeviceInfo,\n  reportKey: string,\n\n  showSettingsHandler: (data: { keyInfo: ReportKeyInfo, reportInfo: ZespReportInfo }) => void,\n  playHandler: (keyInfo: ReportKeyInfo) => void,\n  deleteHandler: (keyInfo: ReportKeyInfo) => void,\n  onMoveReport: (keyInfo: ReportKeyInfo, amount: number) => void,\n}\n\nexport const DeviceTemplateReport: React.FC<IDeviceTemplateReportProps> = (props): React.ReactElement => {\n  const hook = useHook(props);\n  if (!hook) {\n    console.warn(`Unknown report with key ${props.reportKey}`)\n    return (<Fragment/>)\n  }\n\n  const {\n    report,\n    keyInfo,\n    clusterInfo,\n    attributeInfo,\n\n    editHandler\n  } = hook;\n\n  const {\n    playHandler,\n    onMoveReport\n  } = props;\n\n  const [deleteConfirmed, setDeleteConfirmed] = useState(false);\n\n  const deleteConfirmedHandler = () => {\n    if (deleteConfirmed) props.deleteHandler(keyInfo);\n  }\n\n  const runHandler = () => playHandler(keyInfo);\n\n  const popover = (\n    <Popover id=\"popover-basic\">\n      <Popover.Header as=\"h3\" className=\"bg-danger text-light\">Achtung! Are you sure?</Popover.Header>\n      <Popover.Body>\n        Please, click one more time in menu <span className=\"text-danger\">Delete report</span> to confirm.\n      </Popover.Body>\n    </Popover>\n  );\n\n  return (\n    <div className=\"report\">\n      <div className=\"report-menu\">\n        <Dropdown className=\"d-inline-block\">\n          <Dropdown.Toggle variant=\"link\"><i className=\"bi bi-three-dots-vertical\" style={{fontSize: \"25px\"}}/></Dropdown.Toggle>\n          <Dropdown.Menu>\n            <Dropdown.Item onClick={editHandler}>Edit settings</Dropdown.Item>\n            <OverlayTrigger trigger=\"click\" overlay={popover} rootClose={true} onToggle={setDeleteConfirmed}>\n              <button className=\"dropdown-item\" onClick={deleteConfirmedHandler}>Delete report</button>\n            </OverlayTrigger>\n            <Dropdown.Divider/>\n            <Dropdown.Item onClick={() => onMoveReport(keyInfo, -1)}>Move up</Dropdown.Item>\n            <Dropdown.Item onClick={() => onMoveReport(keyInfo, 1)}>Move down</Dropdown.Item>\n          </Dropdown.Menu>\n        </Dropdown>\n      </div>\n      <div className=\"report-key\">\n        <div className=\"title\" title={clusterInfo.name}>{clusterInfo.name}</div>\n        <div className=\"code\">{keyInfo.clusterId}</div>\n      </div>\n\n      <div className=\"report-key\">\n        <div className=\"title\" title={attributeInfo?.name || attributeInfo?.id}>{attributeInfo?.name || attributeInfo?.id || \"Unknown\"}</div>\n        <div className=\"code\">{keyInfo.attributeId || \"-\"}</div>\n      </div>\n\n      <div className=\"report-label\">{report.label}</div>\n      <div className=\"report-action\">\n        <i className=\"bi bi-play-fill\" style={{fontSize: \"45px\"}} onClick={runHandler}/>\n      </div>\n    </div>\n  )\n}\n\nexport default DeviceTemplateReport;","import React, {useState} from \"react\";\nimport {AppDialog} from \"../../../shared/app-dialog\";\nimport {ZespReportInfo} from \"../../../services/zesp/models/ZespReportInfo\";\nimport {ReportKeyInfo} from \"../../../models/ReportKeyInfo\";\nimport {Button, Col, Form, Row} from \"react-bootstrap\";\n\ninterface IProps {\n  data: { keyInfo: ReportKeyInfo, reportInfo?: ZespReportInfo },\n\n  onClosed: () => void,\n  onSave: (keyInfo: ReportKeyInfo, reportInfo: ZespReportInfo) => void,\n}\n\nexport const DeviceReportSettings: React.FC<IProps> = ({\n  data,\n  onClosed,\n  onSave,\n}): React.ReactElement => {\n  const [label, setLabel] = useState(data.reportInfo?.label || \"\")\n  const [role, setRole] = useState(data.reportInfo?.role || \"\")\n  const [mat, setMat] = useState(data.reportInfo?.mat || \"\")\n  const [forceClose, setForceClose] = useState(false);\n\n  const roleDataList = [\"binary_sensor\", \"fan\", \"alarm_control_panel\", \"lock\", \"climate\", \"light_XY\", \"light_rgb\", \"light_hue\", \"light_temp\", \"light_level\", \"light_onoff\", \"light\", \"livolo_swith1ch\", \"outlet\", \"switch\", \"cover\", \"sensor\"]\n    .sort();\n\n  const onSaveHandler = (): void => {\n    const result = {...data.reportInfo || {} as ZespReportInfo, ...{label, role, mat}}\n    onSave(data.keyInfo, result);\n    setForceClose(true);\n  }\n\n  const footer = (\n    <>\n      <Button type=\"submit\">Save</Button>\n      <Button variant=\"secondary\" onClick={() => setForceClose(true)}>Cancel</Button>\n    </>\n  )\n\n  return (\n    <AppDialog title={`Report settings for '${data.keyInfo.endpoint} ${data.keyInfo.clusterId} ${data.keyInfo.attributeId}'`} onClosed={onClosed} footer={footer}\n               forceClose={forceClose} onSubmit={onSaveHandler}>\n      <Form.Group as={Row} className=\"mb-3\">\n        <Form.Label column sm=\"4\">Label</Form.Label>\n        <Col><Form.Control value={label || \"\"} onChange={event => setLabel(event.target.value)} placeholder=\"Label is required\" isInvalid={!label}/></Col>\n      </Form.Group>\n\n      <Form.Group as={Row} className=\"mb-3\">\n        <Form.Label column sm=\"4\">Role</Form.Label>\n        <Col><Form.Control value={role || \"\"} onChange={event => setRole(event.target.value)} placeholder=\"Default\" {...{list: \"roles-list\"}}/></Col>\n      </Form.Group>\n\n      <Form.Group as={Row} className=\"mb-3\">\n        <Form.Label column sm=\"4\">Mat (???)</Form.Label>\n        <Col><Form.Control value={mat || \"\"} onChange={event => setMat(event.target.value)} placeholder=\"Default\"/></Col>\n      </Form.Group>\n\n      <datalist id=\"roles-list\">\n        {roleDataList.map((x, i) => (<option key={i} value={x}/>))}\n      </datalist>\n    </AppDialog>\n  )\n}\n\nexport default DeviceReportSettings;","import React, {useContext, useEffect, useRef, useState} from \"react\";\nimport \"./styles.scss\";\nimport HomeAutoClusters from \"../../../data/reports.json\";\nimport ResponseDataTypes from \"./data-types.json\";\nimport {ReportKeyInfo} from \"../../../models/ReportKeyInfo\";\nimport {Button, ButtonGroup, Col, FormGroup, FormLabel, ListGroup, Row} from \"react-bootstrap\";\nimport {IClusterAttributeCollection, IClusterInfo} from \"../../../interfaces/IClusterInfo\";\nimport toast from \"react-hot-toast\";\nimport {ZespDeviceInfo} from \"../../../services/zesp/models/ZespDeviceInfo\";\nimport {ZespContext} from \"../../../shared/agents/ZespAgent\";\nimport {ReportZespResponseValidator} from \"../../../services/zesp/common/ZespResponseValidators\";\nimport {ZespDeviceUpdate} from \"../../../services/zesp/models/ZespDeviceUpdate\";\nimport {DictionaryStrings} from \"../../../models/DictionaryStrings\";\nimport DeviceReportSettings from \"../device-report-settings\";\nimport {ZespReportInfo} from \"../../../services/zesp/models/ZespReportInfo\";\nimport FormCheckInput from \"react-bootstrap/FormCheckInput\";\n\ninterface IResponse {\n  type: string,\n  data?: string,\n  parsed?: string\n}\n\ninterface IReadMessage {\n  type: \"info\" | \"error\",\n  message: string\n}\n\ninterface IProps {\n  play?: ReportKeyInfo,\n  template: ZespDeviceInfo,\n  onAddReport: (keyInfo: ReportKeyInfo, reportInfo: ZespReportInfo) => void,\n}\n\nexport const DeviceTemplateEditor: React.FC<IProps> = ({play, template, onAddReport}): React.ReactElement => {\n  const [cluster, setCluster] = useState<string>(play?.clusterId || \"\")\n  const [attribute, setAttribute] = useState<string>(play?.attributeId || \"\")\n  const [attributes, setAttributes] = useState<IClusterAttributeCollection>()\n  const [readData, setReadData] = useState<IResponse>()\n  const [showAll, setShowAll] = useState(false)\n  const [sendButtonDisabled, setSendButtonDisabled] = useState(false)\n  const [readDataMessage, setReadDataMessage] = useState<IReadMessage>()\n  const [showAddSettings, setShowAddSettings] = useState(false)\n  const {zespRequestAsync} = useContext(ZespContext)\n  const alignTimers = useRef<NodeJS.Timeout[]>([])\n  const endpointClusters = template.EP && Object.entries(template.EP)[0] && Object.entries(template.EP)[0][1]\n\n  const clusters = HomeAutoClusters\n    .map(x => x as IClusterInfo)\n    .filter(x => x.attributes && Object.keys(x.attributes).length > 0)\n    .filter(x => showAll || endpointClusters?.ClO.indexOf(x.clusterId) >= 0 || endpointClusters?.ClI.indexOf(x.clusterId) >= 0)\n\n  const responseDataTypes = ResponseDataTypes as DictionaryStrings\n\n  useEffect(() => {\n    if (template) {\n      setCluster(\"\")\n      setAttribute(\"\")\n      setAttributes(undefined)\n      setReadDataMessage(undefined)\n      setReadData(undefined)\n    }\n  }, [template])\n\n  useEffect(() => {\n    if (!play) return;\n\n    setCluster(play.clusterId)\n    setAttribute(play.attributeId)\n  }, [play])\n\n  useEffect(() => {\n    if (cluster) {\n      setAttributes(clusters.find(x => x.clusterId === cluster)?.attributes)\n    }\n  }, [cluster])\n\n  useEffect(() => {\n    alignTimers.current.forEach(x => clearTimeout(x));\n    alignTimers.current.push(setTimeout(() => alignSelected(), 500))\n  }, [cluster, attribute])\n\n  const alignSelected = (): void => {\n    const lists = document.getElementsByClassName(\"list-group\")\n    let delay = 0;\n    alignTimers.current.forEach(x => clearTimeout(x));\n    for (let i = 0; i < lists.length; i++) {\n      const listGroup = lists[i]\n      if (!listGroup) continue\n\n      const activeElement = listGroup.getElementsByClassName(\"btn active\")\n      if (activeElement.length == 0) continue\n      const timer = setTimeout(() => activeElement[0]?.scrollIntoView({behavior: \"smooth\", block: \"nearest\"}), delay);\n      alignTimers.current.push(timer);\n      delay += 500;\n    }\n  }\n\n  const onReadHandler = (): void => {\n    setReadDataMessage(undefined);\n    setReadData(undefined);\n\n    if (!cluster && cluster.trim().length === 0) {\n      toast.error(\"Cluster value required\", {icon: \"👾\"})\n      return\n    }\n    if (!attribute && attribute.trim().length === 0) {\n      toast.error(\"Attribute value required\", {icon: \"☢️\"})\n      return\n    }\n\n    readingDataBegin(template.Device, \"01\", cluster, attribute);\n  }\n\n  const onAddHandler = (): void => {\n    if (!cluster && cluster.trim().length === 0) {\n      toast.error(\"Cluster value required\", {icon: \"👾\"})\n      return\n    }\n\n    setShowAddSettings(true);\n  }\n\n  const readingDataBegin = (deviceId: string, endpointId: string, clusterId: string, attributeId: string): void => {\n    setReadDataMessage({type: \"info\", message: \"Reading...\"})\n    setSendButtonDisabled(true)\n    zespRequestAsync({\n      data: `reqAtribute|${deviceId}|${endpointId}|${clusterId}|${attributeId}|0000`,\n      responseValidator: ReportZespResponseValidator(deviceId, endpointId, clusterId, attributeId)\n    })\n      .then(event => {\n        const data = JSON.parse(event.dataParts[0]) as ZespDeviceUpdate\n        const response: IResponse = {\n          type: responseDataTypes[data.Dtype] || data.Dtype,\n          data: data.Data,\n          parsed: data.parsed\n        }\n\n        setReadDataMessage(undefined)\n        setReadData(response)\n      })\n      .catch(reason => {\n        setReadDataMessage({type: \"error\", message: reason})\n      })\n      .finally(() => {\n        setSendButtonDisabled(false)\n      })\n  }\n\n  const getClusterType = (clusterId: string): string | undefined => {\n    if (endpointClusters?.ClO && endpointClusters.ClO.indexOf(clusterId) !== -1 && endpointClusters?.ClI && endpointClusters.ClI.indexOf(clusterId) !== -1) return \"in/out\";\n    if (endpointClusters?.ClO && endpointClusters.ClO.indexOf(clusterId) !== -1) return \"out\";\n    if (endpointClusters?.ClI && endpointClusters.ClI.indexOf(clusterId) !== -1) return \"in\";\n    return undefined;\n  }\n\n  return (\n    <div className=\"template-editor\">\n      <div className=\"input-group mb-2\">\n        <input type=\"text\" className=\"form-control text-center flex-grow-0\" style={{width: \"95px\"}} defaultValue=\"01\" readOnly/>\n        <input type=\"text\" className=\"form-control text-center\" placeholder=\"Cluster\" value={cluster} onChange={(event) => setCluster(event.target.value)}/>\n        <input type=\"text\" className=\"form-control text-center\" placeholder=\"Attribute\" value={attribute} onChange={(event) => setAttribute(event.target.value)}/>\n\n        <button className=\"btn btn-outline-primary flex-grow-0\" style={{width: \"100px\"}} type=\"button\" onClick={onAddHandler} disabled={sendButtonDisabled}>\n          <i className=\"bi bi-plus\"/> Add\n        </button>\n\n        <button className=\"btn btn-outline-primary flex-grow-0\" style={{width: \"100px\"}} type=\"button\" onClick={onReadHandler} disabled={sendButtonDisabled}>\n          <i className=\"bi bi-cloud-arrow-down-fill me-2\"/> Read\n        </button>\n      </div>\n\n      {readDataMessage && (\n        <div className={`alert ${readDataMessage.type === \"error\" ? \"alert-warning\" : \"alert-info\"}`}>{readDataMessage.message}</div>\n      )}\n\n      {readData && (\n        <div className=\"results alert alert-success\">\n          <div><span>Data type:</span> {readData.type}</div>\n          <div><span>Response:</span> {readData.data || \"undefined\"}</div>\n          <div><span>Parsed:</span> {readData.parsed || \"undefined\"}</div>\n        </div>\n      )}\n\n      {clusters && clusters.length > 0 && (\n        <Row>\n          <Col xs={6} className=\"lists\">\n            <ListGroup as={ButtonGroup} vertical={true}>\n              {clusters.map((x, i) => {\n                const type = getClusterType(x.clusterId)\n                return (\n                  <ListGroup.Item key={i} as={Button} onClick={() => setCluster(x.clusterId)} active={x.clusterId === cluster}\n                                  className=\"d-flex justify-content-between align-items-center\">\n                    <div className=\"me-auto item-title\" title={x.name}>{x.name}</div>\n                    <div className=\"badges\">\n                      {type && (<span className=\"badge bg-info rounded-pill\">{type}</span>)}\n                      <span className=\"badge bg-secondary rounded-pill\">{x.clusterId}</span>\n                    </div>\n                  </ListGroup.Item>\n                )\n              })}\n            </ListGroup>\n          </Col>\n          <Col xs={6} className=\"lists\">\n            {attributes && (\n              <ListGroup as={ButtonGroup} vertical={true}>\n                {Object.entries(attributes).map(([attributeId, x], i) => {\n                  const attributeParts = attributeId.split(\":\");\n                  return (\n                    <ListGroup.Item key={i} as={Button} onClick={() => setAttribute(attributeParts[0])} active={attributeParts[0] === attribute}\n                                    className=\"d-flex justify-content-between align-items-center\">\n                      <div className=\"me-auto item-title\" title={x.name}>{x.name || \"Unnamed\"}</div>\n\n                      <div className=\"badges\">\n                        {attributeParts.length > 1 && (<span className=\"badge bg-info rounded-pill\">{attributeParts[1]}</span>)}\n                        <span className=\"badge bg-secondary rounded-pill\">{attributeParts[0]}</span>\n                      </div>\n                    </ListGroup.Item>\n                  )\n                })}\n              </ListGroup>\n            )}\n          </Col>\n        </Row>\n      )}\n\n      {(!clusters || clusters.length === 0) && (<div className=\"alert alert-warning text-center\">No device related clusters found</div>)}\n\n      {showAddSettings && (\n        <DeviceReportSettings data={{reportInfo: undefined, keyInfo: {endpoint: \"01\", clusterId: cluster, attributeId: attribute}}}\n                              onClosed={() => setShowAddSettings(false)}\n                              onSave={onAddReport}/>)}\n\n      <FormGroup className=\"text-end border-top mt-1 pt-2 d-flex align-items-center justify-content-end\">\n        <FormLabel className=\"m-0\">\n          Show all clusters and attributes\n          <FormCheckInput className=\"ms-2\" checked={showAll} onChange={() => setShowAll(!showAll)}/>\n        </FormLabel>\n      </FormGroup>\n    </div>\n  )\n}\n\nexport default DeviceTemplateEditor;\n","import React from \"react\";\nimport \"./style.scss\";\nimport useHook from \"./hook\";\nimport {FadeIn} from \"../../shared/fadein-transition\";\nimport {Card, Col, Dropdown} from \"react-bootstrap\";\nimport {NavLink, useHistory} from \"react-router-dom\";\nimport {CustomSpinner} from \"../../shared/loading-spinner\";\nimport ErrorMessage from \"../../shared/error-message\";\nimport DeviceTemplateReport from \"./device-template-report\";\nimport DeviceReportSettings from \"./device-report-settings\";\nimport DeviceTemplateEditor from \"./device-template-editor\";\n\nexport const DeviceTemplatePage: React.FC = (): React.ReactElement => {\n  const {\n    template,\n    devices,\n    status,\n    ieee,\n    showSettings,\n    play,\n\n    setShowSettings,\n    onSaveReportSettings,\n    playHandler,\n    onAddReport,\n    onDelete,\n    moveReport\n  } = useHook();\n\n  const history = useHistory();\n  const changeDeviceHandler = (device: { ieee: string }): void => {\n    history.push(`/device/template/${device.ieee}`)\n    playHandler(undefined);\n  }\n\n  if (status === \"loading\")\n    return (<CustomSpinner message=\"Template loading...\"/>)\n\n  if (status === \"error\" || !template)\n    return (<ErrorMessage title=\"Loading error\">Oops, for some reasons we cannot read template data for selected device.</ErrorMessage>)\n\n  return (\n    <>\n      <FadeIn>\n        <div>\n          <Card className=\"device-template\">\n            <Card.Header className=\"breadcrumb\">\n              <NavLink to=\"/devices\" className=\"breadcrumb-item\">Devices</NavLink>\n              <NavLink to={`/devices/${ieee}`} className=\"breadcrumb-item\">Settings</NavLink>\n              <Dropdown className=\"d-inline-block\">\n                <Dropdown.Toggle variant=\"link\" as={\"span\"} className=\"breadcrumb-item\">{template.Name || template.ModelId}</Dropdown.Toggle>\n                <Dropdown.Menu>\n                  {devices.map((device, i) => (\n                    <Dropdown.Item onClick={() => changeDeviceHandler(device)} key={i}\n                                   className={device.ieee === ieee ? \"text-primary\" : \"\"}>{device.name}</Dropdown.Item>\n                  ))}\n                </Dropdown.Menu>\n              </Dropdown>\n            </Card.Header>\n            <Card.Body className=\"row\">\n              <Col xs={12} lg={6}>\n                {Object.keys(template.Report).map(key => {\n                  return (<DeviceTemplateReport key={key} reportKey={key} template={template}\n                                                showSettingsHandler={setShowSettings} playHandler={playHandler}\n                                                deleteHandler={onDelete} onMoveReport={moveReport}/>)\n                })}\n              </Col>\n              <Col xs={12} lg={6}><DeviceTemplateEditor play={play} template={template} onAddReport={onAddReport}/></Col>\n            </Card.Body>\n          </Card>\n        </div>\n      </FadeIn>\n      {showSettings && <DeviceReportSettings onClosed={() => setShowSettings(undefined)} data={showSettings} onSave={onSaveReportSettings}/>}\n    </>\n  )\n}\n\nexport default DeviceTemplatePage;","import React, {Fragment} from \"react\";\nimport {Redirect, Route} from \"react-router-dom\";\nimport {DeviceInfoPage, DevicesPage, SetupPage, SocketTestPage} from \"./pages\";\nimport {NotImplementedYetPage, SetupMqttPage, SetupWifiPage} from \"./pages/setup/setup-pages\";\nimport {getInitialized} from \"./store/slices/zespSlice\"\nimport {setSpinnerShow} from \"./store/slices/spinnerSlice\"\nimport {useDispatch, useSelector} from \"react-redux\";\nimport DeviceTemplatePage from \"./pages/device-template\";\n\nexport const Routes = () => {\n  const isInitialized = useSelector(getInitialized);\n  const dispatch = useDispatch();\n\n  if (!isInitialized) {\n    // return (<div>Initialization...</div>);\n    setTimeout(() => dispatch(setSpinnerShow(true)), 0);\n    return (<Fragment/>);\n  }\n\n  setTimeout(() => dispatch(setSpinnerShow(false)), 300);\n\n  return (\n    <Fragment>\n      {/*<Route exact path=\"/\" component={MainPage}/>*/}\n      <Route exact path=\"/\"><Redirect to=\"/devices\"/></Route>\n      <Route path=\"/devices\" component={DevicesPage}/>\n      <Route path=\"/devices/:ieee\" component={DeviceInfoPage}/>\n      <Route path=\"/device/template/:ieee\" component={DeviceTemplatePage}/>\n      <Route path=\"/setup\" component={SetupPage}/>\n      <Route exact path=\"/setup\" component={SetupWifiPage}/>\n      <Route path=\"/setup/mqtt\" component={SetupMqttPage}/>\n      <Route path=\"/setup/zigbee\" component={NotImplementedYetPage}/>\n      <Route path=\"/setup/telegram\" component={NotImplementedYetPage}/>\n      <Route path=\"/setup/z2m\" component={NotImplementedYetPage}/>\n      <Route path=\"/setup/zesp-ui\" component={NotImplementedYetPage}/>\n      <Route path=\"/setup/firmware\" component={NotImplementedYetPage}/>\n      <Route path=\"/socket-test\" component={SocketTestPage}/>\n    </Fragment>\n  )\n}","import React from \"react\";\nimport \"./styles.scss\";\nimport {useSelector} from \"react-redux\";\nimport {getZespFirmwareInstalledVersion} from \"../../store/slices/zespFirmwareSlice\";\n\nexport const AppFooter: React.FC = (): React.ReactElement => {\n  const uiVersion = process.env[\"REACT_APP_VERSION\"];\n  const zespVersion = useSelector(getZespFirmwareInstalledVersion);\n\n  return (\n    <footer className=\"app-footer my-3\">\n      <div className=\"d-flex justify-content-center\">\n        <div><a href=\"https://github.com/NickRimmer/zesp-ui\" target={\"_blank\"} rel=\"noreferrer\">ZESP UI<i className=\"bi bi-github ms-2\"/></a></div>\n        <div className=\"mx-3 border-start opacity-25\"/>\n        <div>UI <span className=\"highlight\">{uiVersion}</span></div>\n        <div className=\"mx-3 border-start opacity-25\"/>\n        <div><a href=\"https://t.me/zesp32\" target={\"_blank\"} rel=\"noreferrer\">ZESP</a> <span className=\"highlight\">{zespVersion}</span></div>\n      </div>\n    </footer>\n  )\n}\n\nexport default AppFooter;","import React, {useContext, useState} from \"react\";\nimport {AppDialog} from \"../app-dialog\";\nimport {Button} from \"react-bootstrap\";\nimport {useDispatch} from \"react-redux\";\nimport {setSpinner} from \"../../store/slices/spinnerSlice\";\nimport {ZespContext} from \"../agents/ZespAgent\";\n\nexport const PowerDialogLink: React.FC = (): React.ReactElement => {\n  const [show, setShow] = useState(false);\n  const {zespSend} = useContext(ZespContext);\n  const dispatch = useDispatch();\n\n  const showPowerDialogClickHandler = () => setShow(true);\n\n  const onRestartClickedHandler = () => {\n    dispatch(setSpinner({show: true, message: \"Restarting, please wait...\"}));\n    setShow(false);\n    zespSend({data: \"RebootESP\"});\n  };\n\n  const onShutdownClickedHandler = () => {\n    dispatch(setSpinner({show: true, message: \"Shutting down...\"}));\n    // dispatch(setConnectionStatus(\"reconnect\"));\n    setShow(false);\n    setTimeout(() => document.location.href = \"/\", 2000);\n    zespSend({data: \"Shutdown\"});\n  };\n\n  const navLink = (<span className=\"nav-link clickable\" onClick={showPowerDialogClickHandler}><i className=\"bi bi-power\"/></span>)\n  const buttons = (\n    <>\n      <Button onClick={onRestartClickedHandler}>Restart ZESP</Button>\n      <Button onClick={onShutdownClickedHandler} variant=\"secondary\">Shutdown</Button>\n    </>\n  );\n\n  return (\n    <>\n      {navLink}\n      {show && (\n        <AppDialog title=\"Power management\" footer={buttons} onClosed={() => setShow(false)}>\n          <div className=\"mb-3\">Restart of ZESP service can take a few minutes. This page will be reloaded automatically when restart completed.</div>\n          <div>To shutdown, just click Shutdown button. But this is way with one direction, make sure you know what are you doing.</div>\n        </AppDialog>\n      )}\n    </>\n  )\n}\n\nexport default PowerDialogLink;","import React from 'react';\nimport './styles.scss'\nimport {useTranslation} from \"react-i18next\";\nimport {NavLink} from \"react-router-dom\";\nimport PowerDialogLink from \"../power-dialog\";\n\nconst Result = () => {\n  const {t} = useTranslation(\"nav\");\n\n  return (\n    <nav className=\"nav nav-masthead justify-content-center pe-2\">\n      {/*<NavLink className=\"nav-link\" to=\"/\" exact={true}>{t('home')}</NavLink>*/}\n      <NavLink className=\"nav-link\" to=\"/devices\">{t('devices')}</NavLink>\n      {process.env.NODE_ENV === \"development\" && (\n        <NavLink className=\"nav-link\" to=\"/socket-test\" exact={true}>Test WS</NavLink>\n      )}\n      <NavLink className=\"nav-link\" to=\"/setup\">{t('setup')}</NavLink>\n      <div className=\"border-start mx-3 opacity-25\"/>\n      <PowerDialogLink/>\n    </nav>\n  );\n};\n\nexport default Result;","import React, {useContext, useState} from \"react\";\nimport {DictionaryStrings} from \"../../models/DictionaryStrings\";\nimport {Col, Modal, Row} from \"react-bootstrap\";\nimport toast from \"react-hot-toast\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport {getUiSettings, setUiSettings} from \"../../store/slices/settingsSlice\";\nimport {UiSettings} from \"../../models/UiSettings\";\nimport {ZespContext} from \"../agents/ZespAgent\";\nimport useZespSettings from \"../../services/zesp/zespSettings.hook\";\n\ninterface IProps {\n  zespFirmwareUpdate: DictionaryStrings,\n  zespFirmwareCurrentVersion: string,\n  onClosed: () => void,\n}\n\nconst UpdatesNotificationDialog: React.FC<IProps> = ({\n  onClosed,\n  zespFirmwareUpdate,\n  zespFirmwareCurrentVersion\n}): React.ReactElement => {\n  const [show, setShow] = useState(true);\n  const dispatch = useDispatch();\n  const zesp = useContext(ZespContext);\n  const SettingsService = useZespSettings(zesp);\n  const uiSettings = useSelector(getUiSettings);\n  const zespFirmwareUpdateVersion = zespFirmwareUpdate[\"ver\"] || \"unknown\";\n\n  const onHideHandler = () => setShow(false);\n\n  const updateData: DictionaryStrings = {\n    ...{\"Current version\": zespFirmwareCurrentVersion},\n    ...{\"New version\": zespFirmwareUpdateVersion},\n    ...{...zespFirmwareUpdate, ...{\"ver\": undefined}} // skip ver from \"other\" properties, cause we'll show it before\n  }\n  const onUpdateClickHandler = () => {\n    toast.success(\"Not implemented yet...\", {icon: (<i className=\"bi bi-cone-striped text-warning\"/>)});\n  }\n\n  const onSkipClickHandler = () => {\n    const update: UiSettings = {...uiSettings || {} as UiSettings, ...{firmwareSkipUpdate: zespFirmwareUpdateVersion}};\n\n    dispatch(setUiSettings(update));\n    SettingsService.setUiSettings(update);\n\n    toast.success(\"Notification for this version disabled\", {icon: (<i className=\"bi bi-bell-slash-fill text-success\"/>)});\n  }\n\n  return (\n    <Modal show={show} onExited={onClosed} onHide={onHideHandler}>\n      <Modal.Header>\n        <div>New version of ZESP Firmware</div>\n        <div className=\"text-end modal-right-buttons\">\n          <button type=\"button\" className=\"btn-close me-1\" aria-label=\"Close\" onClick={onHideHandler}/>\n        </div>\n      </Modal.Header>\n      <Modal.Body className=\"text-start\">\n        <div className=\"rows-striped\">\n          {Object.keys(updateData).map((key, i) => {\n            return updateData[key]\n              && updateData[key]!.trim().length > 0\n              && (<Row key={i}><Col xs={4} className=\"py-2 text-capitalize text-muted text-end\">{key}</Col><Col className=\"py-2 text-dark\">{updateData[key]}</Col></Row>);\n          })}\n        </div>\n      </Modal.Body>\n      <Modal.Footer>\n        <button className=\"btn btn-primary\" onClick={onUpdateClickHandler}>Download and Update</button>\n        <button className=\"btn btn-secondary\" onClick={onSkipClickHandler}>Skip this version</button>\n      </Modal.Footer>\n    </Modal>\n  )\n}\n\nexport default UpdatesNotificationDialog;","import React, {Fragment, useState} from \"react\";\nimport UpdatesNotificationDialog from \"./UpdatesNotificationDialog\";\nimport {useSelector} from \"react-redux\";\nimport {getZespFirmwareInstalledVersion, getZespFirmwareUpdateInfo} from \"../../store/slices/zespFirmwareSlice\";\nimport {getUiSettings} from \"../../store/slices/settingsSlice\";\n\nexport const UpdatesNotification: React.FC = (): React.ReactElement => {\n  const zespFirmwareUpdate = useSelector(getZespFirmwareUpdateInfo);\n  const zespCurrentVersion = useSelector(getZespFirmwareInstalledVersion);\n  const uiSettings = useSelector(getUiSettings);\n  const [showDialog, setShowDialog] = useState(false);\n\n  if (!zespFirmwareUpdate\n    || zespFirmwareUpdate[\"ver\"] === zespCurrentVersion\n    || uiSettings?.firmwareSkipUpdate === zespFirmwareUpdate[\"ver\"]) return (<Fragment/>);\n\n  const title = `${zespCurrentVersion} to ${zespFirmwareUpdate[\"ver\"]} update`;\n  const onUpdatesClickedHandler = () => {\n    setShowDialog(true);\n  }\n\n  return (\n    <div>\n      <span onClick={onUpdatesClickedHandler} className=\"badge bg-info ms-3 notification-updates clickable\" title={title}>\n        <i className=\"bi bi-cloud-arrow-down-fill\"/>\n      </span>\n      {showDialog && (<UpdatesNotificationDialog\n        onClosed={() => setShowDialog(false)}\n        zespFirmwareUpdate={zespFirmwareUpdate}\n        zespFirmwareCurrentVersion={zespCurrentVersion}/>)}\n    </div>\n  )\n}\n\nexport default UpdatesNotification;","import React from \"react\";\nimport \"./styles.scss\";\nimport TopMenu from \"../top-menu\";\nimport {UpdatesNotification} from \"../updates-notification/UpdatesNotification\";\n\nexport const AppHeader: React.FC = (): React.ReactElement => {\n  return (\n    <header className=\"app-header\">\n      <a href=\"/\"><h3 className=\"title\">ZESP:UI</h3></a>\n      <div className=\"d-flex flex-row align-items-center\">\n        <TopMenu/>\n        <UpdatesNotification/>\n      </div>\n    </header>\n  )\n}\n\nexport default AppHeader;","import React, {useState} from 'react';\nimport {BrowserRouter as Router, Switch} from \"react-router-dom\";\nimport './bootstrap-updates.scss';\nimport './App.scss';\nimport LoadingSpinner from \"./shared/loading-spinner\";\nimport {Toaster} from \"react-hot-toast\";\nimport {Routes} from \"./Routes\";\nimport {WelcomePage} from \"./pages/welcome\";\nimport {IServerInfo} from \"./pages/welcome/interfaces\";\nimport {ZespAgent} from \"./shared/agents/ZespAgent\";\nimport {AppFooter} from \"./shared/footer\";\nimport AppHeader from \"./shared/header\";\n\nconst Content = () => {\n  const selfHosted = process.env.REACT_APP_SELF_HOSTED === \"1\"\n  if (selfHosted) {\n    const selfHostedServer: IServerInfo = {\n      address: process.env.REACT_APP_SELF_HOSTED_DEV || document.location.hostname,\n      name: \"Self-hosted\"\n    }\n\n    return <App server={selfHostedServer}/>\n  }\n\n\n  const [serverIndex, setServerIndex] = useState<number | null>(null);\n  const serversString = window.localStorage.getItem(\"servers\");\n  const servers = (serversString && JSON.parse(serversString)) || [];\n  const selectedServer = (serverIndex === null || servers.length <= serverIndex!)\n    ? null\n    : servers[serverIndex!];\n\n\n  return selectedServer ? (<App server={selectedServer}/>) : (<WelcomePage setServerIndex={setServerIndex}/>);\n}\n\nconst App = (props: { server: IServerInfo }) => {\n  return (\n    <ZespAgent server={props.server}>\n      <div className=\"container-md d-flex w-100 h-100 p-3 mx-auto flex-column\">\n        <AppHeader/>\n        <main role=\"main\" className=\"text-start d-flex flex-grow-1 flex-column\">\n          <Routes/>\n        </main>\n        <AppFooter/>\n      </div>\n    </ZespAgent>\n  )\n}\n\nconst Result = () => {\n  return (\n    <>\n      <Router>\n        <Switch>\n          <Content/>\n        </Switch>\n      </Router>\n\n      <LoadingSpinner/>\n      <Toaster/>\n    </>\n  );\n}\n\nexport default Result;\n","import {ReportHandler} from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({getCLS, getFID, getFCP, getLCP, getTTFB}) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import {configureStore} from '@reduxjs/toolkit'\nimport zespReducer from \"./slices/zespSlice\";\nimport devicesReducer from \"./slices/devicesSlice\";\nimport spinnerReducer from \"./slices/spinnerSlice\";\nimport settingsReducer from \"./slices/settingsSlice\";\nimport zespFirmwareReducer from \"./slices/zespFirmwareSlice\";\n\nexport const store = configureStore({\n  reducer: {\n    zesp: zespReducer,\n    devices: devicesReducer,\n    spinner: spinnerReducer,\n    settings: settingsReducer,\n    zespFirmware: zespFirmwareReducer,\n  }\n})\n\nexport type RootState = ReturnType<typeof store.getState>\nexport type AppDispatch = typeof store.dispatch;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport './loader.js';\nimport \"bootstrap/dist/js/bootstrap.bundle\";\nimport './i18n/config';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport {Provider} from \"react-redux\";\nimport {store} from \"./store/configure\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App/>\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}